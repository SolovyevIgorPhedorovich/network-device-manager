import{c as q,g as mi,a as Si,r as Ie,j as pe}from"./index-DCqSukAw.js";var Pe={exports:{}},we={},qt;function bi(){return qt||(qt=1,q.crypto&&q.crypto.getRandomValues?we.randomBytes=function(M){var x=new Uint8Array(M);return q.crypto.getRandomValues(x),x}:we.randomBytes=function(M){for(var x=new Array(M),T=0;T<M;T++)x[T]=Math.floor(Math.random()*256);return x}),we}var He,$t;function ce(){if($t)return He;$t=1;var M=bi(),x="abcdefghijklmnopqrstuvwxyz012345";return He={string:function(T){for(var A=x.length,L=M.randomBytes(T),B=[],y=0;y<T;y++)B.push(x.substr(L[y]%A,1));return B.join("")},number:function(T){return Math.floor(Math.random()*T)},numberString:function(T){var A=(""+(T-1)).length,L=new Array(A+1).join("0");return(L+this.number(T)).slice(-A)}},He}var zt;function he(){return zt||(zt=1,function(M){var x=ce(),T={},A=!1,L=q.chrome&&q.chrome.app&&q.chrome.app.runtime;M.exports={attachEvent:function(y,i){typeof q.addEventListener<"u"?q.addEventListener(y,i,!1):q.document&&q.attachEvent&&(q.document.attachEvent("on"+y,i),q.attachEvent("on"+y,i))},detachEvent:function(y,i){typeof q.addEventListener<"u"?q.removeEventListener(y,i,!1):q.document&&q.detachEvent&&(q.document.detachEvent("on"+y,i),q.detachEvent("on"+y,i))},unloadAdd:function(y){if(L)return null;var i=x.string(8);return T[i]=y,A&&setTimeout(this.triggerUnloadCallbacks,0),i},unloadDel:function(y){y in T&&delete T[y]},triggerUnloadCallbacks:function(){for(var y in T)T[y](),delete T[y]}};var B=function(){A||(A=!0,M.exports.triggerUnloadCallbacks())};L||M.exports.attachEvent("unload",B)}(Pe)),Pe.exports}var Fe,Kt;function Ci(){return Kt||(Kt=1,Fe=function(x,T){if(T=T.split(":")[0],x=+x,!x)return!1;switch(T){case"http":case"ws":return x!==80;case"https":case"wss":return x!==443;case"ftp":return x!==21;case"gopher":return x!==70;case"file":return!1}return x!==0}),Fe}var Ee={},Xt;function yi(){if(Xt)return Ee;Xt=1;var M=Object.prototype.hasOwnProperty,x;function T(y){try{return decodeURIComponent(y.replace(/\+/g," "))}catch{return null}}function A(y){try{return encodeURIComponent(y)}catch{return null}}function L(y){for(var i=/([^=?#&]+)=?([^&]*)/g,o={},a;a=i.exec(y);){var c=T(a[1]),n=T(a[2]);c===null||n===null||c in o||(o[c]=n)}return o}function B(y,i){i=i||"";var o=[],a,c;typeof i!="string"&&(i="?");for(c in y)if(M.call(y,c)){if(a=y[c],!a&&(a===null||a===x||isNaN(a))&&(a=""),c=A(c),a=A(a),c===null||a===null)continue;o.push(c+"="+a)}return o.length?i+o.join("&"):""}return Ee.stringify=B,Ee.parse=L,Ee}var Ne,Vt;function si(){if(Vt)return Ne;Vt=1;var M=Ci(),x=yi(),T=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,A=/[\n\r\t]/g,L=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,B=/:\d+$/,y=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,i=/^[a-zA-Z]:/;function o(t){return(t||"").toString().replace(T,"")}var a=[["#","hash"],["?","query"],function(r,h){return d(h.protocol)?r.replace(/\\/g,"/"):r},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],c={hash:1,query:1};function n(t){var r;typeof window<"u"?r=window:typeof q<"u"?r=q:typeof self<"u"?r=self:r={};var h=r.location||{};t=t||h;var u={},p=typeof t,g;if(t.protocol==="blob:")u=new f(unescape(t.pathname),{});else if(p==="string"){u=new f(t,{});for(g in c)delete u[g]}else if(p==="object"){for(g in t)g in c||(u[g]=t[g]);u.slashes===void 0&&(u.slashes=L.test(t.href))}return u}function d(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function _(t,r){t=o(t),t=t.replace(A,""),r=r||{};var h=y.exec(t),u=h[1]?h[1].toLowerCase():"",p=!!h[2],g=!!h[3],l=0,v;return p?g?(v=h[2]+h[3]+h[4],l=h[2].length+h[3].length):(v=h[2]+h[4],l=h[2].length):g?(v=h[3]+h[4],l=h[3].length):v=h[4],u==="file:"?l>=2&&(v=v.slice(2)):d(u)?v=h[4]:u?p&&(v=v.slice(2)):l>=2&&d(r.protocol)&&(v=h[4]),{protocol:u,slashes:p||d(u),slashesCount:l,rest:v}}function m(t,r){if(t==="")return r;for(var h=(r||"/").split("/").slice(0,-1).concat(t.split("/")),u=h.length,p=h[u-1],g=!1,l=0;u--;)h[u]==="."?h.splice(u,1):h[u]===".."?(h.splice(u,1),l++):l&&(u===0&&(g=!0),h.splice(u,1),l--);return g&&h.unshift(""),(p==="."||p==="..")&&h.push(""),h.join("/")}function f(t,r,h){if(t=o(t),t=t.replace(A,""),!(this instanceof f))return new f(t,r,h);var u,p,g,l,v,C,k=a.slice(),E=typeof r,w=this,P=0;for(E!=="object"&&E!=="string"&&(h=r,r=null),h&&typeof h!="function"&&(h=x.parse),r=n(r),p=_(t||"",r),u=!p.protocol&&!p.slashes,w.slashes=p.slashes||u&&r.slashes,w.protocol=p.protocol||r.protocol||"",t=p.rest,(p.protocol==="file:"&&(p.slashesCount!==2||i.test(t))||!p.slashes&&(p.protocol||p.slashesCount<2||!d(w.protocol)))&&(k[3]=[/(.*)/,"pathname"]);P<k.length;P++){if(l=k[P],typeof l=="function"){t=l(t,w);continue}g=l[0],C=l[1],g!==g?w[C]=t:typeof g=="string"?(v=g==="@"?t.lastIndexOf(g):t.indexOf(g),~v&&(typeof l[2]=="number"?(w[C]=t.slice(0,v),t=t.slice(v+l[2])):(w[C]=t.slice(v),t=t.slice(0,v)))):(v=g.exec(t))&&(w[C]=v[1],t=t.slice(0,v.index)),w[C]=w[C]||u&&l[3]&&r[C]||"",l[4]&&(w[C]=w[C].toLowerCase())}h&&(w.query=h(w.query)),u&&r.slashes&&w.pathname.charAt(0)!=="/"&&(w.pathname!==""||r.pathname!=="")&&(w.pathname=m(w.pathname,r.pathname)),w.pathname.charAt(0)!=="/"&&d(w.protocol)&&(w.pathname="/"+w.pathname),M(w.port,w.protocol)||(w.host=w.hostname,w.port=""),w.username=w.password="",w.auth&&(v=w.auth.indexOf(":"),~v?(w.username=w.auth.slice(0,v),w.username=encodeURIComponent(decodeURIComponent(w.username)),w.password=w.auth.slice(v+1),w.password=encodeURIComponent(decodeURIComponent(w.password))):w.username=encodeURIComponent(decodeURIComponent(w.auth)),w.auth=w.password?w.username+":"+w.password:w.username),w.origin=w.protocol!=="file:"&&d(w.protocol)&&w.host?w.protocol+"//"+w.host:"null",w.href=w.toString()}function e(t,r,h){var u=this;switch(t){case"query":typeof r=="string"&&r.length&&(r=(h||x.parse)(r)),u[t]=r;break;case"port":u[t]=r,M(r,u.protocol)?r&&(u.host=u.hostname+":"+r):(u.host=u.hostname,u[t]="");break;case"hostname":u[t]=r,u.port&&(r+=":"+u.port),u.host=r;break;case"host":u[t]=r,B.test(r)?(r=r.split(":"),u.port=r.pop(),u.hostname=r.join(":")):(u.hostname=r,u.port="");break;case"protocol":u.protocol=r.toLowerCase(),u.slashes=!h;break;case"pathname":case"hash":if(r){var p=t==="pathname"?"/":"#";u[t]=r.charAt(0)!==p?p+r:r}else u[t]=r;break;case"username":case"password":u[t]=encodeURIComponent(r);break;case"auth":var g=r.indexOf(":");~g?(u.username=r.slice(0,g),u.username=encodeURIComponent(decodeURIComponent(u.username)),u.password=r.slice(g+1),u.password=encodeURIComponent(decodeURIComponent(u.password))):u.username=encodeURIComponent(decodeURIComponent(r))}for(var l=0;l<a.length;l++){var v=a[l];v[4]&&(u[v[1]]=u[v[1]].toLowerCase())}return u.auth=u.password?u.username+":"+u.password:u.username,u.origin=u.protocol!=="file:"&&d(u.protocol)&&u.host?u.protocol+"//"+u.host:"null",u.href=u.toString(),u}function s(t){(!t||typeof t!="function")&&(t=x.stringify);var r,h=this,u=h.host,p=h.protocol;p&&p.charAt(p.length-1)!==":"&&(p+=":");var g=p+(h.protocol&&h.slashes||d(h.protocol)?"//":"");return h.username?(g+=h.username,h.password&&(g+=":"+h.password),g+="@"):h.password?(g+=":"+h.password,g+="@"):h.protocol!=="file:"&&d(h.protocol)&&!u&&h.pathname!=="/"&&(g+="@"),(u[u.length-1]===":"||B.test(h.hostname)&&!h.port)&&(u+=":"),g+=u+h.pathname,r=typeof h.query=="object"?t(h.query):h.query,r&&(g+=r.charAt(0)!=="?"?"?"+r:r),h.hash&&(g+=h.hash),g}return f.prototype={set:e,toString:s},f.extractProtocol=_,f.location=n,f.trimLeft=o,f.qs=x,Ne=f,Ne}var We,Gt;function se(){if(Gt)return We;Gt=1;var M=si();return We={getOrigin:function(x){if(!x)return null;var T=new M(x);if(T.protocol==="file:")return null;var A=T.port;return A||(A=T.protocol==="https:"?"443":"80"),T.protocol+"//"+T.hostname+":"+A},isOriginEqual:function(x,T){var A=this.getOrigin(x)===this.getOrigin(T);return A},isSchemeEqual:function(x,T){return x.split(":")[0]===T.split(":")[0]},addPath:function(x,T){var A=x.split("?");return A[0]+T+(A[1]?"?"+A[1]:"")},addQuery:function(x,T){return x+(x.indexOf("?")===-1?"?"+T:"&"+T)},isLoopbackAddr:function(x){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(x)||/^\[::1\]$/.test(x)}},We}var ke={exports:{}},Jt;function J(){return Jt||(Jt=1,typeof Object.create=="function"?ke.exports=function(x,T){T&&(x.super_=T,x.prototype=Object.create(T.prototype,{constructor:{value:x,enumerable:!1,writable:!0,configurable:!0}}))}:ke.exports=function(x,T){if(T){x.super_=T;var A=function(){};A.prototype=T.prototype,x.prototype=new A,x.prototype.constructor=x}}),ke.exports}var Ue={},je,Yt;function ni(){if(Yt)return je;Yt=1;function M(){this._listeners={}}return M.prototype.addEventListener=function(x,T){x in this._listeners||(this._listeners[x]=[]);var A=this._listeners[x];A.indexOf(T)===-1&&(A=A.concat([T])),this._listeners[x]=A},M.prototype.removeEventListener=function(x,T){var A=this._listeners[x];if(A){var L=A.indexOf(T);if(L!==-1){A.length>1?this._listeners[x]=A.slice(0,L).concat(A.slice(L+1)):delete this._listeners[x];return}}},M.prototype.dispatchEvent=function(){var x=arguments[0],T=x.type,A=arguments.length===1?[x]:Array.apply(null,arguments);if(this["on"+T]&&this["on"+T].apply(this,A),T in this._listeners)for(var L=this._listeners[T],B=0;B<L.length;B++)L[B].apply(this,A)},je=M,je}var Zt;function te(){if(Zt)return Ue;Zt=1;var M=J(),x=ni();function T(){x.call(this)}return M(T,x),T.prototype.removeAllListeners=function(A){A?delete this._listeners[A]:this._listeners={}},T.prototype.once=function(A,L){var B=this,y=!1;function i(){B.removeListener(A,i),y||(y=!0,L.apply(this,arguments))}this.on(A,i)},T.prototype.emit=function(){var A=arguments[0],L=this._listeners[A];if(L){for(var B=arguments.length,y=new Array(B-1),i=1;i<B;i++)y[i-1]=arguments[i];for(var o=0;o<L.length;o++)L[o].apply(this,y)}},T.prototype.on=T.prototype.addListener=x.prototype.addEventListener,T.prototype.removeListener=x.prototype.removeEventListener,Ue.EventEmitter=T,Ue}var xe={exports:{}},Qt;function wi(){if(Qt)return xe.exports;Qt=1;var M=q.WebSocket||q.MozWebSocket;return M?xe.exports=function(T){return new M(T)}:xe.exports=void 0,xe.exports}var qe,er;function Ei(){if(er)return qe;er=1;var M=he(),x=se(),T=J(),A=te().EventEmitter,L=wi(),B=function(){};function y(i,o,a){if(!y.enabled())throw new Error("Transport created when disabled");A.call(this);var c=this,n=x.addPath(i,"/websocket");n.slice(0,5)==="https"?n="wss"+n.slice(5):n="ws"+n.slice(4),this.url=n,this.ws=new L(this.url,[],a),this.ws.onmessage=function(d){B("message event",d.data),c.emit("message",d.data)},this.unloadRef=M.unloadAdd(function(){c.ws.close()}),this.ws.onclose=function(d){B("close event",d.code,d.reason),c.emit("close",d.code,d.reason),c._cleanup()},this.ws.onerror=function(d){c.emit("close",1006,"WebSocket connection broken"),c._cleanup()}}return T(y,A),y.prototype.send=function(i){var o="["+i+"]";this.ws.send(o)},y.prototype.close=function(){var i=this.ws;this._cleanup(),i&&i.close()},y.prototype._cleanup=function(){var i=this.ws;i&&(i.onmessage=i.onclose=i.onerror=null),M.unloadDel(this.unloadRef),this.unloadRef=this.ws=null,this.removeAllListeners()},y.enabled=function(){return!!L},y.transportName="websocket",y.roundTrips=2,qe=y,qe}var $e,tr;function ki(){if(tr)return $e;tr=1;var M=J(),x=te().EventEmitter,T=function(){};function A(L,B){x.call(this),this.sendBuffer=[],this.sender=B,this.url=L}return M(A,x),A.prototype.send=function(L){this.sendBuffer.push(L),this.sendStop||this.sendSchedule()},A.prototype.sendScheduleWait=function(){var L=this,B;this.sendStop=function(){L.sendStop=null,clearTimeout(B)},B=setTimeout(function(){L.sendStop=null,L.sendSchedule()},25)},A.prototype.sendSchedule=function(){T("sendSchedule",this.sendBuffer.length);var L=this;if(this.sendBuffer.length>0){var B="["+this.sendBuffer.join(",")+"]";this.sendStop=this.sender(this.url,B,function(y){L.sendStop=null,y?(L.emit("close",y.code||1006,"Sending error: "+y),L.close()):L.sendScheduleWait()}),this.sendBuffer=[]}},A.prototype._cleanup=function(){this.removeAllListeners()},A.prototype.close=function(){this._cleanup(),this.sendStop&&(this.sendStop(),this.sendStop=null)},$e=A,$e}var ze,rr;function xi(){if(rr)return ze;rr=1;var M=J(),x=te().EventEmitter,T=function(){};function A(L,B,y){x.call(this),this.Receiver=L,this.receiveUrl=B,this.AjaxObject=y,this._scheduleReceiver()}return M(A,x),A.prototype._scheduleReceiver=function(){var L=this,B=this.poll=new this.Receiver(this.receiveUrl,this.AjaxObject);B.on("message",function(y){L.emit("message",y)}),B.once("close",function(y,i){T("close",y,i,L.pollIsClosing),L.poll=B=null,L.pollIsClosing||(i==="network"?L._scheduleReceiver():(L.emit("close",y||1006,i),L.removeAllListeners()))})},A.prototype.abort=function(){this.removeAllListeners(),this.pollIsClosing=!0,this.poll&&this.poll.abort()},ze=A,ze}var Ke,ir;function oi(){if(ir)return Ke;ir=1;var M=J(),x=se(),T=ki(),A=xi();function L(B,y,i,o,a){var c=x.addPath(B,y),n=this;T.call(this,B,i),this.poll=new A(o,c,a),this.poll.on("message",function(d){n.emit("message",d)}),this.poll.once("close",function(d,_){n.poll=null,n.emit("close",d,_),n.close()})}return M(L,T),L.prototype.close=function(){T.prototype.close.call(this),this.removeAllListeners(),this.poll&&(this.poll.abort(),this.poll=null)},Ke=L,Ke}var Xe,sr;function ue(){if(sr)return Xe;sr=1;var M=J(),x=se(),T=oi();function A(B){return function(y,i,o){var a={};typeof i=="string"&&(a.headers={"Content-type":"text/plain"});var c=x.addPath(y,"/xhr_send"),n=new B("POST",c,i,a);return n.once("finish",function(d){if(n=null,d!==200&&d!==204)return o(new Error("http status "+d));o()}),function(){n.close(),n=null;var d=new Error("Aborted");d.code=1e3,o(d)}}}function L(B,y,i,o){T.call(this,B,y,A(o),i,o)}return M(L,T),Xe=L,Xe}var Ve,nr;function Le(){if(nr)return Ve;nr=1;var M=J(),x=te().EventEmitter;function T(A,L){x.call(this);var B=this;this.bufferPosition=0,this.xo=new L("POST",A,null),this.xo.on("chunk",this._chunkHandler.bind(this)),this.xo.once("finish",function(y,i){B._chunkHandler(y,i),B.xo=null;var o=y===200?"network":"permanent";B.emit("close",null,o),B._cleanup()})}return M(T,x),T.prototype._chunkHandler=function(A,L){if(!(A!==200||!L))for(var B=-1;;this.bufferPosition+=B+1){var y=L.slice(this.bufferPosition);if(B=y.indexOf(`
`),B===-1)break;var i=y.slice(0,B);i&&this.emit("message",i)}},T.prototype._cleanup=function(){this.removeAllListeners()},T.prototype.abort=function(){this.xo&&(this.xo.close(),this.emit("close",null,"user"),this.xo=null),this._cleanup()},Ve=T,Ve}var Ge,or;function ai(){if(or)return Ge;or=1;var M=te().EventEmitter,x=J(),T=he(),A=se(),L=q.XMLHttpRequest,B=function(){};function y(a,c,n,d){var _=this;M.call(this),setTimeout(function(){_._start(a,c,n,d)},0)}x(y,M),y.prototype._start=function(a,c,n,d){var _=this;try{this.xhr=new L}catch{}if(!this.xhr){this.emit("finish",0,"no xhr support"),this._cleanup();return}c=A.addQuery(c,"t="+ +new Date),this.unloadRef=T.unloadAdd(function(){_._cleanup(!0)});try{this.xhr.open(a,c,!0),this.timeout&&"timeout"in this.xhr&&(this.xhr.timeout=this.timeout,this.xhr.ontimeout=function(){B("xhr timeout"),_.emit("finish",0,""),_._cleanup(!1)})}catch{this.emit("finish",0,""),this._cleanup(!1);return}if((!d||!d.noCredentials)&&y.supportsCORS&&(this.xhr.withCredentials=!0),d&&d.headers)for(var m in d.headers)this.xhr.setRequestHeader(m,d.headers[m]);this.xhr.onreadystatechange=function(){if(_.xhr){var f=_.xhr,e,s;switch(B("readyState",f.readyState),f.readyState){case 3:try{s=f.status,e=f.responseText}catch{}s===1223&&(s=204),s===200&&e&&e.length>0&&_.emit("chunk",s,e);break;case 4:s=f.status,s===1223&&(s=204),(s===12005||s===12029)&&(s=0),B("finish",s,f.responseText),_.emit("finish",s,f.responseText),_._cleanup(!1);break}}};try{_.xhr.send(n)}catch{_.emit("finish",0,""),_._cleanup(!1)}},y.prototype._cleanup=function(a){if(this.xhr){if(this.removeAllListeners(),T.unloadDel(this.unloadRef),this.xhr.onreadystatechange=function(){},this.xhr.ontimeout&&(this.xhr.ontimeout=null),a)try{this.xhr.abort()}catch{}this.unloadRef=this.xhr=null}},y.prototype.close=function(){this._cleanup(!0)},y.enabled=!!L;var i=["Active"].concat("Object").join("X");!y.enabled&&i in q&&(L=function(){try{return new q[i]("Microsoft.XMLHTTP")}catch{return null}},y.enabled=!!new L);var o=!1;try{o="withCredentials"in new L}catch{}return y.supportsCORS=o,Ge=y,Ge}var Je,ar;function De(){if(ar)return Je;ar=1;var M=J(),x=ai();function T(A,L,B,y){x.call(this,A,L,B,y)}return M(T,x),T.enabled=x.enabled&&x.supportsCORS,Je=T,Je}var Ye,hr;function Se(){if(hr)return Ye;hr=1;var M=J(),x=ai();function T(A,L,B){x.call(this,A,L,B,{noCredentials:!0})}return M(T,x),T.enabled=x.enabled,Ye=T,Ye}var Ze,lr;function be(){return lr||(lr=1,Ze={isOpera:function(){return q.navigator&&/opera/i.test(q.navigator.userAgent)},isKonqueror:function(){return q.navigator&&/konqueror/i.test(q.navigator.userAgent)},hasDomain:function(){if(!q.document)return!0;try{return!!q.document.domain}catch{return!1}}}),Ze}var Qe,cr;function Ri(){if(cr)return Qe;cr=1;var M=J(),x=ue(),T=Le(),A=De(),L=Se(),B=be();function y(i){if(!L.enabled&&!A.enabled)throw new Error("Transport created when disabled");x.call(this,i,"/xhr_streaming",T,A)}return M(y,x),y.enabled=function(i){return i.nullOrigin||B.isOpera()?!1:A.enabled},y.transportName="xhr-streaming",y.roundTrips=2,y.needBody=!!q.document,Qe=y,Qe}var et,ur;function Wt(){if(ur)return et;ur=1;var M=te().EventEmitter,x=J(),T=he(),A=be(),L=se(),B=function(){};function y(i,o,a){var c=this;M.call(this),setTimeout(function(){c._start(i,o,a)},0)}return x(y,M),y.prototype._start=function(i,o,a){var c=this,n=new q.XDomainRequest;o=L.addQuery(o,"t="+ +new Date),n.onerror=function(){c._error()},n.ontimeout=function(){c._error()},n.onprogress=function(){B("progress",n.responseText),c.emit("chunk",200,n.responseText)},n.onload=function(){c.emit("finish",200,n.responseText),c._cleanup(!1)},this.xdr=n,this.unloadRef=T.unloadAdd(function(){c._cleanup(!0)});try{this.xdr.open(i,o),this.timeout&&(this.xdr.timeout=this.timeout),this.xdr.send(a)}catch{this._error()}},y.prototype._error=function(){this.emit("finish",0,""),this._cleanup(!1)},y.prototype._cleanup=function(i){if(this.xdr){if(this.removeAllListeners(),T.unloadDel(this.unloadRef),this.xdr.ontimeout=this.xdr.onerror=this.xdr.onprogress=this.xdr.onload=null,i)try{this.xdr.abort()}catch{}this.unloadRef=this.xdr=null}},y.prototype.close=function(){this._cleanup(!0)},y.enabled=!!(q.XDomainRequest&&A.hasDomain()),et=y,et}var tt,dr;function hi(){if(dr)return tt;dr=1;var M=J(),x=ue(),T=Le(),A=Wt();function L(B){if(!A.enabled)throw new Error("Transport created when disabled");x.call(this,B,"/xhr_streaming",T,A)}return M(L,x),L.enabled=function(B){return B.cookie_needed||B.nullOrigin?!1:A.enabled&&B.sameScheme},L.transportName="xdr-streaming",L.roundTrips=2,tt=L,tt}var rt,fr;function li(){return fr||(fr=1,rt=q.EventSource),rt}var it,_r;function Li(){if(_r)return it;_r=1;var M=J(),x=te().EventEmitter,T=li(),A=function(){};function L(B){x.call(this);var y=this,i=this.es=new T(B);i.onmessage=function(o){A("message",o.data),y.emit("message",decodeURI(o.data))},i.onerror=function(o){A("error",i.readyState);var a=i.readyState!==2?"network":"permanent";y._cleanup(),y._close(a)}}return M(L,x),L.prototype.abort=function(){this._cleanup(),this._close("user")},L.prototype._cleanup=function(){var B=this.es;B&&(B.onmessage=B.onerror=null,B.close(),this.es=null)},L.prototype._close=function(B){var y=this;setTimeout(function(){y.emit("close",null,B),y.removeAllListeners()},200)},it=L,it}var st,vr;function pr(){if(vr)return st;vr=1;var M=J(),x=ue(),T=Li(),A=De(),L=li();function B(y){if(!B.enabled())throw new Error("Transport created when disabled");x.call(this,y,"/eventsource",T,A)}return M(B,x),B.enabled=function(){return!!L},B.transportName="eventsource",B.roundTrips=2,st=B,st}var nt,gr;function ci(){return gr||(gr=1,nt="1.6.1"),nt}var ot={exports:{}},mr;function Ce(){return mr||(mr=1,function(M){var x=he(),T=be();M.exports={WPrefix:"_jp",currentWindowId:null,polluteGlobalNamespace:function(){M.exports.WPrefix in q||(q[M.exports.WPrefix]={})},postMessage:function(A,L){q.parent!==q&&q.parent.postMessage(JSON.stringify({windowId:M.exports.currentWindowId,type:A,data:L||""}),"*")},createIframe:function(A,L){var B=q.document.createElement("iframe"),y,i,o=function(){clearTimeout(y);try{B.onload=null}catch{}B.onerror=null},a=function(){B&&(o(),setTimeout(function(){B&&B.parentNode.removeChild(B),B=null},0),x.unloadDel(i))},c=function(d){B&&(a(),L(d))},n=function(d,_){setTimeout(function(){try{B&&B.contentWindow&&B.contentWindow.postMessage(d,_)}catch{}},0)};return B.src=A,B.style.display="none",B.style.position="absolute",B.onerror=function(){c("onerror")},B.onload=function(){clearTimeout(y),y=setTimeout(function(){c("onload timeout")},2e3)},q.document.body.appendChild(B),y=setTimeout(function(){c("timeout")},15e3),i=x.unloadAdd(a),{post:n,cleanup:a,loaded:o}},createHtmlfile:function(A,L){var B=["Active"].concat("Object").join("X"),y=new q[B]("htmlfile"),i,o,a,c=function(){clearTimeout(i),a.onerror=null},n=function(){y&&(c(),x.unloadDel(o),a.parentNode.removeChild(a),a=y=null,CollectGarbage())},d=function(f){y&&(n(),L(f))},_=function(f,e){try{setTimeout(function(){a&&a.contentWindow&&a.contentWindow.postMessage(f,e)},0)}catch{}};y.open(),y.write('<html><script>document.domain="'+q.document.domain+'";<\/script></html>'),y.close(),y.parentWindow[M.exports.WPrefix]=q[M.exports.WPrefix];var m=y.createElement("div");return y.body.appendChild(m),a=y.createElement("iframe"),m.appendChild(a),a.src=A,a.onerror=function(){d("onerror")},i=setTimeout(function(){d("timeout")},15e3),o=x.unloadAdd(n),{post:_,cleanup:n,loaded:c}}},M.exports.iframeEnabled=!1,q.document&&(M.exports.iframeEnabled=(typeof q.postMessage=="function"||typeof q.postMessage=="object")&&!T.isKonqueror())}(ot)),ot.exports}var at,Sr;function ui(){if(Sr)return at;Sr=1;var M=J(),x=te().EventEmitter,T=ci(),A=se(),L=Ce(),B=he(),y=ce(),i=function(){};function o(a,c,n){if(!o.enabled())throw new Error("Transport created when disabled");x.call(this);var d=this;this.origin=A.getOrigin(n),this.baseUrl=n,this.transUrl=c,this.transport=a,this.windowId=y.string(8);var _=A.addPath(n,"/iframe.html")+"#"+this.windowId;this.iframeObj=L.createIframe(_,function(m){d.emit("close",1006,"Unable to load an iframe ("+m+")"),d.close()}),this.onmessageCallback=this._message.bind(this),B.attachEvent("message",this.onmessageCallback)}return M(o,x),o.prototype.close=function(){if(this.removeAllListeners(),this.iframeObj){B.detachEvent("message",this.onmessageCallback);try{this.postMessage("c")}catch{}this.iframeObj.cleanup(),this.iframeObj=null,this.onmessageCallback=this.iframeObj=null}},o.prototype._message=function(a){if(i("message",a.data),!A.isOriginEqual(a.origin,this.origin)){i("not same origin",a.origin,this.origin);return}var c;try{c=JSON.parse(a.data)}catch{i("bad json",a.data);return}if(c.windowId!==this.windowId){i("mismatched window id",c.windowId,this.windowId);return}switch(c.type){case"s":this.iframeObj.loaded(),this.postMessage("s",JSON.stringify([T,this.transport,this.transUrl,this.baseUrl]));break;case"t":this.emit("message",c.data);break;case"c":var n;try{n=JSON.parse(c.data)}catch{i("bad json",c.data);return}this.emit("close",n[0],n[1]),this.close();break}},o.prototype.postMessage=function(a,c){this.iframeObj.post(JSON.stringify({windowId:this.windowId,type:a,data:c||""}),this.origin)},o.prototype.send=function(a){this.postMessage("m",a)},o.enabled=function(){return L.iframeEnabled},o.transportName="iframe",o.roundTrips=2,at=o,at}var ht,br;function Ut(){return br||(br=1,ht={isObject:function(M){var x=typeof M;return x==="function"||x==="object"&&!!M},extend:function(M){if(!this.isObject(M))return M;for(var x,T,A=1,L=arguments.length;A<L;A++){x=arguments[A];for(T in x)Object.prototype.hasOwnProperty.call(x,T)&&(M[T]=x[T])}return M}}),ht}var lt,Cr;function ct(){if(Cr)return lt;Cr=1;var M=J(),x=ui(),T=Ut();return lt=function(A){function L(B,y){x.call(this,A.transportName,B,y)}return M(L,x),L.enabled=function(B,y){if(!q.document)return!1;var i=T.extend({},y);return i.sameOrigin=!0,A.enabled(i)&&x.enabled()},L.transportName="iframe-"+A.transportName,L.needBody=!0,L.roundTrips=x.roundTrips+A.roundTrips-1,L.facadeTransport=A,L},lt}var ut,yr;function Di(){if(yr)return ut;yr=1;var M=J(),x=Ce(),T=se(),A=te().EventEmitter,L=ce(),B=function(){};function y(o){A.call(this);var a=this;x.polluteGlobalNamespace(),this.id="a"+L.string(6),o=T.addQuery(o,"c="+decodeURIComponent(x.WPrefix+"."+this.id)),B("using htmlfile",y.htmlfileEnabled);var c=y.htmlfileEnabled?x.createHtmlfile:x.createIframe;q[x.WPrefix][this.id]={start:function(){a.iframeObj.loaded()},message:function(n){a.emit("message",n)},stop:function(){a._cleanup(),a._close("network")}},this.iframeObj=c(o,function(){a._cleanup(),a._close("permanent")})}M(y,A),y.prototype.abort=function(){this._cleanup(),this._close("user")},y.prototype._cleanup=function(){this.iframeObj&&(this.iframeObj.cleanup(),this.iframeObj=null),delete q[x.WPrefix][this.id]},y.prototype._close=function(o){this.emit("close",null,o),this.removeAllListeners()},y.htmlfileEnabled=!1;var i=["Active"].concat("Object").join("X");if(i in q)try{y.htmlfileEnabled=!!new q[i]("htmlfile")}catch{}return y.enabled=y.htmlfileEnabled||x.iframeEnabled,ut=y,ut}var dt,wr;function Er(){if(wr)return dt;wr=1;var M=J(),x=Di(),T=Se(),A=ue();function L(B){if(!x.enabled)throw new Error("Transport created when disabled");A.call(this,B,"/htmlfile",x,T)}return M(L,A),L.enabled=function(B){return x.enabled&&B.sameOrigin},L.transportName="htmlfile",L.roundTrips=2,dt=L,dt}var ft,kr;function xr(){if(kr)return ft;kr=1;var M=J(),x=ue(),T=Le(),A=De(),L=Se();function B(y){if(!L.enabled&&!A.enabled)throw new Error("Transport created when disabled");x.call(this,y,"/xhr",T,A)}return M(B,x),B.enabled=function(y){return y.nullOrigin?!1:L.enabled&&y.sameOrigin?!0:A.enabled},B.transportName="xhr-polling",B.roundTrips=2,ft=B,ft}var _t,Rr;function Ai(){if(Rr)return _t;Rr=1;var M=J(),x=ue(),T=hi(),A=Le(),L=Wt();function B(y){if(!L.enabled)throw new Error("Transport created when disabled");x.call(this,y,"/xhr",A,L)}return M(B,x),B.enabled=T.enabled,B.transportName="xdr-polling",B.roundTrips=2,_t=B,_t}var vt,Lr;function Ti(){if(Lr)return vt;Lr=1;var M=Ce(),x=ce(),T=be(),A=se(),L=J(),B=te().EventEmitter,y=function(){};function i(o){var a=this;B.call(this),M.polluteGlobalNamespace(),this.id="a"+x.string(6);var c=A.addQuery(o,"c="+encodeURIComponent(M.WPrefix+"."+this.id));q[M.WPrefix][this.id]=this._callback.bind(this),this._createScript(c),this.timeoutId=setTimeout(function(){a._abort(new Error("JSONP script loaded abnormally (timeout)"))},i.timeout)}return L(i,B),i.prototype.abort=function(){if(q[M.WPrefix][this.id]){var o=new Error("JSONP user aborted read");o.code=1e3,this._abort(o)}},i.timeout=35e3,i.scriptErrorTimeout=1e3,i.prototype._callback=function(o){this._cleanup(),!this.aborting&&(o&&this.emit("message",o),this.emit("close",null,"network"),this.removeAllListeners())},i.prototype._abort=function(o){this._cleanup(),this.aborting=!0,this.emit("close",o.code,o.message),this.removeAllListeners()},i.prototype._cleanup=function(){if(clearTimeout(this.timeoutId),this.script2&&(this.script2.parentNode.removeChild(this.script2),this.script2=null),this.script){var o=this.script;o.parentNode.removeChild(o),o.onreadystatechange=o.onerror=o.onload=o.onclick=null,this.script=null}delete q[M.WPrefix][this.id]},i.prototype._scriptError=function(){var o=this;this.errorTimer||(this.errorTimer=setTimeout(function(){o.loadedOkay||o._abort(new Error("JSONP script loaded abnormally (onerror)"))},i.scriptErrorTimeout))},i.prototype._createScript=function(o){var a=this,c=this.script=q.document.createElement("script"),n;if(c.id="a"+x.string(8),c.src=o,c.type="text/javascript",c.charset="UTF-8",c.onerror=this._scriptError.bind(this),c.onload=function(){a._abort(new Error("JSONP script loaded abnormally (onload)"))},c.onreadystatechange=function(){if(y("onreadystatechange",c.readyState),/loaded|closed/.test(c.readyState)){if(c&&c.htmlFor&&c.onclick){a.loadedOkay=!0;try{c.onclick()}catch{}}c&&a._abort(new Error("JSONP script loaded abnormally (onreadystatechange)"))}},typeof c.async>"u"&&q.document.attachEvent)if(T.isOpera())n=this.script2=q.document.createElement("script"),n.text="try{var a = document.getElementById('"+c.id+"'); if(a)a.onerror();}catch(x){};",c.async=n.async=!1;else{try{c.htmlFor=c.id,c.event="onclick"}catch{}c.async=!0}typeof c.async<"u"&&(c.async=!0);var d=q.document.getElementsByTagName("head")[0];d.insertBefore(c,d.firstChild),n&&d.insertBefore(n,d.firstChild)},vt=i,vt}var pt,Dr;function Bi(){if(Dr)return pt;Dr=1;var M=ce(),x=se(),T=function(){},A,L;function B(i){try{return q.document.createElement('<iframe name="'+i+'">')}catch{var o=q.document.createElement("iframe");return o.name=i,o}}function y(){A=q.document.createElement("form"),A.style.display="none",A.style.position="absolute",A.method="POST",A.enctype="application/x-www-form-urlencoded",A.acceptCharset="UTF-8",L=q.document.createElement("textarea"),L.name="d",A.appendChild(L),q.document.body.appendChild(A)}return pt=function(i,o,a){A||y();var c="a"+M.string(8);A.target=c,A.action=x.addQuery(x.addPath(i,"/jsonp_send"),"i="+c);var n=B(c);n.id=c,n.style.display="none",A.appendChild(n);try{L.value=o}catch{}A.submit();var d=function(_){n.onerror&&(n.onreadystatechange=n.onerror=n.onload=null,setTimeout(function(){n.parentNode.removeChild(n),n=null},500),L.value="",a(_))};return n.onerror=function(){d()},n.onload=function(){d()},n.onreadystatechange=function(_){T("onreadystatechange",c,n.readyState),n.readyState==="complete"&&d()},function(){d(new Error("Aborted"))}},pt}var gt,Ar;function Oi(){if(Ar)return gt;Ar=1;var M=J(),x=oi(),T=Ti(),A=Bi();function L(B){if(!L.enabled())throw new Error("Transport created when disabled");x.call(this,B,"/jsonp",A,T)}return M(L,x),L.enabled=function(){return!!q.document},L.transportName="jsonp-polling",L.roundTrips=1,L.needBody=!0,gt=L,gt}var mt,Tr;function Mi(){return Tr||(Tr=1,mt=[Ei(),Ri(),hi(),pr(),ct()(pr()),Er(),ct()(Er()),xr(),Ai(),ct()(xr()),Oi()]),mt}var Br={},Or;function Ii(){if(Or)return Br;Or=1;var M=Array.prototype,x=Object.prototype,T=Function.prototype,A=String.prototype,L=M.slice,B=x.toString,y=function(g){return x.toString.call(g)==="[object Function]"},i=function(l){return B.call(l)==="[object Array]"},o=function(l){return B.call(l)==="[object String]"},a=Object.defineProperty&&function(){try{return Object.defineProperty({},"x",{}),!0}catch{return!1}}(),c;a?c=function(g,l,v,C){!C&&l in g||Object.defineProperty(g,l,{configurable:!0,enumerable:!1,writable:!0,value:v})}:c=function(g,l,v,C){!C&&l in g||(g[l]=v)};var n=function(g,l,v){for(var C in l)x.hasOwnProperty.call(l,C)&&c(g,C,l[C],v)},d=function(g){if(g==null)throw new TypeError("can't convert "+g+" to object");return Object(g)};function _(g){var l=+g;return l!==l?l=0:l!==0&&l!==1/0&&l!==-1/0&&(l=(l>0||-1)*Math.floor(Math.abs(l))),l}function m(g){return g>>>0}function f(){}n(T,{bind:function(l){var v=this;if(!y(v))throw new TypeError("Function.prototype.bind called on incompatible "+v);for(var C=L.call(arguments,1),k=function(){if(this instanceof H){var W=v.apply(this,C.concat(L.call(arguments)));return Object(W)===W?W:this}else return v.apply(l,C.concat(L.call(arguments)))},E=Math.max(0,v.length-C.length),w=[],P=0;P<E;P++)w.push("$"+P);var H=Function("binder","return function ("+w.join(",")+"){ return binder.apply(this, arguments); }")(k);return v.prototype&&(f.prototype=v.prototype,H.prototype=new f,f.prototype=null),H}}),n(Array,{isArray:i});var e=Object("a"),s=e[0]!=="a"||!(0 in e),t=function(l){var v=!0,C=!0;return l&&(l.call("foo",function(k,E,w){typeof w!="object"&&(v=!1)}),l.call([1],function(){C=typeof this=="string"},"x")),!!l&&v&&C};n(M,{forEach:function(l){var v=d(this),C=s&&o(this)?this.split(""):v,k=arguments[1],E=-1,w=C.length>>>0;if(!y(l))throw new TypeError;for(;++E<w;)E in C&&l.call(k,C[E],E,v)}},!t(M.forEach));var r=Array.prototype.indexOf&&[0,1].indexOf(1,2)!==-1;n(M,{indexOf:function(l){var v=s&&o(this)?this.split(""):d(this),C=v.length>>>0;if(!C)return-1;var k=0;for(arguments.length>1&&(k=_(arguments[1])),k=k>=0?k:Math.max(0,C+k);k<C;k++)if(k in v&&v[k]===l)return k;return-1}},r);var h=A.split;"ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1?function(){var g=/()??/.exec("")[1]===void 0;A.split=function(l,v){var C=this;if(l===void 0&&v===0)return[];if(B.call(l)!=="[object RegExp]")return h.call(this,l,v);var k=[],E=(l.ignoreCase?"i":"")+(l.multiline?"m":"")+(l.extended?"x":"")+(l.sticky?"y":""),w=0,P,H,W,U;for(l=new RegExp(l.source,E+"g"),C+="",g||(P=new RegExp("^"+l.source+"$(?!\\s)",E)),v=v===void 0?-1>>>0:m(v);(H=l.exec(C))&&(W=H.index+H[0].length,!(W>w&&(k.push(C.slice(w,H.index)),!g&&H.length>1&&H[0].replace(P,function(){for(var S=1;S<arguments.length-2;S++)arguments[S]===void 0&&(H[S]=void 0)}),H.length>1&&H.index<C.length&&M.push.apply(k,H.slice(1)),U=H[0].length,w=W,k.length>=v)));)l.lastIndex===H.index&&l.lastIndex++;return w===C.length?(U||!l.test(""))&&k.push(""):k.push(C.slice(w)),k.length>v?k.slice(0,v):k}}():"0".split(void 0,0).length&&(A.split=function(l,v){return l===void 0&&v===0?[]:h.call(this,l,v)});var u=A.substr,p="".substr&&"0b".substr(-1)!=="b";return n(A,{substr:function(l,v){return u.call(this,l<0&&(l=this.length+l)<0?0:l,v)}},p),Br}var St,Mr;function Pi(){if(Mr)return St;Mr=1;var M=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,x,T=function(A){var L,B={},y=[];for(L=0;L<65536;L++)y.push(String.fromCharCode(L));return A.lastIndex=0,y.join("").replace(A,function(i){return B[i]="\\u"+("0000"+i.charCodeAt(0).toString(16)).slice(-4),""}),A.lastIndex=0,B};return St={quote:function(A){var L=JSON.stringify(A);return M.lastIndex=0,M.test(L)?(x||(x=T(M)),L.replace(M,function(B){return x[B]})):L}},St}var bt,Ir;function Hi(){if(Ir)return bt;Ir=1;var M=function(){};return bt=function(x){return{filterToEnabled:function(T,A){var L={main:[],facade:[]};return T?typeof T=="string"&&(T=[T]):T=[],x.forEach(function(B){if(B&&!(B.transportName==="websocket"&&A.websocket===!1)){if(T.length&&T.indexOf(B.transportName)===-1){M("not in whitelist",B.transportName);return}B.enabled(A)?(M("enabled",B.transportName),L.main.push(B),B.facadeTransport&&L.facade.push(B.facadeTransport)):M("disabled",B.transportName)}}),L}}},bt}var Ct,Pr;function Fi(){if(Pr)return Ct;Pr=1;var M={};return["log","debug","warn"].forEach(function(x){var T;try{T=q.console&&q.console[x]&&q.console[x].apply}catch{}M[x]=T?function(){return q.console[x].apply(q.console,arguments)}:x==="log"?function(){}:M.log}),Ct=M,Ct}var yt,Hr;function jt(){if(Hr)return yt;Hr=1;function M(x){this.type=x}return M.prototype.initEvent=function(x,T,A){return this.type=x,this.bubbles=T,this.cancelable=A,this.timeStamp=+new Date,this},M.prototype.stopPropagation=function(){},M.prototype.preventDefault=function(){},M.CAPTURING_PHASE=1,M.AT_TARGET=2,M.BUBBLING_PHASE=3,yt=M,yt}var wt,Fr;function di(){return Fr||(Fr=1,wt=q.location||{origin:"http://localhost:80",protocol:"http:",host:"localhost",port:80,href:"http://localhost/",hash:""}),wt}var Et,Nr;function Ni(){if(Nr)return Et;Nr=1;var M=J(),x=jt();function T(){x.call(this),this.initEvent("close",!1,!1),this.wasClean=!1,this.code=0,this.reason=""}return M(T,x),Et=T,Et}var kt,Wr;function Wi(){if(Wr)return kt;Wr=1;var M=J(),x=jt();function T(A){x.call(this),this.initEvent("message",!1,!1),this.data=A}return M(T,x),kt=T,kt}var xt,Ur;function Ui(){if(Ur)return xt;Ur=1;var M=te().EventEmitter,x=J();function T(){var A=this;M.call(this),this.to=setTimeout(function(){A.emit("finish",200,"{}")},T.timeout)}return x(T,M),T.prototype.close=function(){clearTimeout(this.to)},T.timeout=2e3,xt=T,xt}var Rt,jr;function fi(){if(jr)return Rt;jr=1;var M=te().EventEmitter,x=J(),T=Ut();function A(L,B){M.call(this);var y=this,i=+new Date;this.xo=new B("GET",L),this.xo.once("finish",function(o,a){var c,n;if(o===200){if(n=+new Date-i,a)try{c=JSON.parse(a)}catch{}T.isObject(c)||(c={})}y.emit("finish",c,n),y.removeAllListeners()})}return x(A,M),A.prototype.close=function(){this.removeAllListeners(),this.xo.close()},Rt=A,Rt}var Lt,qr;function _i(){if(qr)return Lt;qr=1;var M=J(),x=te().EventEmitter,T=Se(),A=fi();function L(B){var y=this;x.call(this),this.ir=new A(B,T),this.ir.once("finish",function(i,o){y.ir=null,y.emit("message",JSON.stringify([i,o]))})}return M(L,x),L.transportName="iframe-info-receiver",L.prototype.close=function(){this.ir&&(this.ir.close(),this.ir=null),this.removeAllListeners()},Lt=L,Lt}var Dt,$r;function ji(){if($r)return Dt;$r=1;var M=te().EventEmitter,x=J(),T=he(),A=ui(),L=_i();function B(y,i){var o=this;M.call(this);var a=function(){var c=o.ifr=new A(L.transportName,i,y);c.once("message",function(n){if(n){var d;try{d=JSON.parse(n)}catch{o.emit("finish"),o.close();return}var _=d[0],m=d[1];o.emit("finish",_,m)}o.close()}),c.once("close",function(){o.emit("finish"),o.close()})};q.document.body?a():T.attachEvent("load",a)}return x(B,M),B.enabled=function(){return A.enabled()},B.prototype.close=function(){this.ifr&&this.ifr.close(),this.removeAllListeners(),this.ifr=null},Dt=B,Dt}var At,zr;function qi(){if(zr)return At;zr=1;var M=te().EventEmitter,x=J(),T=se(),A=Wt(),L=De(),B=Se(),y=Ui(),i=ji(),o=fi();function a(c,n){var d=this;M.call(this),setTimeout(function(){d.doXhr(c,n)},0)}return x(a,M),a._getReceiver=function(c,n,d){return d.sameOrigin?new o(n,B):L.enabled?new o(n,L):A.enabled&&d.sameScheme?new o(n,A):i.enabled()?new i(c,n):new o(n,y)},a.prototype.doXhr=function(c,n){var d=this,_=T.addPath(c,"/info");this.xo=a._getReceiver(c,_,n),this.timeoutRef=setTimeout(function(){d._cleanup(!1),d.emit("finish")},a.timeout),this.xo.once("finish",function(m,f){d._cleanup(!0),d.emit("finish",m,f)})},a.prototype._cleanup=function(c){clearTimeout(this.timeoutRef),this.timeoutRef=null,!c&&this.xo&&this.xo.close(),this.xo=null},a.prototype.close=function(){this.removeAllListeners(),this._cleanup(!1)},a.timeout=8e3,At=a,At}var Tt,Kr;function $i(){if(Kr)return Tt;Kr=1;var M=Ce();function x(T){this._transport=T,T.on("message",this._transportMessage.bind(this)),T.on("close",this._transportClose.bind(this))}return x.prototype._transportClose=function(T,A){M.postMessage("c",JSON.stringify([T,A]))},x.prototype._transportMessage=function(T){M.postMessage("t",T)},x.prototype._send=function(T){this._transport.send(T)},x.prototype._close=function(){this._transport.close(),this._transport.removeAllListeners()},Tt=x,Tt}var Bt,Xr;function zi(){if(Xr)return Bt;Xr=1;var M=se(),x=he(),T=$i(),A=_i(),L=Ce(),B=di(),y=function(){};return Bt=function(i,o){var a={};o.forEach(function(n){n.facadeTransport&&(a[n.facadeTransport.transportName]=n.facadeTransport)}),a[A.transportName]=A;var c;i.bootstrap_iframe=function(){var n;L.currentWindowId=B.hash.slice(1);var d=function(_){if(_.source===parent&&(typeof c>"u"&&(c=_.origin),_.origin===c)){var m;try{m=JSON.parse(_.data)}catch{y("bad json",_.data);return}if(m.windowId===L.currentWindowId)switch(m.type){case"s":var f;try{f=JSON.parse(m.data)}catch{y("bad json",m.data);break}var e=f[0],s=f[1],t=f[2],r=f[3];if(e!==i.version)throw new Error('Incompatible SockJS! Main site uses: "'+e+'", the iframe: "'+i.version+'".');if(!M.isOriginEqual(t,B.href)||!M.isOriginEqual(r,B.href))throw new Error("Can't connect to different domain from within an iframe. ("+B.href+", "+t+", "+r+")");n=new T(new a[s](t,r));break;case"m":n._send(m.data);break;case"c":n&&n._close(),n=null;break}}};x.attachEvent("message",d),L.postMessage("s")}},Bt}var Ot,Vr;function Ki(){if(Vr)return Ot;Vr=1,Ii();var M=si(),x=J(),T=ce(),A=Pi(),L=se(),B=he(),y=Hi(),i=Ut(),o=be(),a=Fi(),c=jt(),n=ni(),d=di(),_=Ni(),m=Wi(),f=qi(),e=function(){},s;function t(h,u,p){if(!(this instanceof t))return new t(h,u,p);if(arguments.length<1)throw new TypeError("Failed to construct 'SockJS: 1 argument required, but only 0 present");n.call(this),this.readyState=t.CONNECTING,this.extensions="",this.protocol="",p=p||{},p.protocols_whitelist&&a.warn("'protocols_whitelist' is DEPRECATED. Use 'transports' instead."),this._transportsWhitelist=p.transports,this._transportOptions=p.transportOptions||{},this._timeout=p.timeout||0;var g=p.sessionId||8;if(typeof g=="function")this._generateSessionId=g;else if(typeof g=="number")this._generateSessionId=function(){return T.string(g)};else throw new TypeError("If sessionId is used in the options, it needs to be a number or a function.");this._server=p.server||T.numberString(1e3);var l=new M(h);if(!l.host||!l.protocol)throw new SyntaxError("The URL '"+h+"' is invalid");if(l.hash)throw new SyntaxError("The URL must not contain a fragment");if(l.protocol!=="http:"&&l.protocol!=="https:")throw new SyntaxError("The URL's scheme must be either 'http:' or 'https:'. '"+l.protocol+"' is not allowed.");var v=l.protocol==="https:";if(d.protocol==="https:"&&!v&&!L.isLoopbackAddr(l.hostname))throw new Error("SecurityError: An insecure SockJS connection may not be initiated from a page loaded over HTTPS");u?Array.isArray(u)||(u=[u]):u=[];var C=u.sort();C.forEach(function(E,w){if(!E)throw new SyntaxError("The protocols entry '"+E+"' is invalid.");if(w<C.length-1&&E===C[w+1])throw new SyntaxError("The protocols entry '"+E+"' is duplicated.")});var k=L.getOrigin(d.href);this._origin=k?k.toLowerCase():null,l.set("pathname",l.pathname.replace(/\/+$/,"")),this.url=l.href,e("using url",this.url),this._urlInfo={nullOrigin:!o.hasDomain(),sameOrigin:L.isOriginEqual(this.url,d.href),sameScheme:L.isSchemeEqual(this.url,d.href)},this._ir=new f(this.url,this._urlInfo),this._ir.once("finish",this._receiveInfo.bind(this))}x(t,n);function r(h){return h===1e3||h>=3e3&&h<=4999}return t.prototype.close=function(h,u){if(h&&!r(h))throw new Error("InvalidAccessError: Invalid code");if(u&&u.length>123)throw new SyntaxError("reason argument has an invalid length");if(!(this.readyState===t.CLOSING||this.readyState===t.CLOSED)){var p=!0;this._close(h||1e3,u||"Normal closure",p)}},t.prototype.send=function(h){if(typeof h!="string"&&(h=""+h),this.readyState===t.CONNECTING)throw new Error("InvalidStateError: The connection has not been established yet");this.readyState===t.OPEN&&this._transport.send(A.quote(h))},t.version=ci(),t.CONNECTING=0,t.OPEN=1,t.CLOSING=2,t.CLOSED=3,t.prototype._receiveInfo=function(h,u){if(this._ir=null,!h){this._close(1002,"Cannot connect to server");return}this._rto=this.countRTO(u),this._transUrl=h.base_url?h.base_url:this.url,h=i.extend(h,this._urlInfo);var p=s.filterToEnabled(this._transportsWhitelist,h);this._transports=p.main,e(this._transports.length+" enabled transports"),this._connect()},t.prototype._connect=function(){for(var h=this._transports.shift();h;h=this._transports.shift()){if(e("attempt",h.transportName),h.needBody&&(!q.document.body||typeof q.document.readyState<"u"&&q.document.readyState!=="complete"&&q.document.readyState!=="interactive")){this._transports.unshift(h),B.attachEvent("load",this._connect.bind(this));return}var u=Math.max(this._timeout,this._rto*h.roundTrips||5e3);this._transportTimeoutId=setTimeout(this._transportTimeout.bind(this),u);var p=L.addPath(this._transUrl,"/"+this._server+"/"+this._generateSessionId()),g=this._transportOptions[h.transportName],l=new h(p,this._transUrl,g);l.on("message",this._transportMessage.bind(this)),l.once("close",this._transportClose.bind(this)),l.transportName=h.transportName,this._transport=l;return}this._close(2e3,"All transports failed",!1)},t.prototype._transportTimeout=function(){this.readyState===t.CONNECTING&&(this._transport&&this._transport.close(),this._transportClose(2007,"Transport timed out"))},t.prototype._transportMessage=function(h){var u=this,p=h.slice(0,1),g=h.slice(1),l;switch(p){case"o":this._open();return;case"h":this.dispatchEvent(new c("heartbeat")),e("heartbeat",this.transport);return}if(g)try{l=JSON.parse(g)}catch{}if(!(typeof l>"u"))switch(p){case"a":Array.isArray(l)&&l.forEach(function(v){e("message",u.transport),u.dispatchEvent(new m(v))});break;case"m":e("message",this.transport),this.dispatchEvent(new m(l));break;case"c":Array.isArray(l)&&l.length===2&&this._close(l[0],l[1],!0);break}},t.prototype._transportClose=function(h,u){if(e("_transportClose",this.transport),this._transport&&(this._transport.removeAllListeners(),this._transport=null,this.transport=null),!r(h)&&h!==2e3&&this.readyState===t.CONNECTING){this._connect();return}this._close(h,u)},t.prototype._open=function(){e("_open",this._transport&&this._transport.transportName,this.readyState),this.readyState===t.CONNECTING?(this._transportTimeoutId&&(clearTimeout(this._transportTimeoutId),this._transportTimeoutId=null),this.readyState=t.OPEN,this.transport=this._transport.transportName,this.dispatchEvent(new c("open")),e("connected",this.transport)):this._close(1006,"Server lost session")},t.prototype._close=function(h,u,p){e("_close",this.transport,h,u,p,this.readyState);var g=!1;if(this._ir&&(g=!0,this._ir.close(),this._ir=null),this._transport&&(this._transport.close(),this._transport=null,this.transport=null),this.readyState===t.CLOSED)throw new Error("InvalidStateError: SockJS has already been closed");this.readyState=t.CLOSING,setTimeout((function(){this.readyState=t.CLOSED,g&&this.dispatchEvent(new c("error"));var l=new _("close");l.wasClean=p||!1,l.code=h||1e3,l.reason=u,this.dispatchEvent(l),this.onmessage=this.onclose=this.onerror=null}).bind(this),0)},t.prototype.countRTO=function(h){return h>100?4*h:300+h},Ot=function(h){return s=y(h),zi()(t,h),t},Ot}var Mt,Gr;function Xi(){if(Gr)return Mt;Gr=1;var M=Mi();return Mt=Ki()(M),"_sockjs_onload"in q&&setTimeout(q._sockjs_onload,1),Mt}var Vi=Xi();const Gi=mi(Vi);var ge={exports:{}},Re={},Jr;function vi(){return Jr||(Jr=1,function(M){(function(){var x,T,A,L,B={}.hasOwnProperty,y=[].slice;x={LF:`
`,NULL:"\0"},A=function(){var i;function o(a,c,n){this.command=a,this.headers=c??{},this.body=n??""}return o.prototype.toString=function(){var a,c,n,d,_;a=[this.command],n=this.headers["content-length"]===!1,n&&delete this.headers["content-length"],_=this.headers;for(c in _)B.call(_,c)&&(d=_[c],a.push(""+c+":"+d));return this.body&&!n&&a.push("content-length:"+o.sizeOfUTF8(this.body)),a.push(x.LF+this.body),a.join(x.LF)},o.sizeOfUTF8=function(a){return a?encodeURI(a).match(/%..|./g).length:0},i=function(a){var c,n,d,_,m,f,e,s,t,r,h,u,p,g,l,v,C;for(_=a.search(RegExp(""+x.LF+x.LF)),m=a.substring(0,_).split(x.LF),d=m.shift(),f={},u=function(k){return k.replace(/^\s+|\s+$/g,"")},v=m.reverse(),p=0,l=v.length;p<l;p++)r=v[p],s=r.indexOf(":"),f[u(r.substring(0,s))]=u(r.substring(s+1));if(c="",h=_+2,f["content-length"])t=parseInt(f["content-length"]),c=(""+a).substring(h,h+t);else for(n=null,e=g=h,C=a.length;(h<=C?g<C:g>C)&&(n=a.charAt(e),n!==x.NULL);e=h<=C?++g:--g)c+=n;return new o(d,f,c)},o.unmarshall=function(a){var c;return function(){var n,d,_,m;for(_=a.split(RegExp(""+x.NULL+x.LF+"*")),m=[],n=0,d=_.length;n<d;n++)c=_[n],(c!=null?c.length:void 0)>0&&m.push(i(c));return m}()},o.marshall=function(a,c,n){var d;return d=new o(a,c,n),d.toString()+x.NULL},o}(),T=function(){var i;function o(a){this.ws=a,this.ws.binaryType="arraybuffer",this.counter=0,this.connected=!1,this.heartbeat={outgoing:1e4,incoming:1e4},this.maxWebSocketFrameSize=16*1024,this.subscriptions={}}return o.prototype.debug=function(a){var c;return typeof window<"u"&&window!==null&&(c=window.console)!=null?c.log(a):void 0},i=function(){return Date.now?Date.now():new Date().valueOf},o.prototype._transmit=function(a,c,n){var d;for(d=A.marshall(a,c,n),typeof this.debug=="function"&&this.debug(">>> "+d);;)if(d.length>this.maxWebSocketFrameSize)this.ws.send(d.substring(0,this.maxWebSocketFrameSize)),d=d.substring(this.maxWebSocketFrameSize),typeof this.debug=="function"&&this.debug("remaining = "+d.length);else return this.ws.send(d)},o.prototype._setupHeartbeat=function(a){var c,n,d,_,m,f;if(!((m=a.version)!==L.VERSIONS.V1_1&&m!==L.VERSIONS.V1_2)&&(f=function(){var e,s,t,r;for(t=a["heart-beat"].split(","),r=[],e=0,s=t.length;e<s;e++)_=t[e],r.push(parseInt(_));return r}(),n=f[0],c=f[1],this.heartbeat.outgoing===0||c===0||(d=Math.max(this.heartbeat.outgoing,c),typeof this.debug=="function"&&this.debug("send PING every "+d+"ms"),this.pinger=L.setInterval(d,function(e){return function(){return e.ws.send(x.LF),typeof e.debug=="function"?e.debug(">>> PING"):void 0}}(this))),!(this.heartbeat.incoming===0||n===0)))return d=Math.max(this.heartbeat.incoming,n),typeof this.debug=="function"&&this.debug("check PONG every "+d+"ms"),this.ponger=L.setInterval(d,function(e){return function(){var s;if(s=i()-e.serverActivity,s>d*2)return typeof e.debug=="function"&&e.debug("did not receive server activity for the last "+s+"ms"),e.ws.close()}}(this))},o.prototype._parseConnect=function(){var a,c,n,d;switch(a=1<=arguments.length?y.call(arguments,0):[],d={},a.length){case 2:d=a[0],c=a[1];break;case 3:a[1]instanceof Function?(d=a[0],c=a[1],n=a[2]):(d.login=a[0],d.passcode=a[1],c=a[2]);break;case 4:d.login=a[0],d.passcode=a[1],c=a[2],n=a[3];break;default:d.login=a[0],d.passcode=a[1],c=a[2],n=a[3],d.host=a[4]}return[d,c,n]},o.prototype.connect=function(){var a,c,n,d;return a=1<=arguments.length?y.call(arguments,0):[],d=this._parseConnect.apply(this,a),n=d[0],this.connectCallback=d[1],c=d[2],typeof this.debug=="function"&&this.debug("Opening Web Socket..."),this.ws.onmessage=function(_){return function(m){var f,e,s,t,r,h,u,p,g,l,v,C;if(t=typeof ArrayBuffer<"u"&&m.data instanceof ArrayBuffer?(f=new Uint8Array(m.data),typeof _.debug=="function"&&_.debug("--- got data length: "+f.length),function(){var k,E,w;for(w=[],k=0,E=f.length;k<E;k++)e=f[k],w.push(String.fromCharCode(e));return w}().join("")):m.data,_.serverActivity=i(),t===x.LF){typeof _.debug=="function"&&_.debug("<<< PONG");return}for(typeof _.debug=="function"&&_.debug("<<< "+t),v=A.unmarshall(t),C=[],g=0,l=v.length;g<l;g++)switch(r=v[g],r.command){case"CONNECTED":typeof _.debug=="function"&&_.debug("connected to server "+r.headers.server),_.connected=!0,_._setupHeartbeat(r.headers),C.push(typeof _.connectCallback=="function"?_.connectCallback(r):void 0);break;case"MESSAGE":p=r.headers.subscription,u=_.subscriptions[p]||_.onreceive,u?(s=_,h=r.headers["message-id"],r.ack=function(k){return k==null&&(k={}),s.ack(h,p,k)},r.nack=function(k){return k==null&&(k={}),s.nack(h,p,k)},C.push(u(r))):C.push(typeof _.debug=="function"?_.debug("Unhandled received MESSAGE: "+r):void 0);break;case"RECEIPT":C.push(typeof _.onreceipt=="function"?_.onreceipt(r):void 0);break;case"ERROR":C.push(typeof c=="function"?c(r):void 0);break;default:C.push(typeof _.debug=="function"?_.debug("Unhandled frame: "+r):void 0)}return C}}(this),this.ws.onclose=function(_){return function(){var m;return m="Whoops! Lost connection to "+_.ws.url,typeof _.debug=="function"&&_.debug(m),_._cleanUp(),typeof c=="function"?c(m):void 0}}(this),this.ws.onopen=function(_){return function(){return typeof _.debug=="function"&&_.debug("Web Socket Opened..."),n["accept-version"]=L.VERSIONS.supportedVersions(),n["heart-beat"]=[_.heartbeat.outgoing,_.heartbeat.incoming].join(","),_._transmit("CONNECT",n)}}(this)},o.prototype.disconnect=function(a,c){return c==null&&(c={}),this._transmit("DISCONNECT",c),this.ws.onclose=null,this.ws.close(),this._cleanUp(),typeof a=="function"?a():void 0},o.prototype._cleanUp=function(){if(this.connected=!1,this.pinger&&L.clearInterval(this.pinger),this.ponger)return L.clearInterval(this.ponger)},o.prototype.send=function(a,c,n){return c==null&&(c={}),n==null&&(n=""),c.destination=a,this._transmit("SEND",c,n)},o.prototype.subscribe=function(a,c,n){var d;return n==null&&(n={}),n.id||(n.id="sub-"+this.counter++),n.destination=a,this.subscriptions[n.id]=c,this._transmit("SUBSCRIBE",n),d=this,{id:n.id,unsubscribe:function(){return d.unsubscribe(n.id)}}},o.prototype.unsubscribe=function(a){return delete this.subscriptions[a],this._transmit("UNSUBSCRIBE",{id:a})},o.prototype.begin=function(a){var c,n;return n=a||"tx-"+this.counter++,this._transmit("BEGIN",{transaction:n}),c=this,{id:n,commit:function(){return c.commit(n)},abort:function(){return c.abort(n)}}},o.prototype.commit=function(a){return this._transmit("COMMIT",{transaction:a})},o.prototype.abort=function(a){return this._transmit("ABORT",{transaction:a})},o.prototype.ack=function(a,c,n){return n==null&&(n={}),n["message-id"]=a,n.subscription=c,this._transmit("ACK",n)},o.prototype.nack=function(a,c,n){return n==null&&(n={}),n["message-id"]=a,n.subscription=c,this._transmit("NACK",n)},o}(),L={VERSIONS:{V1_0:"1.0",V1_1:"1.1",V1_2:"1.2",supportedVersions:function(){return"1.1,1.0"}},client:function(i,o){var a,c;return o==null&&(o=["v10.stomp","v11.stomp"]),a=L.WebSocketClass||WebSocket,c=new a(i,o),new T(c)},over:function(i){return new T(i)},Frame:A},M!==null&&(M.Stomp=L),typeof window<"u"&&window!==null?(L.setInterval=function(i,o){return window.setInterval(o,i)},L.clearInterval=function(i){return window.clearInterval(i)},window.Stomp=L):M||(self.Stomp=L)}).call(Re)}(Re)),Re}var me={};const Ji={},Yi=Object.freeze(Object.defineProperty({__proto__:null,default:Ji},Symbol.toStringTag,{value:"Module"})),Zi=Si(Yi);var It,Yr;function Qi(){if(Yr)return It;Yr=1;var M=function(){if(typeof self=="object"&&self)return self;if(typeof window=="object"&&window)return window;throw new Error("Unable to resolve global `this`")};return It=function(){if(this)return this;if(typeof globalThis=="object"&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch{return M()}try{return __global__||M()}finally{delete Object.prototype.__global__}}(),It}const es="1.0.35",ts={version:es};var Pt,Zr;function rs(){return Zr||(Zr=1,Pt=ts.version),Pt}var Ht,Qr;function is(){if(Qr)return Ht;Qr=1;var M;if(typeof globalThis=="object")M=globalThis;else try{M=Qi()}catch{}finally{if(!M&&typeof window<"u"&&(M=window),!M)throw new Error("Could not determine global this")}var x=M.WebSocket||M.MozWebSocket,T=rs();function A(L,B){var y;return B?y=new x(L,B):y=new x(L),y}return x&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(L){Object.defineProperty(A,L,{get:function(){return x[L]}})}),Ht={w3cwebsocket:x?A:null,version:T},Ht}var ei;function ss(){return ei||(ei=1,(function(){var M,x,T,A,L,B;M=vi(),x=Zi,M.Stomp.setInterval=function(y,i){return setInterval(i,y)},M.Stomp.clearInterval=function(y){return clearInterval(y)},L=function(y,i){var o,a;return o=null,a={url:"tcp:// "+i+":"+y,send:function(c){return o.write(c)},close:function(){return o.end()}},o=x.connect(y,i,function(c){return a.onopen()}),o.on("error",function(c){return typeof a.onclose=="function"?a.onclose(c):void 0}),o.on("close",function(c){return typeof a.onclose=="function"?a.onclose(c):void 0}),o.on("data",function(c){var n;return n={data:c.toString()},a.onmessage(n)}),a},B=function(y){var i,o,a,c;return i=is().client,o=null,c={url:y,send:function(n){return o.sendUTF(n)},close:function(){return o.close()}},a=new i,a.on("connect",function(n){return o=n,c.onopen(),o.on("error",function(d){return typeof c.onclose=="function"?c.onclose(d):void 0}),o.on("close",function(){return typeof c.onclose=="function"?c.onclose():void 0}),o.on("message",function(d){var _;if(d.type==="utf8")return _={data:d.utf8Data},c.onmessage(_)})}),a.connect(y),c},T=function(y,i){var o;return o=L(i,y),M.Stomp.over(o)},A=function(y){var i;return i=B(y),M.Stomp.over(i)},me.overTCP=T,me.overWS=A}).call(me)),me}var ti;function ns(){if(ti)return ge.exports;ti=1;var M=vi(),x=ss();return ge.exports=M.Stomp,ge.exports.overTCP=x.overTCP,ge.exports.overWS=x.overWS,ge.exports}var os=ns(),Ft={exports:{}},ri;function as(){return ri||(ri=1,function(M,x){(function(T,A){M.exports=A()})(self,()=>(()=>{var T={4567:function(y,i,o){var a=this&&this.__decorate||function(r,h,u,p){var g,l=arguments.length,v=l<3?h:p===null?p=Object.getOwnPropertyDescriptor(h,u):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(r,h,u,p);else for(var C=r.length-1;C>=0;C--)(g=r[C])&&(v=(l<3?g(v):l>3?g(h,u,v):g(h,u))||v);return l>3&&v&&Object.defineProperty(h,u,v),v},c=this&&this.__param||function(r,h){return function(u,p){h(u,p,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.AccessibilityManager=void 0;const n=o(9042),d=o(6114),_=o(9924),m=o(844),f=o(5596),e=o(4725),s=o(3656);let t=i.AccessibilityManager=class extends m.Disposable{constructor(r,h){super(),this._terminal=r,this._renderService=h,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=document.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=document.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let u=0;u<this._terminal.rows;u++)this._rowElements[u]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[u]);if(this._topBoundaryFocusListener=u=>this._handleBoundaryFocus(u,0),this._bottomBoundaryFocusListener=u=>this._handleBoundaryFocus(u,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=document.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new _.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw new Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize(u=>this._handleResize(u.rows))),this.register(this._terminal.onRender(u=>this._refreshRows(u.start,u.end))),this.register(this._terminal.onScroll(()=>this._refreshRows())),this.register(this._terminal.onA11yChar(u=>this._handleChar(u))),this.register(this._terminal.onLineFeed(()=>this._handleChar(`
`))),this.register(this._terminal.onA11yTab(u=>this._handleTab(u))),this.register(this._terminal.onKey(u=>this._handleKey(u.key))),this.register(this._terminal.onBlur(()=>this._clearLiveRegion())),this.register(this._renderService.onDimensionsChange(()=>this._refreshRowsDimensions())),this._screenDprMonitor=new f.ScreenDprMonitor(window),this.register(this._screenDprMonitor),this._screenDprMonitor.setListener(()=>this._refreshRowsDimensions()),this.register((0,s.addDisposableDomListener)(window,"resize",()=>this._refreshRowsDimensions())),this._refreshRows(),this.register((0,m.toDisposable)(()=>{this._accessibilityContainer.remove(),this._rowElements.length=0}))}_handleTab(r){for(let h=0;h<r;h++)this._handleChar(" ")}_handleChar(r){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==r&&(this._charsToAnnounce+=r):this._charsToAnnounce+=r,r===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=n.tooMuchOutput)),d.isMac&&this._liveRegion.textContent&&this._liveRegion.textContent.length>0&&!this._liveRegion.parentNode&&setTimeout(()=>{this._accessibilityContainer.appendChild(this._liveRegion)},0))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0,d.isMac&&this._liveRegion.remove()}_handleKey(r){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(r)||this._charsToConsume.push(r)}_refreshRows(r,h){this._liveRegionDebouncer.refresh(r,h,this._terminal.rows)}_renderRows(r,h){const u=this._terminal.buffer,p=u.lines.length.toString();for(let g=r;g<=h;g++){const l=u.translateBufferLineToString(u.ydisp+g,!0),v=(u.ydisp+g+1).toString(),C=this._rowElements[g];C&&(l.length===0?C.innerText=" ":C.textContent=l,C.setAttribute("aria-posinset",v),C.setAttribute("aria-setsize",p))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(r,h){const u=r.target,p=this._rowElements[h===0?1:this._rowElements.length-2];if(u.getAttribute("aria-posinset")===(h===0?"1":`${this._terminal.buffer.lines.length}`)||r.relatedTarget!==p)return;let g,l;if(h===0?(g=u,l=this._rowElements.pop(),this._rowContainer.removeChild(l)):(g=this._rowElements.shift(),l=u,this._rowContainer.removeChild(g)),g.removeEventListener("focus",this._topBoundaryFocusListener),l.removeEventListener("focus",this._bottomBoundaryFocusListener),h===0){const v=this._createAccessibilityTreeNode();this._rowElements.unshift(v),this._rowContainer.insertAdjacentElement("afterbegin",v)}else{const v=this._createAccessibilityTreeNode();this._rowElements.push(v),this._rowContainer.appendChild(v)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(h===0?-1:1),this._rowElements[h===0?1:this._rowElements.length-2].focus(),r.preventDefault(),r.stopImmediatePropagation()}_handleResize(r){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let h=this._rowContainer.children.length;h<this._terminal.rows;h++)this._rowElements[h]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[h]);for(;this._rowElements.length>r;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){const r=document.createElement("div");return r.setAttribute("role","listitem"),r.tabIndex=-1,this._refreshRowDimensions(r),r}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let r=0;r<this._terminal.rows;r++)this._refreshRowDimensions(this._rowElements[r])}}_refreshRowDimensions(r){r.style.height=`${this._renderService.dimensions.css.cell.height}px`}};i.AccessibilityManager=t=a([c(1,e.IRenderService)],t)},3614:(y,i)=>{function o(d){return d.replace(/\r?\n/g,"\r")}function a(d,_){return _?"\x1B[200~"+d+"\x1B[201~":d}function c(d,_,m,f){d=a(d=o(d),m.decPrivateModes.bracketedPasteMode&&f.rawOptions.ignoreBracketedPasteMode!==!0),m.triggerDataEvent(d,!0),_.value=""}function n(d,_,m){const f=m.getBoundingClientRect(),e=d.clientX-f.left-10,s=d.clientY-f.top-10;_.style.width="20px",_.style.height="20px",_.style.left=`${e}px`,_.style.top=`${s}px`,_.style.zIndex="1000",_.focus()}Object.defineProperty(i,"__esModule",{value:!0}),i.rightClickHandler=i.moveTextAreaUnderMouseCursor=i.paste=i.handlePasteEvent=i.copyHandler=i.bracketTextForPaste=i.prepareTextForTerminal=void 0,i.prepareTextForTerminal=o,i.bracketTextForPaste=a,i.copyHandler=function(d,_){d.clipboardData&&d.clipboardData.setData("text/plain",_.selectionText),d.preventDefault()},i.handlePasteEvent=function(d,_,m,f){d.stopPropagation(),d.clipboardData&&c(d.clipboardData.getData("text/plain"),_,m,f)},i.paste=c,i.moveTextAreaUnderMouseCursor=n,i.rightClickHandler=function(d,_,m,f,e){n(d,_,m),e&&f.rightClickSelect(d),_.value=f.selectionText,_.select()}},7239:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorContrastCache=void 0;const a=o(1505);i.ColorContrastCache=class{constructor(){this._color=new a.TwoKeyMap,this._css=new a.TwoKeyMap}setCss(c,n,d){this._css.set(c,n,d)}getCss(c,n){return this._css.get(c,n)}setColor(c,n,d){this._color.set(c,n,d)}getColor(c,n){return this._color.get(c,n)}clear(){this._color.clear(),this._css.clear()}}},3656:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.addDisposableDomListener=void 0,i.addDisposableDomListener=function(o,a,c,n){o.addEventListener(a,c,n);let d=!1;return{dispose:()=>{d||(d=!0,o.removeEventListener(a,c,n))}}}},6465:function(y,i,o){var a=this&&this.__decorate||function(e,s,t,r){var h,u=arguments.length,p=u<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,r);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(p=(u<3?h(p):u>3?h(s,t,p):h(s,t))||p);return u>3&&p&&Object.defineProperty(s,t,p),p},c=this&&this.__param||function(e,s){return function(t,r){s(t,r,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Linkifier2=void 0;const n=o(3656),d=o(8460),_=o(844),m=o(2585);let f=i.Linkifier2=class extends _.Disposable{get currentLink(){return this._currentLink}constructor(e){super(),this._bufferService=e,this._linkProviders=[],this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new d.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new d.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,_.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,_.toDisposable)(()=>{this._lastMouseEvent=void 0})),this.register(this._bufferService.onResize(()=>{this._clearCurrentLink(),this._wasResized=!0}))}registerLinkProvider(e){return this._linkProviders.push(e),{dispose:()=>{const s=this._linkProviders.indexOf(e);s!==-1&&this._linkProviders.splice(s,1)}}}attachToDom(e,s,t){this._element=e,this._mouseService=s,this._renderService=t,this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",()=>{this._isMouseOut=!0,this._clearCurrentLink()})),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(e){if(this._lastMouseEvent=e,!this._element||!this._mouseService)return;const s=this._positionFromMouseEvent(e,this._element,this._mouseService);if(!s)return;this._isMouseOut=!1;const t=e.composedPath();for(let r=0;r<t.length;r++){const h=t[r];if(h.classList.contains("xterm"))break;if(h.classList.contains("xterm-hover"))return}this._lastBufferCell&&s.x===this._lastBufferCell.x&&s.y===this._lastBufferCell.y||(this._handleHover(s),this._lastBufferCell=s)}_handleHover(e){if(this._activeLine!==e.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(e,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,e)||(this._clearCurrentLink(),this._askForLink(e,!0))}_askForLink(e,s){var t,r;this._activeProviderReplies&&s||((t=this._activeProviderReplies)===null||t===void 0||t.forEach(u=>{u==null||u.forEach(p=>{p.link.dispose&&p.link.dispose()})}),this._activeProviderReplies=new Map,this._activeLine=e.y);let h=!1;for(const[u,p]of this._linkProviders.entries())s?!((r=this._activeProviderReplies)===null||r===void 0)&&r.get(u)&&(h=this._checkLinkProviderResult(u,e,h)):p.provideLinks(e.y,g=>{var l,v;if(this._isMouseOut)return;const C=g==null?void 0:g.map(k=>({link:k}));(l=this._activeProviderReplies)===null||l===void 0||l.set(u,C),h=this._checkLinkProviderResult(u,e,h),((v=this._activeProviderReplies)===null||v===void 0?void 0:v.size)===this._linkProviders.length&&this._removeIntersectingLinks(e.y,this._activeProviderReplies)})}_removeIntersectingLinks(e,s){const t=new Set;for(let r=0;r<s.size;r++){const h=s.get(r);if(h)for(let u=0;u<h.length;u++){const p=h[u],g=p.link.range.start.y<e?0:p.link.range.start.x,l=p.link.range.end.y>e?this._bufferService.cols:p.link.range.end.x;for(let v=g;v<=l;v++){if(t.has(v)){h.splice(u--,1);break}t.add(v)}}}}_checkLinkProviderResult(e,s,t){var r;if(!this._activeProviderReplies)return t;const h=this._activeProviderReplies.get(e);let u=!1;for(let p=0;p<e;p++)this._activeProviderReplies.has(p)&&!this._activeProviderReplies.get(p)||(u=!0);if(!u&&h){const p=h.find(g=>this._linkAtPosition(g.link,s));p&&(t=!0,this._handleNewLink(p))}if(this._activeProviderReplies.size===this._linkProviders.length&&!t)for(let p=0;p<this._activeProviderReplies.size;p++){const g=(r=this._activeProviderReplies.get(p))===null||r===void 0?void 0:r.find(l=>this._linkAtPosition(l.link,s));if(g){t=!0,this._handleNewLink(g);break}}return t}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(e){if(!this._element||!this._mouseService||!this._currentLink)return;const s=this._positionFromMouseEvent(e,this._element,this._mouseService);s&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,s)&&this._currentLink.link.activate(e,this._currentLink.link.text)}_clearCurrentLink(e,s){this._element&&this._currentLink&&this._lastMouseEvent&&(!e||!s||this._currentLink.link.range.start.y>=e&&this._currentLink.link.range.end.y<=s)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,_.disposeArray)(this._linkCacheDisposables))}_handleNewLink(e){if(!this._element||!this._lastMouseEvent||!this._mouseService)return;const s=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);s&&this._linkAtPosition(e.link,s)&&(this._currentLink=e,this._currentLink.state={decorations:{underline:e.link.decorations===void 0||e.link.decorations.underline,pointerCursor:e.link.decorations===void 0||e.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,e.link,this._lastMouseEvent),e.link.decorations={},Object.defineProperties(e.link.decorations,{pointerCursor:{get:()=>{var t,r;return(r=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||r===void 0?void 0:r.decorations.pointerCursor},set:t=>{var r,h;!((r=this._currentLink)===null||r===void 0)&&r.state&&this._currentLink.state.decorations.pointerCursor!==t&&(this._currentLink.state.decorations.pointerCursor=t,this._currentLink.state.isHovered&&((h=this._element)===null||h===void 0||h.classList.toggle("xterm-cursor-pointer",t)))}},underline:{get:()=>{var t,r;return(r=(t=this._currentLink)===null||t===void 0?void 0:t.state)===null||r===void 0?void 0:r.decorations.underline},set:t=>{var r,h,u;!((r=this._currentLink)===null||r===void 0)&&r.state&&((u=(h=this._currentLink)===null||h===void 0?void 0:h.state)===null||u===void 0?void 0:u.decorations.underline)!==t&&(this._currentLink.state.decorations.underline=t,this._currentLink.state.isHovered&&this._fireUnderlineEvent(e.link,t))}}}),this._renderService&&this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange(t=>{if(!this._currentLink)return;const r=t.start===0?0:t.start+1+this._bufferService.buffer.ydisp,h=this._bufferService.buffer.ydisp+1+t.end;if(this._currentLink.link.range.start.y>=r&&this._currentLink.link.range.end.y<=h&&(this._clearCurrentLink(r,h),this._lastMouseEvent&&this._element)){const u=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);u&&this._askForLink(u,!1)}})))}_linkHover(e,s,t){var r;!((r=this._currentLink)===null||r===void 0)&&r.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!0),this._currentLink.state.decorations.pointerCursor&&e.classList.add("xterm-cursor-pointer")),s.hover&&s.hover(t,s.text)}_fireUnderlineEvent(e,s){const t=e.range,r=this._bufferService.buffer.ydisp,h=this._createLinkUnderlineEvent(t.start.x-1,t.start.y-r-1,t.end.x,t.end.y-r-1,void 0);(s?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(h)}_linkLeave(e,s,t){var r;!((r=this._currentLink)===null||r===void 0)&&r.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!1),this._currentLink.state.decorations.pointerCursor&&e.classList.remove("xterm-cursor-pointer")),s.leave&&s.leave(t,s.text)}_linkAtPosition(e,s){const t=e.range.start.y*this._bufferService.cols+e.range.start.x,r=e.range.end.y*this._bufferService.cols+e.range.end.x,h=s.y*this._bufferService.cols+s.x;return t<=h&&h<=r}_positionFromMouseEvent(e,s,t){const r=t.getCoords(e,s,this._bufferService.cols,this._bufferService.rows);if(r)return{x:r[0],y:r[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(e,s,t,r,h){return{x1:e,y1:s,x2:t,y2:r,cols:this._bufferService.cols,fg:h}}};i.Linkifier2=f=a([c(0,m.IBufferService)],f)},9042:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.tooMuchOutput=i.promptLabel=void 0,i.promptLabel="Terminal input",i.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(y,i,o){var a=this&&this.__decorate||function(f,e,s,t){var r,h=arguments.length,u=h<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,s):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(f,e,s,t);else for(var p=f.length-1;p>=0;p--)(r=f[p])&&(u=(h<3?r(u):h>3?r(e,s,u):r(e,s))||u);return h>3&&u&&Object.defineProperty(e,s,u),u},c=this&&this.__param||function(f,e){return function(s,t){e(s,t,f)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkProvider=void 0;const n=o(511),d=o(2585);let _=i.OscLinkProvider=class{constructor(f,e,s){this._bufferService=f,this._optionsService=e,this._oscLinkService=s}provideLinks(f,e){var s;const t=this._bufferService.buffer.lines.get(f-1);if(!t)return void e(void 0);const r=[],h=this._optionsService.rawOptions.linkHandler,u=new n.CellData,p=t.getTrimmedLength();let g=-1,l=-1,v=!1;for(let C=0;C<p;C++)if(l!==-1||t.hasContent(C)){if(t.loadCell(C,u),u.hasExtendedAttrs()&&u.extended.urlId){if(l===-1){l=C,g=u.extended.urlId;continue}v=u.extended.urlId!==g}else l!==-1&&(v=!0);if(v||l!==-1&&C===p-1){const k=(s=this._oscLinkService.getLinkData(g))===null||s===void 0?void 0:s.uri;if(k){const E={start:{x:l+1,y:f},end:{x:C+(v||C!==p-1?0:1),y:f}};let w=!1;if(!(h!=null&&h.allowNonHttpProtocols))try{const P=new URL(k);["http:","https:"].includes(P.protocol)||(w=!0)}catch{w=!0}w||r.push({text:k,range:E,activate:(P,H)=>h?h.activate(P,H,E):m(0,H),hover:(P,H)=>{var W;return(W=h==null?void 0:h.hover)===null||W===void 0?void 0:W.call(h,P,H,E)},leave:(P,H)=>{var W;return(W=h==null?void 0:h.leave)===null||W===void 0?void 0:W.call(h,P,H,E)}})}v=!1,u.hasExtendedAttrs()&&u.extended.urlId?(l=C,g=u.extended.urlId):(l=-1,g=-1)}}e(r)}};function m(f,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){const s=window.open();if(s){try{s.opener=null}catch{}s.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}i.OscLinkProvider=_=a([c(0,d.IBufferService),c(1,d.IOptionsService),c(2,d.IOscLinkService)],_)},6193:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.RenderDebouncer=void 0,i.RenderDebouncer=class{constructor(o,a){this._parentWindow=o,this._renderCallback=a,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._parentWindow.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}addRefreshCallback(o){return this._refreshCallbacks.push(o),this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh())),this._animationFrame}refresh(o,a,c){this._rowCount=c,o=o!==void 0?o:0,a=a!==void 0?a:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,a):a,this._animationFrame||(this._animationFrame=this._parentWindow.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();const o=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,a),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(const o of this._refreshCallbacks)o(0);this._refreshCallbacks=[]}}},5596:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ScreenDprMonitor=void 0;const a=o(844);class c extends a.Disposable{constructor(d){super(),this._parentWindow=d,this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this.register((0,a.toDisposable)(()=>{this.clearListener()}))}setListener(d){this._listener&&this.clearListener(),this._listener=d,this._outerListener=()=>{this._listener&&(this._listener(this._parentWindow.devicePixelRatio,this._currentDevicePixelRatio),this._updateDpr())},this._updateDpr()}_updateDpr(){var d;this._outerListener&&((d=this._resolutionMediaMatchList)===null||d===void 0||d.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._listener&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._listener=void 0,this._outerListener=void 0)}}i.ScreenDprMonitor=c},3236:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Terminal=void 0;const a=o(3614),c=o(3656),n=o(6465),d=o(9042),_=o(3730),m=o(1680),f=o(3107),e=o(5744),s=o(2950),t=o(1296),r=o(428),h=o(4269),u=o(5114),p=o(8934),g=o(3230),l=o(9312),v=o(4725),C=o(6731),k=o(8055),E=o(8969),w=o(8460),P=o(844),H=o(6114),W=o(8437),U=o(2584),S=o(7399),R=o(5941),D=o(9074),O=o(2585),j=o(5435),$=o(4567),X=typeof window<"u"?window.document:null;class K extends E.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(b={}){super(b),this.browser=H,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new P.MutableDisposable),this._onCursorMove=this.register(new w.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new w.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new w.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new w.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new w.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new w.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new w.EventEmitter),this._onBlur=this.register(new w.EventEmitter),this._onA11yCharEmitter=this.register(new w.EventEmitter),this._onA11yTabEmitter=this.register(new w.EventEmitter),this._onWillOpen=this.register(new w.EventEmitter),this._setup(),this.linkifier2=this.register(this._instantiationService.createInstance(n.Linkifier2)),this.linkifier2.registerLinkProvider(this._instantiationService.createInstance(_.OscLinkProvider)),this._decorationService=this._instantiationService.createInstance(D.DecorationService),this._instantiationService.setService(O.IDecorationService,this._decorationService),this.register(this._inputHandler.onRequestBell(()=>this._onBell.fire())),this.register(this._inputHandler.onRequestRefreshRows((I,N)=>this.refresh(I,N))),this.register(this._inputHandler.onRequestSendFocus(()=>this._reportFocus())),this.register(this._inputHandler.onRequestReset(()=>this.reset())),this.register(this._inputHandler.onRequestWindowsOptionsReport(I=>this._reportWindowsOptions(I))),this.register(this._inputHandler.onColor(I=>this._handleColorEvent(I))),this.register((0,w.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,w.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,w.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,w.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(I=>this._afterResize(I.cols,I.rows))),this.register((0,P.toDisposable)(()=>{var I,N;this._customKeyEventHandler=void 0,(N=(I=this.element)===null||I===void 0?void 0:I.parentNode)===null||N===void 0||N.removeChild(this.element)}))}_handleColorEvent(b){if(this._themeService)for(const I of b){let N,F="";switch(I.index){case 256:N="foreground",F="10";break;case 257:N="background",F="11";break;case 258:N="cursor",F="12";break;default:N="ansi",F="4;"+I.index}switch(I.type){case 0:const V=k.color.toColorRGB(N==="ansi"?this._themeService.colors.ansi[I.index]:this._themeService.colors[N]);this.coreService.triggerDataEvent(`${U.C0.ESC}]${F};${(0,R.toRgbString)(V)}${U.C1_ESCAPED.ST}`);break;case 1:if(N==="ansi")this._themeService.modifyColors(z=>z.ansi[I.index]=k.rgba.toColor(...I.color));else{const z=N;this._themeService.modifyColors(Y=>Y[z]=k.rgba.toColor(...I.color))}break;case 2:this._themeService.restoreColor(I.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(b){b?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance($.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(b){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(U.C0.ESC+"[I"),this.updateCursorStyle(b),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var b;return(b=this.textarea)===null||b===void 0?void 0:b.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(U.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;const b=this.buffer.ybase+this.buffer.y,I=this.buffer.lines.get(b);if(!I)return;const N=Math.min(this.buffer.x,this.cols-1),F=this._renderService.dimensions.css.cell.height,V=I.getWidth(N),z=this._renderService.dimensions.css.cell.width*V,Y=this.buffer.y*this._renderService.dimensions.css.cell.height,ee=N*this._renderService.dimensions.css.cell.width;this.textarea.style.left=ee+"px",this.textarea.style.top=Y+"px",this.textarea.style.width=z+"px",this.textarea.style.height=F+"px",this.textarea.style.lineHeight=F+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,c.addDisposableDomListener)(this.element,"copy",I=>{this.hasSelection()&&(0,a.copyHandler)(I,this._selectionService)}));const b=I=>(0,a.handlePasteEvent)(I,this.textarea,this.coreService,this.optionsService);this.register((0,c.addDisposableDomListener)(this.textarea,"paste",b)),this.register((0,c.addDisposableDomListener)(this.element,"paste",b)),H.isFirefox?this.register((0,c.addDisposableDomListener)(this.element,"mousedown",I=>{I.button===2&&(0,a.rightClickHandler)(I,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})):this.register((0,c.addDisposableDomListener)(this.element,"contextmenu",I=>{(0,a.rightClickHandler)(I,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)})),H.isLinux&&this.register((0,c.addDisposableDomListener)(this.element,"auxclick",I=>{I.button===1&&(0,a.moveTextAreaUnderMouseCursor)(I,this.textarea,this.screenElement)}))}_bindKeys(){this.register((0,c.addDisposableDomListener)(this.textarea,"keyup",b=>this._keyUp(b),!0)),this.register((0,c.addDisposableDomListener)(this.textarea,"keydown",b=>this._keyDown(b),!0)),this.register((0,c.addDisposableDomListener)(this.textarea,"keypress",b=>this._keyPress(b),!0)),this.register((0,c.addDisposableDomListener)(this.textarea,"compositionstart",()=>this._compositionHelper.compositionstart())),this.register((0,c.addDisposableDomListener)(this.textarea,"compositionupdate",b=>this._compositionHelper.compositionupdate(b))),this.register((0,c.addDisposableDomListener)(this.textarea,"compositionend",()=>this._compositionHelper.compositionend())),this.register((0,c.addDisposableDomListener)(this.textarea,"input",b=>this._inputEvent(b),!0)),this.register(this.onRender(()=>this._compositionHelper.updateCompositionElements()))}open(b){var I;if(!b)throw new Error("Terminal requires a parent element.");b.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),this._document=b.ownerDocument,this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),b.appendChild(this.element);const N=X.createDocumentFragment();this._viewportElement=X.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),N.appendChild(this._viewportElement),this._viewportScrollArea=X.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=X.createElement("div"),this.screenElement.classList.add("xterm-screen"),this._helperContainer=X.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),N.appendChild(this.screenElement),this.textarea=X.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",d.promptLabel),H.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this._instantiationService.createInstance(u.CoreBrowserService,this.textarea,(I=this._document.defaultView)!==null&&I!==void 0?I:window),this._instantiationService.setService(v.ICoreBrowserService,this._coreBrowserService),this.register((0,c.addDisposableDomListener)(this.textarea,"focus",F=>this._handleTextAreaFocus(F))),this.register((0,c.addDisposableDomListener)(this.textarea,"blur",()=>this._handleTextAreaBlur())),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(r.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(v.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(C.ThemeService),this._instantiationService.setService(v.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(h.CharacterJoinerService),this._instantiationService.setService(v.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(g.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(v.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange(F=>this._onRender.fire(F))),this.onResize(F=>this._renderService.resize(F.cols,F.rows)),this._compositionView=X.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(s.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this.element.appendChild(N);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this._mouseService=this._instantiationService.createInstance(p.MouseService),this._instantiationService.setService(v.IMouseService,this._mouseService),this.viewport=this._instantiationService.createInstance(m.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent,1)),this.register(this._inputHandler.onRequestSyncScrollBar(()=>this.viewport.syncScrollArea())),this.register(this.viewport),this.register(this.onCursorMove(()=>{this._renderService.handleCursorMove(),this._syncTextArea()})),this.register(this.onResize(()=>this._renderService.handleResize(this.cols,this.rows))),this.register(this.onBlur(()=>this._renderService.handleBlur())),this.register(this.onFocus(()=>this._renderService.handleFocus())),this.register(this._renderService.onDimensionsChange(()=>this.viewport.syncScrollArea())),this._selectionService=this.register(this._instantiationService.createInstance(l.SelectionService,this.element,this.screenElement,this.linkifier2)),this._instantiationService.setService(v.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines(F=>this.scrollLines(F.amount,F.suppressScrollEvent))),this.register(this._selectionService.onSelectionChange(()=>this._onSelectionChange.fire())),this.register(this._selectionService.onRequestRedraw(F=>this._renderService.handleSelectionChanged(F.start,F.end,F.columnSelectMode))),this.register(this._selectionService.onLinuxMouseSelection(F=>{this.textarea.value=F,this.textarea.focus(),this.textarea.select()})),this.register(this._onScroll.event(F=>{this.viewport.syncScrollArea(),this._selectionService.refresh()})),this.register((0,c.addDisposableDomListener)(this._viewportElement,"scroll",()=>this._selectionService.refresh())),this.linkifier2.attachToDom(this.screenElement,this._mouseService,this._renderService),this.register(this._instantiationService.createInstance(f.BufferDecorationRenderer,this.screenElement)),this.register((0,c.addDisposableDomListener)(this.element,"mousedown",F=>this._selectionService.handleMouseDown(F))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance($.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",F=>this._handleScreenReaderModeOptionChange(F))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",F=>{!this._overviewRulerRenderer&&F&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement)))}),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(t.DomRenderer,this.element,this.screenElement,this._viewportElement,this.linkifier2)}bindMouse(){const b=this,I=this.element;function N(z){const Y=b._mouseService.getMouseReportCoords(z,b.screenElement);if(!Y)return!1;let ee,re;switch(z.overrideType||z.type){case"mousemove":re=32,z.buttons===void 0?(ee=3,z.button!==void 0&&(ee=z.button<3?z.button:3)):ee=1&z.buttons?0:4&z.buttons?1:2&z.buttons?2:3;break;case"mouseup":re=0,ee=z.button<3?z.button:3;break;case"mousedown":re=1,ee=z.button<3?z.button:3;break;case"wheel":if(b.viewport.getLinesScrolled(z)===0)return!1;re=z.deltaY<0?0:1,ee=4;break;default:return!1}return!(re===void 0||ee===void 0||ee>4)&&b.coreMouseService.triggerMouseEvent({col:Y.col,row:Y.row,x:Y.x,y:Y.y,button:ee,action:re,ctrl:z.ctrlKey,alt:z.altKey,shift:z.shiftKey})}const F={mouseup:null,wheel:null,mousedrag:null,mousemove:null},V={mouseup:z=>(N(z),z.buttons||(this._document.removeEventListener("mouseup",F.mouseup),F.mousedrag&&this._document.removeEventListener("mousemove",F.mousedrag)),this.cancel(z)),wheel:z=>(N(z),this.cancel(z,!0)),mousedrag:z=>{z.buttons&&N(z)},mousemove:z=>{z.buttons||N(z)}};this.register(this.coreMouseService.onProtocolChange(z=>{z?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(z)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&z?F.mousemove||(I.addEventListener("mousemove",V.mousemove),F.mousemove=V.mousemove):(I.removeEventListener("mousemove",F.mousemove),F.mousemove=null),16&z?F.wheel||(I.addEventListener("wheel",V.wheel,{passive:!1}),F.wheel=V.wheel):(I.removeEventListener("wheel",F.wheel),F.wheel=null),2&z?F.mouseup||(I.addEventListener("mouseup",V.mouseup),F.mouseup=V.mouseup):(this._document.removeEventListener("mouseup",F.mouseup),I.removeEventListener("mouseup",F.mouseup),F.mouseup=null),4&z?F.mousedrag||(F.mousedrag=V.mousedrag):(this._document.removeEventListener("mousemove",F.mousedrag),F.mousedrag=null)})),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,c.addDisposableDomListener)(I,"mousedown",z=>{if(z.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(z))return N(z),F.mouseup&&this._document.addEventListener("mouseup",F.mouseup),F.mousedrag&&this._document.addEventListener("mousemove",F.mousedrag),this.cancel(z)})),this.register((0,c.addDisposableDomListener)(I,"wheel",z=>{if(!F.wheel){if(!this.buffer.hasScrollback){const Y=this.viewport.getLinesScrolled(z);if(Y===0)return;const ee=U.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(z.deltaY<0?"A":"B");let re="";for(let le=0;le<Math.abs(Y);le++)re+=ee;return this.coreService.triggerDataEvent(re,!0),this.cancel(z,!0)}return this.viewport.handleWheel(z)?this.cancel(z):void 0}},{passive:!1})),this.register((0,c.addDisposableDomListener)(I,"touchstart",z=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(z),this.cancel(z)},{passive:!0})),this.register((0,c.addDisposableDomListener)(I,"touchmove",z=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(z)?void 0:this.cancel(z)},{passive:!1}))}refresh(b,I){var N;(N=this._renderService)===null||N===void 0||N.refreshRows(b,I)}updateCursorStyle(b){var I;!((I=this._selectionService)===null||I===void 0)&&I.shouldColumnSelect(b)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(b,I,N=0){var F;N===1?(super.scrollLines(b,I,N),this.refresh(0,this.rows-1)):(F=this.viewport)===null||F===void 0||F.scrollLines(b)}paste(b){(0,a.paste)(b,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(b){this._customKeyEventHandler=b}registerLinkProvider(b){return this.linkifier2.registerLinkProvider(b)}registerCharacterJoiner(b){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");const I=this._characterJoinerService.register(b);return this.refresh(0,this.rows-1),I}deregisterCharacterJoiner(b){if(!this._characterJoinerService)throw new Error("Terminal must be opened first");this._characterJoinerService.deregister(b)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(b){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+b)}registerDecoration(b){return this._decorationService.registerDecoration(b)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(b,I,N){this._selectionService.setSelection(b,I,N)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var b;(b=this._selectionService)===null||b===void 0||b.clearSelection()}selectAll(){var b;(b=this._selectionService)===null||b===void 0||b.selectAll()}selectLines(b,I){var N;(N=this._selectionService)===null||N===void 0||N.selectLines(b,I)}_keyDown(b){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(b)===!1)return!1;const I=this.browser.isMac&&this.options.macOptionIsMeta&&b.altKey;if(!I&&!this._compositionHelper.keydown(b))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;I||b.key!=="Dead"&&b.key!=="AltGraph"||(this._unprocessedDeadKey=!0);const N=(0,S.evaluateKeyboardEvent)(b,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(b),N.type===3||N.type===2){const F=this.rows-1;return this.scrollLines(N.type===2?-F:F),this.cancel(b,!0)}return N.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,b)||(N.cancel&&this.cancel(b,!0),!N.key||!!(b.key&&!b.ctrlKey&&!b.altKey&&!b.metaKey&&b.key.length===1&&b.key.charCodeAt(0)>=65&&b.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(N.key!==U.C0.ETX&&N.key!==U.C0.CR||(this.textarea.value=""),this._onKey.fire({key:N.key,domEvent:b}),this._showCursor(),this.coreService.triggerDataEvent(N.key,!0),!this.optionsService.rawOptions.screenReaderMode||b.altKey||b.ctrlKey?this.cancel(b,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(b,I){const N=b.isMac&&!this.options.macOptionIsMeta&&I.altKey&&!I.ctrlKey&&!I.metaKey||b.isWindows&&I.altKey&&I.ctrlKey&&!I.metaKey||b.isWindows&&I.getModifierState("AltGraph");return I.type==="keypress"?N:N&&(!I.keyCode||I.keyCode>47)}_keyUp(b){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(b)===!1||(function(I){return I.keyCode===16||I.keyCode===17||I.keyCode===18}(b)||this.focus(),this.updateCursorStyle(b),this._keyPressHandled=!1)}_keyPress(b){let I;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(b)===!1)return!1;if(this.cancel(b),b.charCode)I=b.charCode;else if(b.which===null||b.which===void 0)I=b.keyCode;else{if(b.which===0||b.charCode===0)return!1;I=b.which}return!(!I||(b.altKey||b.ctrlKey||b.metaKey)&&!this._isThirdLevelShift(this.browser,b)||(I=String.fromCharCode(I),this._onKey.fire({key:I,domEvent:b}),this._showCursor(),this.coreService.triggerDataEvent(I,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(b){if(b.data&&b.inputType==="insertText"&&(!b.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;const I=b.data;return this.coreService.triggerDataEvent(I,!0),this.cancel(b),!0}return!1}resize(b,I){b!==this.cols||I!==this.rows?super.resize(b,I):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(b,I){var N,F;(N=this._charSizeService)===null||N===void 0||N.measure(),(F=this.viewport)===null||F===void 0||F.syncScrollArea(!0)}clear(){var b;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let I=1;I<this.rows;I++)this.buffer.lines.push(this.buffer.getBlankLine(W.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(b=this.viewport)===null||b===void 0||b.reset(),this.refresh(0,this.rows-1)}}reset(){var b,I;this.options.rows=this.rows,this.options.cols=this.cols;const N=this._customKeyEventHandler;this._setup(),super.reset(),(b=this._selectionService)===null||b===void 0||b.reset(),this._decorationService.reset(),(I=this.viewport)===null||I===void 0||I.reset(),this._customKeyEventHandler=N,this.refresh(0,this.rows-1)}clearTextureAtlas(){var b;(b=this._renderService)===null||b===void 0||b.clearTextureAtlas()}_reportFocus(){var b;!((b=this.element)===null||b===void 0)&&b.classList.contains("focus")?this.coreService.triggerDataEvent(U.C0.ESC+"[I"):this.coreService.triggerDataEvent(U.C0.ESC+"[O")}_reportWindowsOptions(b){if(this._renderService)switch(b){case j.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:const I=this._renderService.dimensions.css.canvas.width.toFixed(0),N=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${U.C0.ESC}[4;${N};${I}t`);break;case j.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:const F=this._renderService.dimensions.css.cell.width.toFixed(0),V=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${U.C0.ESC}[6;${V};${F}t`)}}cancel(b,I){if(this.options.cancelEvents||I)return b.preventDefault(),b.stopPropagation(),!1}}i.Terminal=K},9924:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TimeBasedDebouncer=void 0,i.TimeBasedDebouncer=class{constructor(o,a=1e3){this._renderCallback=o,this._debounceThresholdMS=a,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(o,a,c){this._rowCount=c,o=o!==void 0?o:0,a=a!==void 0?a:this._rowCount-1,this._rowStart=this._rowStart!==void 0?Math.min(this._rowStart,o):o,this._rowEnd=this._rowEnd!==void 0?Math.max(this._rowEnd,a):a;const n=Date.now();if(n-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=n,this._innerRefresh();else if(!this._additionalRefreshRequested){const d=n-this._lastRefreshMs,_=this._debounceThresholdMS-d;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout(()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0},_)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;const o=Math.max(this._rowStart,0),a=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(o,a)}}},1680:function(y,i,o){var a=this&&this.__decorate||function(s,t,r,h){var u,p=arguments.length,g=p<3?t:h===null?h=Object.getOwnPropertyDescriptor(t,r):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,t,r,h);else for(var l=s.length-1;l>=0;l--)(u=s[l])&&(g=(p<3?u(g):p>3?u(t,r,g):u(t,r))||g);return p>3&&g&&Object.defineProperty(t,r,g),g},c=this&&this.__param||function(s,t){return function(r,h){t(r,h,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.Viewport=void 0;const n=o(3656),d=o(4725),_=o(8460),m=o(844),f=o(2585);let e=i.Viewport=class extends m.Disposable{constructor(s,t,r,h,u,p,g,l){super(),this._viewportElement=s,this._scrollArea=t,this._bufferService=r,this._optionsService=h,this._charSizeService=u,this._renderService=p,this._coreBrowserService=g,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new _.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(v=>this._activeBuffer=v.activeBuffer)),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange(v=>this._renderDimensions=v)),this._handleThemeChange(l.colors),this.register(l.onChangeColors(v=>this._handleThemeChange(v))),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.syncScrollArea())),setTimeout(()=>this.syncScrollArea())}_handleThemeChange(s){this._viewportElement.style.backgroundColor=s.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame(()=>this.syncScrollArea())}_refresh(s){if(s)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._innerRefresh()))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderService.dimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderService.dimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;const t=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderService.dimensions.css.canvas.height);this._lastRecordedBufferHeight!==t&&(this._lastRecordedBufferHeight=t,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}const s=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==s&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=s),this._refreshAnimationFrame=null}syncScrollArea(s=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(s);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(s)}_handleScroll(s){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});const t=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:t,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;const s=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(s*(this._smoothScrollState.target-this._smoothScrollState.origin)),s<1?this._coreBrowserService.window.requestAnimationFrame(()=>this._smoothScroll()):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(s,t){const r=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(t<0&&this._viewportElement.scrollTop!==0||t>0&&r<this._lastRecordedBufferHeight)||(s.cancelable&&s.preventDefault(),!1)}handleWheel(s){const t=this._getPixelsScrolled(s);return t!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+t:this._smoothScrollState.target+=t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=t,this._bubbleScroll(s,t))}scrollLines(s){if(s!==0)if(this._optionsService.rawOptions.smoothScrollDuration){const t=s*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+t,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:s,suppressScrollEvent:!1})}_getPixelsScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let t=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_LINE?t*=this._currentRowHeight:s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._currentRowHeight*this._bufferService.rows),t}getBufferElements(s,t){var r;let h,u="";const p=[],g=t??this._bufferService.buffer.lines.length,l=this._bufferService.buffer.lines;for(let v=s;v<g;v++){const C=l.get(v);if(!C)continue;const k=(r=l.get(v+1))===null||r===void 0?void 0:r.isWrapped;if(u+=C.translateToString(!k),!k||v===l.length-1){const E=document.createElement("div");E.textContent=u,p.push(E),u.length>0&&(h=E),u=""}}return{bufferElements:p,cursorElement:h}}getLinesScrolled(s){if(s.deltaY===0||s.shiftKey)return 0;let t=this._applyScrollModifier(s.deltaY,s);return s.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(t/=this._currentRowHeight+0,this._wheelPartialScroll+=t,t=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):s.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(t*=this._bufferService.rows),t}_applyScrollModifier(s,t){const r=this._optionsService.rawOptions.fastScrollModifier;return r==="alt"&&t.altKey||r==="ctrl"&&t.ctrlKey||r==="shift"&&t.shiftKey?s*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:s*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(s){this._lastTouchY=s.touches[0].pageY}handleTouchMove(s){const t=this._lastTouchY-s.touches[0].pageY;return this._lastTouchY=s.touches[0].pageY,t!==0&&(this._viewportElement.scrollTop+=t,this._bubbleScroll(s,t))}};i.Viewport=e=a([c(2,f.IBufferService),c(3,f.IOptionsService),c(4,d.ICharSizeService),c(5,d.IRenderService),c(6,d.ICoreBrowserService),c(7,d.IThemeService)],e)},3107:function(y,i,o){var a=this&&this.__decorate||function(e,s,t,r){var h,u=arguments.length,p=u<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,r);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(p=(u<3?h(p):u>3?h(s,t,p):h(s,t))||p);return u>3&&p&&Object.defineProperty(s,t,p),p},c=this&&this.__param||function(e,s){return function(t,r){s(t,r,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferDecorationRenderer=void 0;const n=o(3656),d=o(4725),_=o(844),m=o(2585);let f=i.BufferDecorationRenderer=class extends _.Disposable{constructor(e,s,t,r){super(),this._screenElement=e,this._bufferService=s,this._decorationService=t,this._renderService=r,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange(()=>this._doRefreshDecorations())),this.register(this._renderService.onDimensionsChange(()=>{this._dimensionsChanged=!0,this._queueRefresh()})),this.register((0,n.addDisposableDomListener)(window,"resize",()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt})),this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh())),this.register(this._decorationService.onDecorationRemoved(h=>this._removeDecoration(h))),this.register((0,_.toDisposable)(()=>{this._container.remove(),this._decorationElements.clear()}))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback(()=>{this._doRefreshDecorations(),this._animationFrame=void 0}))}_doRefreshDecorations(){for(const e of this._decorationService.decorations)this._renderDecoration(e);this._dimensionsChanged=!1}_renderDecoration(e){this._refreshStyle(e),this._dimensionsChanged&&this._refreshXPosition(e)}_createElement(e){var s,t;const r=document.createElement("div");r.classList.add("xterm-decoration"),r.classList.toggle("xterm-decoration-top-layer",((s=e==null?void 0:e.options)===null||s===void 0?void 0:s.layer)==="top"),r.style.width=`${Math.round((e.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,r.style.height=(e.options.height||1)*this._renderService.dimensions.css.cell.height+"px",r.style.top=(e.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",r.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;const h=(t=e.options.x)!==null&&t!==void 0?t:0;return h&&h>this._bufferService.cols&&(r.style.display="none"),this._refreshXPosition(e,r),r}_refreshStyle(e){const s=e.marker.line-this._bufferService.buffers.active.ydisp;if(s<0||s>=this._bufferService.rows)e.element&&(e.element.style.display="none",e.onRenderEmitter.fire(e.element));else{let t=this._decorationElements.get(e);t||(t=this._createElement(e),e.element=t,this._decorationElements.set(e,t),this._container.appendChild(t),e.onDispose(()=>{this._decorationElements.delete(e),t.remove()})),t.style.top=s*this._renderService.dimensions.css.cell.height+"px",t.style.display=this._altBufferIsActive?"none":"block",e.onRenderEmitter.fire(t)}}_refreshXPosition(e,s=e.element){var t;if(!s)return;const r=(t=e.options.x)!==null&&t!==void 0?t:0;(e.options.anchor||"left")==="right"?s.style.right=r?r*this._renderService.dimensions.css.cell.width+"px":"":s.style.left=r?r*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(e){var s;(s=this._decorationElements.get(e))===null||s===void 0||s.remove(),this._decorationElements.delete(e),e.dispose()}};i.BufferDecorationRenderer=f=a([c(1,m.IBufferService),c(2,m.IDecorationService),c(3,d.IRenderService)],f)},5871:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ColorZoneStore=void 0,i.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(o){if(o.options.overviewRulerOptions){for(const a of this._zones)if(a.color===o.options.overviewRulerOptions.color&&a.position===o.options.overviewRulerOptions.position){if(this._lineIntersectsZone(a,o.marker.line))return;if(this._lineAdjacentToZone(a,o.marker.line,o.options.overviewRulerOptions.position))return void this._addLineToZone(a,o.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=o.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=o.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=o.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=o.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:o.options.overviewRulerOptions.color,position:o.options.overviewRulerOptions.position,startBufferLine:o.marker.line,endBufferLine:o.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(o){this._linePadding=o}_lineIntersectsZone(o,a){return a>=o.startBufferLine&&a<=o.endBufferLine}_lineAdjacentToZone(o,a,c){return a>=o.startBufferLine-this._linePadding[c||"full"]&&a<=o.endBufferLine+this._linePadding[c||"full"]}_addLineToZone(o,a){o.startBufferLine=Math.min(o.startBufferLine,a),o.endBufferLine=Math.max(o.endBufferLine,a)}}},5744:function(y,i,o){var a=this&&this.__decorate||function(h,u,p,g){var l,v=arguments.length,C=v<3?u:g===null?g=Object.getOwnPropertyDescriptor(u,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(h,u,p,g);else for(var k=h.length-1;k>=0;k--)(l=h[k])&&(C=(v<3?l(C):v>3?l(u,p,C):l(u,p))||C);return v>3&&C&&Object.defineProperty(u,p,C),C},c=this&&this.__param||function(h,u){return function(p,g){u(p,g,h)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OverviewRulerRenderer=void 0;const n=o(5871),d=o(3656),_=o(4725),m=o(844),f=o(2585),e={full:0,left:0,center:0,right:0},s={full:0,left:0,center:0,right:0},t={full:0,left:0,center:0,right:0};let r=i.OverviewRulerRenderer=class extends m.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(h,u,p,g,l,v,C){var k;super(),this._viewportElement=h,this._screenElement=u,this._bufferService=p,this._decorationService=g,this._renderService=l,this._optionsService=v,this._coreBrowseService=C,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(k=this._viewportElement.parentElement)===null||k===void 0||k.insertBefore(this._canvas,this._viewportElement);const E=this._canvas.getContext("2d");if(!E)throw new Error("Ctx cannot be null");this._ctx=E,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,m.toDisposable)(()=>{var w;(w=this._canvas)===null||w===void 0||w.remove()}))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered(()=>this._queueRefresh(void 0,!0))),this.register(this._decorationService.onDecorationRemoved(()=>this._queueRefresh(void 0,!0)))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange(()=>this._queueRefresh())),this.register(this._bufferService.buffers.onBufferActivate(()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"})),this.register(this._bufferService.onScroll(()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())}))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender(()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)})),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",()=>this._queueRefresh(!0))),this.register((0,d.addDisposableDomListener)(this._coreBrowseService.window,"resize",()=>this._queueRefresh(!0))),this._queueRefresh(!0)}_refreshDrawConstants(){const h=Math.floor(this._canvas.width/3),u=Math.ceil(this._canvas.width/3);s.full=this._canvas.width,s.left=h,s.center=u,s.right=h,this._refreshDrawHeightConstants(),t.full=0,t.left=0,t.center=s.left,t.right=s.left+s.center}_refreshDrawHeightConstants(){e.full=Math.round(2*this._coreBrowseService.dpr);const h=this._canvas.height/this._bufferService.buffer.lines.length,u=Math.round(Math.max(Math.min(h,12),6)*this._coreBrowseService.dpr);e.left=u,e.center=u,e.right=u}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*e.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowseService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowseService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(const u of this._decorationService.decorations)this._colorZoneStore.addDecoration(u);this._ctx.lineWidth=1;const h=this._colorZoneStore.zones;for(const u of h)u.position!=="full"&&this._renderColorZone(u);for(const u of h)u.position==="full"&&this._renderColorZone(u);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(h){this._ctx.fillStyle=h.color,this._ctx.fillRect(t[h.position||"full"],Math.round((this._canvas.height-1)*(h.startBufferLine/this._bufferService.buffers.active.lines.length)-e[h.position||"full"]/2),s[h.position||"full"],Math.round((this._canvas.height-1)*((h.endBufferLine-h.startBufferLine)/this._bufferService.buffers.active.lines.length)+e[h.position||"full"]))}_queueRefresh(h,u){this._shouldUpdateDimensions=h||this._shouldUpdateDimensions,this._shouldUpdateAnchor=u||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowseService.window.requestAnimationFrame(()=>{this._refreshDecorations(),this._animationFrame=void 0}))}};i.OverviewRulerRenderer=r=a([c(2,f.IBufferService),c(3,f.IDecorationService),c(4,_.IRenderService),c(5,f.IOptionsService),c(6,_.ICoreBrowserService)],r)},2950:function(y,i,o){var a=this&&this.__decorate||function(f,e,s,t){var r,h=arguments.length,u=h<3?e:t===null?t=Object.getOwnPropertyDescriptor(e,s):t;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")u=Reflect.decorate(f,e,s,t);else for(var p=f.length-1;p>=0;p--)(r=f[p])&&(u=(h<3?r(u):h>3?r(e,s,u):r(e,s))||u);return h>3&&u&&Object.defineProperty(e,s,u),u},c=this&&this.__param||function(f,e){return function(s,t){e(s,t,f)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CompositionHelper=void 0;const n=o(4725),d=o(2585),_=o(2584);let m=i.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(f,e,s,t,r,h){this._textarea=f,this._compositionView=e,this._bufferService=s,this._optionsService=t,this._coreService=r,this._renderService=h,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(f){this._compositionView.textContent=f.data,this.updateCompositionElements(),setTimeout(()=>{this._compositionPosition.end=this._textarea.value.length},0)}compositionend(){this._finalizeComposition(!0)}keydown(f){if(this._isComposing||this._isSendingComposition){if(f.keyCode===229||f.keyCode===16||f.keyCode===17||f.keyCode===18)return!1;this._finalizeComposition(!1)}return f.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(f){if(this._compositionView.classList.remove("active"),this._isComposing=!1,f){const e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout(()=>{if(this._isSendingComposition){let s;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,s=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),s.length>0&&this._coreService.triggerDataEvent(s,!0)}},0)}else{this._isSendingComposition=!1;const e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){const f=this._textarea.value;setTimeout(()=>{if(!this._isComposing){const e=this._textarea.value,s=e.replace(f,"");this._dataAlreadySent=s,e.length>f.length?this._coreService.triggerDataEvent(s,!0):e.length<f.length?this._coreService.triggerDataEvent(`${_.C0.DEL}`,!0):e.length===f.length&&e!==f&&this._coreService.triggerDataEvent(e,!0)}},0)}updateCompositionElements(f){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){const e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),s=this._renderService.dimensions.css.cell.height,t=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,r=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=r+"px",this._compositionView.style.top=t+"px",this._compositionView.style.height=s+"px",this._compositionView.style.lineHeight=s+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";const h=this._compositionView.getBoundingClientRect();this._textarea.style.left=r+"px",this._textarea.style.top=t+"px",this._textarea.style.width=Math.max(h.width,1)+"px",this._textarea.style.height=Math.max(h.height,1)+"px",this._textarea.style.lineHeight=h.height+"px"}f||setTimeout(()=>this.updateCompositionElements(!0),0)}}};i.CompositionHelper=m=a([c(2,d.IBufferService),c(3,d.IOptionsService),c(4,d.ICoreService),c(5,n.IRenderService)],m)},9806:(y,i)=>{function o(a,c,n){const d=n.getBoundingClientRect(),_=a.getComputedStyle(n),m=parseInt(_.getPropertyValue("padding-left")),f=parseInt(_.getPropertyValue("padding-top"));return[c.clientX-d.left-m,c.clientY-d.top-f]}Object.defineProperty(i,"__esModule",{value:!0}),i.getCoords=i.getCoordsRelativeToElement=void 0,i.getCoordsRelativeToElement=o,i.getCoords=function(a,c,n,d,_,m,f,e,s){if(!m)return;const t=o(a,c,n);return t?(t[0]=Math.ceil((t[0]+(s?f/2:0))/f),t[1]=Math.ceil(t[1]/e),t[0]=Math.min(Math.max(t[0],1),d+(s?1:0)),t[1]=Math.min(Math.max(t[1],1),_),t):void 0}},9504:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.moveToCellSequence=void 0;const a=o(2584);function c(e,s,t,r){const h=e-n(e,t),u=s-n(s,t),p=Math.abs(h-u)-function(g,l,v){let C=0;const k=g-n(g,v),E=l-n(l,v);for(let w=0;w<Math.abs(k-E);w++){const P=d(g,l)==="A"?-1:1,H=v.buffer.lines.get(k+P*w);H!=null&&H.isWrapped&&C++}return C}(e,s,t);return f(p,m(d(e,s),r))}function n(e,s){let t=0,r=s.buffer.lines.get(e),h=r==null?void 0:r.isWrapped;for(;h&&e>=0&&e<s.rows;)t++,r=s.buffer.lines.get(--e),h=r==null?void 0:r.isWrapped;return t}function d(e,s){return e>s?"A":"B"}function _(e,s,t,r,h,u){let p=e,g=s,l="";for(;p!==t||g!==r;)p+=h?1:-1,h&&p>u.cols-1?(l+=u.buffer.translateBufferLineToString(g,!1,e,p),p=0,e=0,g++):!h&&p<0&&(l+=u.buffer.translateBufferLineToString(g,!1,0,e+1),p=u.cols-1,e=p,g--);return l+u.buffer.translateBufferLineToString(g,!1,e,p)}function m(e,s){const t=s?"O":"[";return a.C0.ESC+t+e}function f(e,s){e=Math.floor(e);let t="";for(let r=0;r<e;r++)t+=s;return t}i.moveToCellSequence=function(e,s,t,r){const h=t.buffer.x,u=t.buffer.y;if(!t.buffer.hasScrollback)return function(l,v,C,k,E,w){return c(v,k,E,w).length===0?"":f(_(l,v,l,v-n(v,E),!1,E).length,m("D",w))}(h,u,0,s,t,r)+c(u,s,t,r)+function(l,v,C,k,E,w){let P;P=c(v,k,E,w).length>0?k-n(k,E):v;const H=k,W=function(U,S,R,D,O,j){let $;return $=c(R,D,O,j).length>0?D-n(D,O):S,U<R&&$<=D||U>=R&&$<D?"C":"D"}(l,v,C,k,E,w);return f(_(l,P,C,H,W==="C",E).length,m(W,w))}(h,u,e,s,t,r);let p;if(u===s)return p=h>e?"D":"C",f(Math.abs(h-e),m(p,r));p=u>s?"D":"C";const g=Math.abs(u-s);return f(function(l,v){return v.cols-l}(u>s?e:h,t)+(g-1)*t.cols+1+((u>s?h:e)-1),m(p,r))}},1296:function(y,i,o){var a=this&&this.__decorate||function(E,w,P,H){var W,U=arguments.length,S=U<3?w:H===null?H=Object.getOwnPropertyDescriptor(w,P):H;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")S=Reflect.decorate(E,w,P,H);else for(var R=E.length-1;R>=0;R--)(W=E[R])&&(S=(U<3?W(S):U>3?W(w,P,S):W(w,P))||S);return U>3&&S&&Object.defineProperty(w,P,S),S},c=this&&this.__param||function(E,w){return function(P,H){w(P,H,E)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRenderer=void 0;const n=o(3787),d=o(2550),_=o(2223),m=o(6171),f=o(4725),e=o(8055),s=o(8460),t=o(844),r=o(2585),h="xterm-dom-renderer-owner-",u="xterm-rows",p="xterm-fg-",g="xterm-bg-",l="xterm-focus",v="xterm-selection";let C=1,k=i.DomRenderer=class extends t.Disposable{constructor(E,w,P,H,W,U,S,R,D,O){super(),this._element=E,this._screenElement=w,this._viewportElement=P,this._linkifier2=H,this._charSizeService=U,this._optionsService=S,this._bufferService=R,this._coreBrowserService=D,this._themeService=O,this._terminalClass=C++,this._rowElements=[],this.onRequestRedraw=this.register(new s.EventEmitter).event,this._rowContainer=document.createElement("div"),this._rowContainer.classList.add(u),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=document.createElement("div"),this._selectionContainer.classList.add(v),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,m.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._themeService.onChangeColors(j=>this._injectCss(j))),this._injectCss(this._themeService.colors),this._rowFactory=W.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(h+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline(j=>this._handleLinkHover(j))),this.register(this._linkifier2.onHideLinkUnderline(j=>this._handleLinkLeave(j))),this.register((0,t.toDisposable)(()=>{this._element.classList.remove(h+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()})),this._widthCache=new d.WidthCache(document),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){const E=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*E,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*E),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/E),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/E),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(const P of this._rowElements)P.style.width=`${this.dimensions.css.canvas.width}px`,P.style.height=`${this.dimensions.css.cell.height}px`,P.style.lineHeight=`${this.dimensions.css.cell.height}px`,P.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));const w=`${this._terminalSelector} .${u} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=w,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(E){this._themeStyleElement||(this._themeStyleElement=document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let w=`${this._terminalSelector} .${u} { color: ${E.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;w+=`${this._terminalSelector} .${u} .xterm-dim { color: ${e.color.multiplyOpacity(E.foreground,.5).css};}`,w+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`,w+="@keyframes blink_box_shadow_"+this._terminalClass+" { 50% {  border-bottom-style: hidden; }}",w+="@keyframes blink_block_"+this._terminalClass+` { 0% {  background-color: ${E.cursor.css};  color: ${E.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${E.cursor.css}; }}`,w+=`${this._terminalSelector} .${u}.${l} .xterm-cursor.xterm-cursor-blink:not(.xterm-cursor-block) { animation: blink_box_shadow_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${u}.${l} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: blink_block_`+this._terminalClass+` 1s step-end infinite;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-block { background-color: ${E.cursor.css}; color: ${E.cursorAccent.css};}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${E.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${E.cursor.css} inset;}${this._terminalSelector} .${u} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${E.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,w+=`${this._terminalSelector} .${v} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${v} div { position: absolute; background-color: ${E.selectionBackgroundOpaque.css};}${this._terminalSelector} .${v} div { position: absolute; background-color: ${E.selectionInactiveBackgroundOpaque.css};}`;for(const[P,H]of E.ansi.entries())w+=`${this._terminalSelector} .${p}${P} { color: ${H.css}; }${this._terminalSelector} .${p}${P}.xterm-dim { color: ${e.color.multiplyOpacity(H,.5).css}; }${this._terminalSelector} .${g}${P} { background-color: ${H.css}; }`;w+=`${this._terminalSelector} .${p}${_.INVERTED_DEFAULT_COLOR} { color: ${e.color.opaque(E.background).css}; }${this._terminalSelector} .${p}${_.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${e.color.multiplyOpacity(e.color.opaque(E.background),.5).css}; }${this._terminalSelector} .${g}${_.INVERTED_DEFAULT_COLOR} { background-color: ${E.foreground.css}; }`,this._themeStyleElement.textContent=w}_setDefaultSpacing(){const E=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${E}px`,this._rowFactory.defaultSpacing=E}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(E,w){for(let P=this._rowElements.length;P<=w;P++){const H=document.createElement("div");this._rowContainer.appendChild(H),this._rowElements.push(H)}for(;this._rowElements.length>w;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(E,w){this._refreshRowElements(E,w),this._updateDimensions()}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(l)}handleFocus(){this._rowContainer.classList.add(l),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(E,w,P){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(E,w,P),this.renderRows(0,this._bufferService.rows-1),!E||!w)return;const H=E[1]-this._bufferService.buffer.ydisp,W=w[1]-this._bufferService.buffer.ydisp,U=Math.max(H,0),S=Math.min(W,this._bufferService.rows-1);if(U>=this._bufferService.rows||S<0)return;const R=document.createDocumentFragment();if(P){const D=E[0]>w[0];R.appendChild(this._createSelectionElement(U,D?w[0]:E[0],D?E[0]:w[0],S-U+1))}else{const D=H===U?E[0]:0,O=U===W?w[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(U,D,O));const j=S-U-1;if(R.appendChild(this._createSelectionElement(U+1,0,this._bufferService.cols,j)),U!==S){const $=W===S?w[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(S,0,$))}}this._selectionContainer.appendChild(R)}_createSelectionElement(E,w,P,H=1){const W=document.createElement("div");return W.style.height=H*this.dimensions.css.cell.height+"px",W.style.top=E*this.dimensions.css.cell.height+"px",W.style.left=w*this.dimensions.css.cell.width+"px",W.style.width=this.dimensions.css.cell.width*(P-w)+"px",W}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(const E of this._rowElements)E.replaceChildren()}renderRows(E,w){const P=this._bufferService.buffer,H=P.ybase+P.y,W=Math.min(P.x,this._bufferService.cols-1),U=this._optionsService.rawOptions.cursorBlink,S=this._optionsService.rawOptions.cursorStyle,R=this._optionsService.rawOptions.cursorInactiveStyle;for(let D=E;D<=w;D++){const O=D+P.ydisp,j=this._rowElements[D],$=P.lines.get(O);if(!j||!$)break;j.replaceChildren(...this._rowFactory.createRow($,O,O===H,S,R,W,U,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${h}${this._terminalClass}`}_handleLinkHover(E){this._setCellUnderline(E.x1,E.x2,E.y1,E.y2,E.cols,!0)}_handleLinkLeave(E){this._setCellUnderline(E.x1,E.x2,E.y1,E.y2,E.cols,!1)}_setCellUnderline(E,w,P,H,W,U){P<0&&(E=0),H<0&&(w=0);const S=this._bufferService.rows-1;P=Math.max(Math.min(P,S),0),H=Math.max(Math.min(H,S),0),W=Math.min(W,this._bufferService.cols);const R=this._bufferService.buffer,D=R.ybase+R.y,O=Math.min(R.x,W-1),j=this._optionsService.rawOptions.cursorBlink,$=this._optionsService.rawOptions.cursorStyle,X=this._optionsService.rawOptions.cursorInactiveStyle;for(let K=P;K<=H;++K){const Z=K+R.ydisp,b=this._rowElements[K],I=R.lines.get(Z);if(!b||!I)break;b.replaceChildren(...this._rowFactory.createRow(I,Z,Z===D,$,X,O,j,this.dimensions.css.cell.width,this._widthCache,U?K===P?E:0:-1,U?(K===H?w:W)-1:-1))}}};i.DomRenderer=k=a([c(4,r.IInstantiationService),c(5,f.ICharSizeService),c(6,r.IOptionsService),c(7,r.IBufferService),c(8,f.ICoreBrowserService),c(9,f.IThemeService)],k)},3787:function(y,i,o){var a=this&&this.__decorate||function(p,g,l,v){var C,k=arguments.length,E=k<3?g:v===null?v=Object.getOwnPropertyDescriptor(g,l):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")E=Reflect.decorate(p,g,l,v);else for(var w=p.length-1;w>=0;w--)(C=p[w])&&(E=(k<3?C(E):k>3?C(g,l,E):C(g,l))||E);return k>3&&E&&Object.defineProperty(g,l,E),E},c=this&&this.__param||function(p,g){return function(l,v){g(l,v,p)}};Object.defineProperty(i,"__esModule",{value:!0}),i.DomRendererRowFactory=void 0;const n=o(2223),d=o(643),_=o(511),m=o(2585),f=o(8055),e=o(4725),s=o(4269),t=o(6171),r=o(3734);let h=i.DomRendererRowFactory=class{constructor(p,g,l,v,C,k,E){this._document=p,this._characterJoinerService=g,this._optionsService=l,this._coreBrowserService=v,this._coreService=C,this._decorationService=k,this._themeService=E,this._workCell=new _.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(p,g,l){this._selectionStart=p,this._selectionEnd=g,this._columnSelectMode=l}createRow(p,g,l,v,C,k,E,w,P,H,W){const U=[],S=this._characterJoinerService.getJoinedCharacters(g),R=this._themeService.colors;let D,O=p.getNoBgTrimmedLength();l&&O<k+1&&(O=k+1);let j=0,$="",X=0,K=0,Z=0,b=!1,I=0,N=!1,F=0;const V=[],z=H!==-1&&W!==-1;for(let Y=0;Y<O;Y++){p.loadCell(Y,this._workCell);let ee=this._workCell.getWidth();if(ee===0)continue;let re=!1,le=Y,G=this._workCell;if(S.length>0&&Y===S[0][0]){re=!0;const Q=S.shift();G=new s.JoinedCellData(this._workCell,p.translateToString(!0,Q[0],Q[1]),Q[1]-Q[0]),le=Q[1]-1,ee=G.getWidth()}const de=this._isCellInSelection(Y,g),Ae=l&&Y===k,Te=z&&Y>=H&&Y<=W;let Be=!1;this._decorationService.forEachDecorationAtCell(Y,g,void 0,Q=>{Be=!0});let ye=G.getChars()||d.WHITESPACE_CELL_CHAR;if(ye===" "&&(G.isUnderline()||G.isOverline())&&(ye=" "),F=ee*w-P.get(ye,G.isBold(),G.isItalic()),D){if(j&&(de&&N||!de&&!N&&G.bg===X)&&(de&&N&&R.selectionForeground||G.fg===K)&&G.extended.ext===Z&&Te===b&&F===I&&!Ae&&!re&&!Be){$+=ye,j++;continue}j&&(D.textContent=$),D=this._document.createElement("span"),j=0,$=""}else D=this._document.createElement("span");if(X=G.bg,K=G.fg,Z=G.extended.ext,b=Te,I=F,N=de,re&&k>=Y&&k<=le&&(k=Y),!this._coreService.isCursorHidden&&Ae){if(V.push("xterm-cursor"),this._coreBrowserService.isFocused)E&&V.push("xterm-cursor-blink"),V.push(v==="bar"?"xterm-cursor-bar":v==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(C)switch(C){case"outline":V.push("xterm-cursor-outline");break;case"block":V.push("xterm-cursor-block");break;case"bar":V.push("xterm-cursor-bar");break;case"underline":V.push("xterm-cursor-underline")}}if(G.isBold()&&V.push("xterm-bold"),G.isItalic()&&V.push("xterm-italic"),G.isDim()&&V.push("xterm-dim"),$=G.isInvisible()?d.WHITESPACE_CELL_CHAR:G.getChars()||d.WHITESPACE_CELL_CHAR,G.isUnderline()&&(V.push(`xterm-underline-${G.extended.underlineStyle}`),$===" "&&($=" "),!G.isUnderlineColorDefault()))if(G.isUnderlineColorRGB())D.style.textDecorationColor=`rgb(${r.AttributeData.toColorRGB(G.getUnderlineColor()).join(",")})`;else{let Q=G.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&G.isBold()&&Q<8&&(Q+=8),D.style.textDecorationColor=R.ansi[Q].css}G.isOverline()&&(V.push("xterm-overline"),$===" "&&($=" ")),G.isStrikethrough()&&V.push("xterm-strikethrough"),Te&&(D.style.textDecoration="underline");let ie=G.getFgColor(),fe=G.getFgColorMode(),ne=G.getBgColor(),_e=G.getBgColorMode();const Oe=!!G.isInverse();if(Oe){const Q=ie;ie=ne,ne=Q;const gi=fe;fe=_e,_e=gi}let oe,Me,ae,ve=!1;switch(this._decorationService.forEachDecorationAtCell(Y,g,void 0,Q=>{Q.options.layer!=="top"&&ve||(Q.backgroundColorRGB&&(_e=50331648,ne=Q.backgroundColorRGB.rgba>>8&16777215,oe=Q.backgroundColorRGB),Q.foregroundColorRGB&&(fe=50331648,ie=Q.foregroundColorRGB.rgba>>8&16777215,Me=Q.foregroundColorRGB),ve=Q.options.layer==="top")}),!ve&&de&&(oe=this._coreBrowserService.isFocused?R.selectionBackgroundOpaque:R.selectionInactiveBackgroundOpaque,ne=oe.rgba>>8&16777215,_e=50331648,ve=!0,R.selectionForeground&&(fe=50331648,ie=R.selectionForeground.rgba>>8&16777215,Me=R.selectionForeground)),ve&&V.push("xterm-decoration-top"),_e){case 16777216:case 33554432:ae=R.ansi[ne],V.push(`xterm-bg-${ne}`);break;case 50331648:ae=f.rgba.toColor(ne>>16,ne>>8&255,255&ne),this._addStyle(D,`background-color:#${u((ne>>>0).toString(16),"0",6)}`);break;default:Oe?(ae=R.foreground,V.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):ae=R.background}switch(oe||G.isDim()&&(oe=f.color.multiplyOpacity(ae,.5)),fe){case 16777216:case 33554432:G.isBold()&&ie<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(ie+=8),this._applyMinimumContrast(D,ae,R.ansi[ie],G,oe,void 0)||V.push(`xterm-fg-${ie}`);break;case 50331648:const Q=f.rgba.toColor(ie>>16&255,ie>>8&255,255&ie);this._applyMinimumContrast(D,ae,Q,G,oe,Me)||this._addStyle(D,`color:#${u(ie.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(D,ae,R.foreground,G,oe,void 0)||Oe&&V.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}V.length&&(D.className=V.join(" "),V.length=0),Ae||re||Be?D.textContent=$:j++,F!==this.defaultSpacing&&(D.style.letterSpacing=`${F}px`),U.push(D),Y=le}return D&&j&&(D.textContent=$),U}_applyMinimumContrast(p,g,l,v,C,k){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,t.excludeFromContrastRatioDemands)(v.getCode()))return!1;const E=this._getContrastCache(v);let w;if(C||k||(w=E.getColor(g.rgba,l.rgba)),w===void 0){const P=this._optionsService.rawOptions.minimumContrastRatio/(v.isDim()?2:1);w=f.color.ensureContrastRatio(C||g,k||l,P),E.setColor((C||g).rgba,(k||l).rgba,w??null)}return!!w&&(this._addStyle(p,`color:${w.css}`),!0)}_getContrastCache(p){return p.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(p,g){p.setAttribute("style",`${p.getAttribute("style")||""}${g};`)}_isCellInSelection(p,g){const l=this._selectionStart,v=this._selectionEnd;return!(!l||!v)&&(this._columnSelectMode?l[0]<=v[0]?p>=l[0]&&g>=l[1]&&p<v[0]&&g<=v[1]:p<l[0]&&g>=l[1]&&p>=v[0]&&g<=v[1]:g>l[1]&&g<v[1]||l[1]===v[1]&&g===l[1]&&p>=l[0]&&p<v[0]||l[1]<v[1]&&g===v[1]&&p<v[0]||l[1]<v[1]&&g===l[1]&&p>=l[0])}};function u(p,g,l){for(;p.length<l;)p=g+p;return p}i.DomRendererRowFactory=h=a([c(1,e.ICharacterJoinerService),c(2,m.IOptionsService),c(3,e.ICoreBrowserService),c(4,m.ICoreService),c(5,m.IDecorationService),c(6,e.IThemeService)],h)},2550:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WidthCache=void 0,i.WidthCache=class{constructor(o){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=o.createElement("div"),this._container.style.position="absolute",this._container.style.top="-50000px",this._container.style.width="50000px",this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";const a=o.createElement("span"),c=o.createElement("span");c.style.fontWeight="bold";const n=o.createElement("span");n.style.fontStyle="italic";const d=o.createElement("span");d.style.fontWeight="bold",d.style.fontStyle="italic",this._measureElements=[a,c,n,d],this._container.appendChild(a),this._container.appendChild(c),this._container.appendChild(n),this._container.appendChild(d),o.body.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(o,a,c,n){o===this._font&&a===this._fontSize&&c===this._weight&&n===this._weightBold||(this._font=o,this._fontSize=a,this._weight=c,this._weightBold=n,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${c}`,this._measureElements[1].style.fontWeight=`${n}`,this._measureElements[2].style.fontWeight=`${c}`,this._measureElements[3].style.fontWeight=`${n}`,this.clear())}get(o,a,c){let n=0;if(!a&&!c&&o.length===1&&(n=o.charCodeAt(0))<256)return this._flat[n]!==-9999?this._flat[n]:this._flat[n]=this._measure(o,0);let d=o;a&&(d+="B"),c&&(d+="I");let _=this._holey.get(d);if(_===void 0){let m=0;a&&(m|=1),c&&(m|=2),_=this._measure(o,m),this._holey.set(d,_)}return _}_measure(o,a){const c=this._measureElements[a];return c.textContent=o.repeat(32),c.offsetWidth/32}}},2223:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.TEXT_BASELINE=i.DIM_OPACITY=i.INVERTED_DEFAULT_COLOR=void 0;const a=o(6114);i.INVERTED_DEFAULT_COLOR=257,i.DIM_OPACITY=.5,i.TEXT_BASELINE=a.isFirefox||a.isLegacyEdge?"bottom":"ideographic"},6171:(y,i)=>{function o(a){return 57508<=a&&a<=57558}Object.defineProperty(i,"__esModule",{value:!0}),i.createRenderDimensions=i.excludeFromContrastRatioDemands=i.isRestrictedPowerlineGlyph=i.isPowerlineGlyph=i.throwIfFalsy=void 0,i.throwIfFalsy=function(a){if(!a)throw new Error("value must not be falsy");return a},i.isPowerlineGlyph=o,i.isRestrictedPowerlineGlyph=function(a){return 57520<=a&&a<=57527},i.excludeFromContrastRatioDemands=function(a){return o(a)||function(c){return 9472<=c&&c<=9631}(a)},i.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}}},456:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionModel=void 0,i.SelectionModel=class{constructor(o){this._bufferService=o,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){const o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?o%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)-1]:[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[o,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){const o=this.selectionStart[0]+this.selectionStartLength;return o>this._bufferService.cols?[o%this._bufferService.cols,this.selectionStart[1]+Math.floor(o/this._bufferService.cols)]:[Math.max(o,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){const o=this.selectionStart,a=this.selectionEnd;return!(!o||!a)&&(o[1]>a[1]||o[1]===a[1]&&o[0]>a[0])}handleTrim(o){return this.selectionStart&&(this.selectionStart[1]-=o),this.selectionEnd&&(this.selectionEnd[1]-=o),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(y,i,o){var a=this&&this.__decorate||function(e,s,t,r){var h,u=arguments.length,p=u<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,r);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(p=(u<3?h(p):u>3?h(s,t,p):h(s,t))||p);return u>3&&p&&Object.defineProperty(s,t,p),p},c=this&&this.__param||function(e,s){return function(t,r){s(t,r,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharSizeService=void 0;const n=o(2585),d=o(8460),_=o(844);let m=i.CharSizeService=class extends _.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(e,s,t){super(),this._optionsService=t,this.width=0,this.height=0,this._onCharSizeChange=this.register(new d.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event,this._measureStrategy=new f(e,s,this._optionsService),this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],()=>this.measure()))}measure(){const e=this._measureStrategy.measure();e.width===this.width&&e.height===this.height||(this.width=e.width,this.height=e.height,this._onCharSizeChange.fire())}};i.CharSizeService=m=a([c(2,n.IOptionsService)],m);class f{constructor(s,t,r){this._document=s,this._parentElement=t,this._optionsService=r,this._result={width:0,height:0},this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`;const s={height:Number(this._measureElement.offsetHeight),width:Number(this._measureElement.offsetWidth)};return s.width!==0&&s.height!==0&&(this._result.width=s.width/32,this._result.height=Math.ceil(s.height)),this._result}}},4269:function(y,i,o){var a=this&&this.__decorate||function(s,t,r,h){var u,p=arguments.length,g=p<3?t:h===null?h=Object.getOwnPropertyDescriptor(t,r):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")g=Reflect.decorate(s,t,r,h);else for(var l=s.length-1;l>=0;l--)(u=s[l])&&(g=(p<3?u(g):p>3?u(t,r,g):u(t,r))||g);return p>3&&g&&Object.defineProperty(t,r,g),g},c=this&&this.__param||function(s,t){return function(r,h){t(r,h,s)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CharacterJoinerService=i.JoinedCellData=void 0;const n=o(3734),d=o(643),_=o(511),m=o(2585);class f extends n.AttributeData{constructor(t,r,h){super(),this.content=0,this.combinedData="",this.fg=t.fg,this.bg=t.bg,this.combinedData=r,this._width=h}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(t){throw new Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.JoinedCellData=f;let e=i.CharacterJoinerService=class pi{constructor(t){this._bufferService=t,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new _.CellData}register(t){const r={id:this._nextCharacterJoinerId++,handler:t};return this._characterJoiners.push(r),r.id}deregister(t){for(let r=0;r<this._characterJoiners.length;r++)if(this._characterJoiners[r].id===t)return this._characterJoiners.splice(r,1),!0;return!1}getJoinedCharacters(t){if(this._characterJoiners.length===0)return[];const r=this._bufferService.buffer.lines.get(t);if(!r||r.length===0)return[];const h=[],u=r.translateToString(!0);let p=0,g=0,l=0,v=r.getFg(0),C=r.getBg(0);for(let k=0;k<r.getTrimmedLength();k++)if(r.loadCell(k,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==v||this._workCell.bg!==C){if(k-p>1){const E=this._getJoinedRanges(u,l,g,r,p);for(let w=0;w<E.length;w++)h.push(E[w])}p=k,l=g,v=this._workCell.fg,C=this._workCell.bg}g+=this._workCell.getChars().length||d.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-p>1){const k=this._getJoinedRanges(u,l,g,r,p);for(let E=0;E<k.length;E++)h.push(k[E])}return h}_getJoinedRanges(t,r,h,u,p){const g=t.substring(r,h);let l=[];try{l=this._characterJoiners[0].handler(g)}catch(v){console.error(v)}for(let v=1;v<this._characterJoiners.length;v++)try{const C=this._characterJoiners[v].handler(g);for(let k=0;k<C.length;k++)pi._mergeRanges(l,C[k])}catch(C){console.error(C)}return this._stringRangesToCellRanges(l,u,p),l}_stringRangesToCellRanges(t,r,h){let u=0,p=!1,g=0,l=t[u];if(l){for(let v=h;v<this._bufferService.cols;v++){const C=r.getWidth(v),k=r.getString(v).length||d.WHITESPACE_CELL_CHAR.length;if(C!==0){if(!p&&l[0]<=g&&(l[0]=v,p=!0),l[1]<=g){if(l[1]=v,l=t[++u],!l)break;l[0]<=g?(l[0]=v,p=!0):p=!1}g+=k}}l&&(l[1]=this._bufferService.cols)}}static _mergeRanges(t,r){let h=!1;for(let u=0;u<t.length;u++){const p=t[u];if(h){if(r[1]<=p[0])return t[u-1][1]=r[1],t;if(r[1]<=p[1])return t[u-1][1]=Math.max(r[1],p[1]),t.splice(u,1),t;t.splice(u,1),u--}else{if(r[1]<=p[0])return t.splice(u,0,r),t;if(r[1]<=p[1])return p[0]=Math.min(r[0],p[0]),t;r[0]<p[1]&&(p[0]=Math.min(r[0],p[0]),h=!0)}}return h?t[t.length-1][1]=r[1]:t.push(r),t}};i.CharacterJoinerService=e=a([c(0,m.IBufferService)],e)},5114:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreBrowserService=void 0,i.CoreBrowserService=class{constructor(o,a){this._textarea=o,this.window=a,this._isFocused=!1,this._cachedIsFocused=void 0,this._textarea.addEventListener("focus",()=>this._isFocused=!0),this._textarea.addEventListener("blur",()=>this._isFocused=!1)}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask(()=>this._cachedIsFocused=void 0)),this._cachedIsFocused}}},8934:function(y,i,o){var a=this&&this.__decorate||function(m,f,e,s){var t,r=arguments.length,h=r<3?f:s===null?s=Object.getOwnPropertyDescriptor(f,e):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(m,f,e,s);else for(var u=m.length-1;u>=0;u--)(t=m[u])&&(h=(r<3?t(h):r>3?t(f,e,h):t(f,e))||h);return r>3&&h&&Object.defineProperty(f,e,h),h},c=this&&this.__param||function(m,f){return function(e,s){f(e,s,m)}};Object.defineProperty(i,"__esModule",{value:!0}),i.MouseService=void 0;const n=o(4725),d=o(9806);let _=i.MouseService=class{constructor(m,f){this._renderService=m,this._charSizeService=f}getCoords(m,f,e,s,t){return(0,d.getCoords)(window,m,f,e,s,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,t)}getMouseReportCoords(m,f){const e=(0,d.getCoordsRelativeToElement)(window,m,f);if(this._charSizeService.hasValidSize)return e[0]=Math.min(Math.max(e[0],0),this._renderService.dimensions.css.canvas.width-1),e[1]=Math.min(Math.max(e[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};i.MouseService=_=a([c(0,n.IRenderService),c(1,n.ICharSizeService)],_)},3230:function(y,i,o){var a=this&&this.__decorate||function(h,u,p,g){var l,v=arguments.length,C=v<3?u:g===null?g=Object.getOwnPropertyDescriptor(u,p):g;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(h,u,p,g);else for(var k=h.length-1;k>=0;k--)(l=h[k])&&(C=(v<3?l(C):v>3?l(u,p,C):l(u,p))||C);return v>3&&C&&Object.defineProperty(u,p,C),C},c=this&&this.__param||function(h,u){return function(p,g){u(p,g,h)}};Object.defineProperty(i,"__esModule",{value:!0}),i.RenderService=void 0;const n=o(3656),d=o(6193),_=o(5596),m=o(4725),f=o(8460),e=o(844),s=o(7226),t=o(2585);let r=i.RenderService=class extends e.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(h,u,p,g,l,v,C,k){if(super(),this._rowCount=h,this._charSizeService=g,this._renderer=this.register(new e.MutableDisposable),this._pausedResizeTask=new s.DebouncedIdleTask,this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new f.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new f.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new f.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new f.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new d.RenderDebouncer(C.window,(E,w)=>this._renderRows(E,w)),this.register(this._renderDebouncer),this._screenDprMonitor=new _.ScreenDprMonitor(C.window),this._screenDprMonitor.setListener(()=>this.handleDevicePixelRatioChange()),this.register(this._screenDprMonitor),this.register(v.onResize(()=>this._fullRefresh())),this.register(v.buffers.onBufferActivate(()=>{var E;return(E=this._renderer.value)===null||E===void 0?void 0:E.clear()})),this.register(p.onOptionChange(()=>this._handleOptionsChanged())),this.register(this._charSizeService.onCharSizeChange(()=>this.handleCharSizeChanged())),this.register(l.onDecorationRegistered(()=>this._fullRefresh())),this.register(l.onDecorationRemoved(()=>this._fullRefresh())),this.register(p.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio"],()=>{this.clear(),this.handleResize(v.cols,v.rows),this._fullRefresh()})),this.register(p.onMultipleOptionChange(["cursorBlink","cursorStyle"],()=>this.refreshRows(v.buffer.y,v.buffer.y,!0))),this.register((0,n.addDisposableDomListener)(C.window,"resize",()=>this.handleDevicePixelRatioChange())),this.register(k.onChangeColors(()=>this._fullRefresh())),"IntersectionObserver"in C.window){const E=new C.window.IntersectionObserver(w=>this._handleIntersectionChange(w[w.length-1]),{threshold:0});E.observe(u),this.register({dispose:()=>E.disconnect()})}}_handleIntersectionChange(h){this._isPaused=h.isIntersecting===void 0?h.intersectionRatio===0:!h.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(h,u,p=!1){this._isPaused?this._needsFullRefresh=!0:(p||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(h,u,this._rowCount))}_renderRows(h,u){this._renderer.value&&(h=Math.min(h,this._rowCount-1),u=Math.min(u,this._rowCount-1),this._renderer.value.renderRows(h,u),this._needsSelectionRefresh&&(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),this._needsSelectionRefresh=!1),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:h,end:u}),this._onRender.fire({start:h,end:u}),this._isNextRenderRedrawOnly=!0)}resize(h,u){this._rowCount=u,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(h){this._renderer.value=h,this._renderer.value.onRequestRedraw(u=>this.refreshRows(u.start,u.end,!0)),this._needsSelectionRefresh=!0,this._fullRefresh()}addRefreshCallback(h){return this._renderDebouncer.addRefreshCallback(h)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var h,u;this._renderer.value&&((u=(h=this._renderer.value).clearTextureAtlas)===null||u===void 0||u.call(h),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(h,u){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set(()=>this._renderer.value.handleResize(h,u)):this._renderer.value.handleResize(h,u),this._fullRefresh())}handleCharSizeChanged(){var h;(h=this._renderer.value)===null||h===void 0||h.handleCharSizeChanged()}handleBlur(){var h;(h=this._renderer.value)===null||h===void 0||h.handleBlur()}handleFocus(){var h;(h=this._renderer.value)===null||h===void 0||h.handleFocus()}handleSelectionChanged(h,u,p){var g;this._selectionState.start=h,this._selectionState.end=u,this._selectionState.columnSelectMode=p,(g=this._renderer.value)===null||g===void 0||g.handleSelectionChanged(h,u,p)}handleCursorMove(){var h;(h=this._renderer.value)===null||h===void 0||h.handleCursorMove()}clear(){var h;(h=this._renderer.value)===null||h===void 0||h.clear()}};i.RenderService=r=a([c(2,t.IOptionsService),c(3,m.ICharSizeService),c(4,t.IDecorationService),c(5,t.IBufferService),c(6,m.ICoreBrowserService),c(7,m.IThemeService)],r)},9312:function(y,i,o){var a=this&&this.__decorate||function(l,v,C,k){var E,w=arguments.length,P=w<3?v:k===null?k=Object.getOwnPropertyDescriptor(v,C):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")P=Reflect.decorate(l,v,C,k);else for(var H=l.length-1;H>=0;H--)(E=l[H])&&(P=(w<3?E(P):w>3?E(v,C,P):E(v,C))||P);return w>3&&P&&Object.defineProperty(v,C,P),P},c=this&&this.__param||function(l,v){return function(C,k){v(C,k,l)}};Object.defineProperty(i,"__esModule",{value:!0}),i.SelectionService=void 0;const n=o(9806),d=o(9504),_=o(456),m=o(4725),f=o(8460),e=o(844),s=o(6114),t=o(4841),r=o(511),h=o(2585),u=" ",p=new RegExp(u,"g");let g=i.SelectionService=class extends e.Disposable{constructor(l,v,C,k,E,w,P,H,W){super(),this._element=l,this._screenElement=v,this._linkifier=C,this._bufferService=k,this._coreService=E,this._mouseService=w,this._optionsService=P,this._renderService=H,this._coreBrowserService=W,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new r.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new f.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new f.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new f.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new f.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=U=>this._handleMouseMove(U),this._mouseUpListener=U=>this._handleMouseUp(U),this._coreService.onUserInput(()=>{this.hasSelection&&this.clearSelection()}),this._trimListener=this._bufferService.buffer.lines.onTrim(U=>this._handleTrim(U)),this.register(this._bufferService.buffers.onBufferActivate(U=>this._handleBufferActivate(U))),this.enable(),this._model=new _.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,e.toDisposable)(()=>{this._removeMouseDownListeners()}))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){const l=this._model.finalSelectionStart,v=this._model.finalSelectionEnd;return!(!l||!v||l[0]===v[0]&&l[1]===v[1])}get selectionText(){const l=this._model.finalSelectionStart,v=this._model.finalSelectionEnd;if(!l||!v)return"";const C=this._bufferService.buffer,k=[];if(this._activeSelectionMode===3){if(l[0]===v[0])return"";const E=l[0]<v[0]?l[0]:v[0],w=l[0]<v[0]?v[0]:l[0];for(let P=l[1];P<=v[1];P++){const H=C.translateBufferLineToString(P,!0,E,w);k.push(H)}}else{const E=l[1]===v[1]?v[0]:void 0;k.push(C.translateBufferLineToString(l[1],!0,l[0],E));for(let w=l[1]+1;w<=v[1]-1;w++){const P=C.lines.get(w),H=C.translateBufferLineToString(w,!0);P!=null&&P.isWrapped?k[k.length-1]+=H:k.push(H)}if(l[1]!==v[1]){const w=C.lines.get(v[1]),P=C.translateBufferLineToString(v[1],!0,0,v[0]);w&&w.isWrapped?k[k.length-1]+=P:k.push(P)}}return k.map(E=>E.replace(p," ")).join(s.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(l){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame(()=>this._refresh())),s.isLinux&&l&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(l){const v=this._getMouseBufferCoords(l),C=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!!(C&&k&&v)&&this._areCoordsInSelection(v,C,k)}isCellInSelection(l,v){const C=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!(!C||!k)&&this._areCoordsInSelection([l,v],C,k)}_areCoordsInSelection(l,v,C){return l[1]>v[1]&&l[1]<C[1]||v[1]===C[1]&&l[1]===v[1]&&l[0]>=v[0]&&l[0]<C[0]||v[1]<C[1]&&l[1]===C[1]&&l[0]<C[0]||v[1]<C[1]&&l[1]===v[1]&&l[0]>=v[0]}_selectWordAtCursor(l,v){var C,k;const E=(k=(C=this._linkifier.currentLink)===null||C===void 0?void 0:C.link)===null||k===void 0?void 0:k.range;if(E)return this._model.selectionStart=[E.start.x-1,E.start.y-1],this._model.selectionStartLength=(0,t.getRangeLength)(E,this._bufferService.cols),this._model.selectionEnd=void 0,!0;const w=this._getMouseBufferCoords(l);return!!w&&(this._selectWordAt(w,v),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(l,v){this._model.clearSelection(),l=Math.max(l,0),v=Math.min(v,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,l],this._model.selectionEnd=[this._bufferService.cols,v],this.refresh(),this._onSelectionChange.fire()}_handleTrim(l){this._model.handleTrim(l)&&this.refresh()}_getMouseBufferCoords(l){const v=this._mouseService.getCoords(l,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(v)return v[0]--,v[1]--,v[1]+=this._bufferService.buffer.ydisp,v}_getMouseEventScrollAmount(l){let v=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,l,this._screenElement)[1];const C=this._renderService.dimensions.css.canvas.height;return v>=0&&v<=C?0:(v>C&&(v-=C),v=Math.min(Math.max(v,-50),50),v/=50,v/Math.abs(v)+Math.round(14*v))}shouldForceSelection(l){return s.isMac?l.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:l.shiftKey}handleMouseDown(l){if(this._mouseDownTimeStamp=l.timeStamp,(l.button!==2||!this.hasSelection)&&l.button===0){if(!this._enabled){if(!this.shouldForceSelection(l))return;l.stopPropagation()}l.preventDefault(),this._dragScrollAmount=0,this._enabled&&l.shiftKey?this._handleIncrementalClick(l):l.detail===1?this._handleSingleClick(l):l.detail===2?this._handleDoubleClick(l):l.detail===3&&this._handleTripleClick(l),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval(()=>this._dragScroll(),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(l){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(l))}_handleSingleClick(l){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(l)?3:0,this._model.selectionStart=this._getMouseBufferCoords(l),!this._model.selectionStart)return;this._model.selectionEnd=void 0;const v=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);v&&v.length!==this._model.selectionStart[0]&&v.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(l){this._selectWordAtCursor(l,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(l){const v=this._getMouseBufferCoords(l);v&&(this._activeSelectionMode=2,this._selectLineAt(v[1]))}shouldColumnSelect(l){return l.altKey&&!(s.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(l){if(l.stopImmediatePropagation(),!this._model.selectionStart)return;const v=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(l),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(l),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));const C=this._bufferService.buffer;if(this._model.selectionEnd[1]<C.lines.length){const k=C.lines.get(this._model.selectionEnd[1]);k&&k.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]++}v&&v[0]===this._model.selectionEnd[0]&&v[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});const l=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(l.ydisp+this._bufferService.rows,l.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=l.ydisp),this.refresh()}}_handleMouseUp(l){const v=l.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&v<500&&l.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){const C=this._mouseService.getCoords(l,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(C&&C[0]!==void 0&&C[1]!==void 0){const k=(0,d.moveToCellSequence)(C[0]-1,C[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(k,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){const l=this._model.finalSelectionStart,v=this._model.finalSelectionEnd,C=!(!l||!v||l[0]===v[0]&&l[1]===v[1]);C?l&&v&&(this._oldSelectionStart&&this._oldSelectionEnd&&l[0]===this._oldSelectionStart[0]&&l[1]===this._oldSelectionStart[1]&&v[0]===this._oldSelectionEnd[0]&&v[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(l,v,C)):this._oldHasSelection&&this._fireOnSelectionChange(l,v,C)}_fireOnSelectionChange(l,v,C){this._oldSelectionStart=l,this._oldSelectionEnd=v,this._oldHasSelection=C,this._onSelectionChange.fire()}_handleBufferActivate(l){this.clearSelection(),this._trimListener.dispose(),this._trimListener=l.activeBuffer.lines.onTrim(v=>this._handleTrim(v))}_convertViewportColToCharacterIndex(l,v){let C=v;for(let k=0;v>=k;k++){const E=l.loadCell(k,this._workCell).getChars().length;this._workCell.getWidth()===0?C--:E>1&&v!==k&&(C+=E-1)}return C}setSelection(l,v,C){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[l,v],this._model.selectionStartLength=C,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(l){this._isClickInSelection(l)||(this._selectWordAtCursor(l,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(l,v,C=!0,k=!0){if(l[0]>=this._bufferService.cols)return;const E=this._bufferService.buffer,w=E.lines.get(l[1]);if(!w)return;const P=E.translateBufferLineToString(l[1],!1);let H=this._convertViewportColToCharacterIndex(w,l[0]),W=H;const U=l[0]-H;let S=0,R=0,D=0,O=0;if(P.charAt(H)===" "){for(;H>0&&P.charAt(H-1)===" ";)H--;for(;W<P.length&&P.charAt(W+1)===" ";)W++}else{let X=l[0],K=l[0];w.getWidth(X)===0&&(S++,X--),w.getWidth(K)===2&&(R++,K++);const Z=w.getString(K).length;for(Z>1&&(O+=Z-1,W+=Z-1);X>0&&H>0&&!this._isCharWordSeparator(w.loadCell(X-1,this._workCell));){w.loadCell(X-1,this._workCell);const b=this._workCell.getChars().length;this._workCell.getWidth()===0?(S++,X--):b>1&&(D+=b-1,H-=b-1),H--,X--}for(;K<w.length&&W+1<P.length&&!this._isCharWordSeparator(w.loadCell(K+1,this._workCell));){w.loadCell(K+1,this._workCell);const b=this._workCell.getChars().length;this._workCell.getWidth()===2?(R++,K++):b>1&&(O+=b-1,W+=b-1),W++,K++}}W++;let j=H+U-S+D,$=Math.min(this._bufferService.cols,W-H+S+R-D-O);if(v||P.slice(H,W).trim()!==""){if(C&&j===0&&w.getCodePoint(0)!==32){const X=E.lines.get(l[1]-1);if(X&&w.isWrapped&&X.getCodePoint(this._bufferService.cols-1)!==32){const K=this._getWordAt([this._bufferService.cols-1,l[1]-1],!1,!0,!1);if(K){const Z=this._bufferService.cols-K.start;j-=Z,$+=Z}}}if(k&&j+$===this._bufferService.cols&&w.getCodePoint(this._bufferService.cols-1)!==32){const X=E.lines.get(l[1]+1);if(X!=null&&X.isWrapped&&X.getCodePoint(0)!==32){const K=this._getWordAt([0,l[1]+1],!1,!1,!0);K&&($+=K.length)}}return{start:j,length:$}}}_selectWordAt(l,v){const C=this._getWordAt(l,v);if(C){for(;C.start<0;)C.start+=this._bufferService.cols,l[1]--;this._model.selectionStart=[C.start,l[1]],this._model.selectionStartLength=C.length}}_selectToWordAt(l){const v=this._getWordAt(l,!0);if(v){let C=l[1];for(;v.start<0;)v.start+=this._bufferService.cols,C--;if(!this._model.areSelectionValuesReversed())for(;v.start+v.length>this._bufferService.cols;)v.length-=this._bufferService.cols,C++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?v.start:v.start+v.length,C]}}_isCharWordSeparator(l){return l.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(l.getChars())>=0}_selectLineAt(l){const v=this._bufferService.buffer.getWrappedRangeForLine(l),C={start:{x:0,y:v.first},end:{x:this._bufferService.cols-1,y:v.last}};this._model.selectionStart=[0,v.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,t.getRangeLength)(C,this._bufferService.cols)}};i.SelectionService=g=a([c(3,h.IBufferService),c(4,h.ICoreService),c(5,m.IMouseService),c(6,h.IOptionsService),c(7,m.IRenderService),c(8,m.ICoreBrowserService)],g)},4725:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IThemeService=i.ICharacterJoinerService=i.ISelectionService=i.IRenderService=i.IMouseService=i.ICoreBrowserService=i.ICharSizeService=void 0;const a=o(8343);i.ICharSizeService=(0,a.createDecorator)("CharSizeService"),i.ICoreBrowserService=(0,a.createDecorator)("CoreBrowserService"),i.IMouseService=(0,a.createDecorator)("MouseService"),i.IRenderService=(0,a.createDecorator)("RenderService"),i.ISelectionService=(0,a.createDecorator)("SelectionService"),i.ICharacterJoinerService=(0,a.createDecorator)("CharacterJoinerService"),i.IThemeService=(0,a.createDecorator)("ThemeService")},6731:function(y,i,o){var a=this&&this.__decorate||function(g,l,v,C){var k,E=arguments.length,w=E<3?l:C===null?C=Object.getOwnPropertyDescriptor(l,v):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(g,l,v,C);else for(var P=g.length-1;P>=0;P--)(k=g[P])&&(w=(E<3?k(w):E>3?k(l,v,w):k(l,v))||w);return E>3&&w&&Object.defineProperty(l,v,w),w},c=this&&this.__param||function(g,l){return function(v,C){l(v,C,g)}};Object.defineProperty(i,"__esModule",{value:!0}),i.ThemeService=i.DEFAULT_ANSI_COLORS=void 0;const n=o(7239),d=o(8055),_=o(8460),m=o(844),f=o(2585),e=d.css.toColor("#ffffff"),s=d.css.toColor("#000000"),t=d.css.toColor("#ffffff"),r=d.css.toColor("#000000"),h={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};i.DEFAULT_ANSI_COLORS=Object.freeze((()=>{const g=[d.css.toColor("#2e3436"),d.css.toColor("#cc0000"),d.css.toColor("#4e9a06"),d.css.toColor("#c4a000"),d.css.toColor("#3465a4"),d.css.toColor("#75507b"),d.css.toColor("#06989a"),d.css.toColor("#d3d7cf"),d.css.toColor("#555753"),d.css.toColor("#ef2929"),d.css.toColor("#8ae234"),d.css.toColor("#fce94f"),d.css.toColor("#729fcf"),d.css.toColor("#ad7fa8"),d.css.toColor("#34e2e2"),d.css.toColor("#eeeeec")],l=[0,95,135,175,215,255];for(let v=0;v<216;v++){const C=l[v/36%6|0],k=l[v/6%6|0],E=l[v%6];g.push({css:d.channels.toCss(C,k,E),rgba:d.channels.toRgba(C,k,E)})}for(let v=0;v<24;v++){const C=8+10*v;g.push({css:d.channels.toCss(C,C,C),rgba:d.channels.toRgba(C,C,C)})}return g})());let u=i.ThemeService=class extends m.Disposable{get colors(){return this._colors}constructor(g){super(),this._optionsService=g,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new _.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:e,background:s,cursor:t,cursorAccent:r,selectionForeground:void 0,selectionBackgroundTransparent:h,selectionBackgroundOpaque:d.color.blend(s,h),selectionInactiveBackgroundTransparent:h,selectionInactiveBackgroundOpaque:d.color.blend(s,h),ansi:i.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",()=>this._contrastCache.clear())),this.register(this._optionsService.onSpecificOptionChange("theme",()=>this._setTheme(this._optionsService.rawOptions.theme)))}_setTheme(g={}){const l=this._colors;if(l.foreground=p(g.foreground,e),l.background=p(g.background,s),l.cursor=p(g.cursor,t),l.cursorAccent=p(g.cursorAccent,r),l.selectionBackgroundTransparent=p(g.selectionBackground,h),l.selectionBackgroundOpaque=d.color.blend(l.background,l.selectionBackgroundTransparent),l.selectionInactiveBackgroundTransparent=p(g.selectionInactiveBackground,l.selectionBackgroundTransparent),l.selectionInactiveBackgroundOpaque=d.color.blend(l.background,l.selectionInactiveBackgroundTransparent),l.selectionForeground=g.selectionForeground?p(g.selectionForeground,d.NULL_COLOR):void 0,l.selectionForeground===d.NULL_COLOR&&(l.selectionForeground=void 0),d.color.isOpaque(l.selectionBackgroundTransparent)&&(l.selectionBackgroundTransparent=d.color.opacity(l.selectionBackgroundTransparent,.3)),d.color.isOpaque(l.selectionInactiveBackgroundTransparent)&&(l.selectionInactiveBackgroundTransparent=d.color.opacity(l.selectionInactiveBackgroundTransparent,.3)),l.ansi=i.DEFAULT_ANSI_COLORS.slice(),l.ansi[0]=p(g.black,i.DEFAULT_ANSI_COLORS[0]),l.ansi[1]=p(g.red,i.DEFAULT_ANSI_COLORS[1]),l.ansi[2]=p(g.green,i.DEFAULT_ANSI_COLORS[2]),l.ansi[3]=p(g.yellow,i.DEFAULT_ANSI_COLORS[3]),l.ansi[4]=p(g.blue,i.DEFAULT_ANSI_COLORS[4]),l.ansi[5]=p(g.magenta,i.DEFAULT_ANSI_COLORS[5]),l.ansi[6]=p(g.cyan,i.DEFAULT_ANSI_COLORS[6]),l.ansi[7]=p(g.white,i.DEFAULT_ANSI_COLORS[7]),l.ansi[8]=p(g.brightBlack,i.DEFAULT_ANSI_COLORS[8]),l.ansi[9]=p(g.brightRed,i.DEFAULT_ANSI_COLORS[9]),l.ansi[10]=p(g.brightGreen,i.DEFAULT_ANSI_COLORS[10]),l.ansi[11]=p(g.brightYellow,i.DEFAULT_ANSI_COLORS[11]),l.ansi[12]=p(g.brightBlue,i.DEFAULT_ANSI_COLORS[12]),l.ansi[13]=p(g.brightMagenta,i.DEFAULT_ANSI_COLORS[13]),l.ansi[14]=p(g.brightCyan,i.DEFAULT_ANSI_COLORS[14]),l.ansi[15]=p(g.brightWhite,i.DEFAULT_ANSI_COLORS[15]),g.extendedAnsi){const v=Math.min(l.ansi.length-16,g.extendedAnsi.length);for(let C=0;C<v;C++)l.ansi[C+16]=p(g.extendedAnsi[C],i.DEFAULT_ANSI_COLORS[C+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(g){this._restoreColor(g),this._onChangeColors.fire(this.colors)}_restoreColor(g){if(g!==void 0)switch(g){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[g]=this._restoreColors.ansi[g]}else for(let l=0;l<this._restoreColors.ansi.length;++l)this._colors.ansi[l]=this._restoreColors.ansi[l]}modifyColors(g){g(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function p(g,l){if(g!==void 0)try{return d.css.toColor(g)}catch{}return l}i.ThemeService=u=a([c(0,f.IOptionsService)],u)},6349:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CircularList=void 0;const a=o(8460),c=o(844);class n extends c.Disposable{constructor(_){super(),this._maxLength=_,this.onDeleteEmitter=this.register(new a.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new a.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new a.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=new Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(_){if(this._maxLength===_)return;const m=new Array(_);for(let f=0;f<Math.min(_,this.length);f++)m[f]=this._array[this._getCyclicIndex(f)];this._array=m,this._maxLength=_,this._startIndex=0}get length(){return this._length}set length(_){if(_>this._length)for(let m=this._length;m<_;m++)this._array[m]=void 0;this._length=_}get(_){return this._array[this._getCyclicIndex(_)]}set(_,m){this._array[this._getCyclicIndex(_)]=m}push(_){this._array[this._getCyclicIndex(this._length)]=_,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw new Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(_,m,...f){if(m){for(let e=_;e<this._length-m;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+m)];this._length-=m,this.onDeleteEmitter.fire({index:_,amount:m})}for(let e=this._length-1;e>=_;e--)this._array[this._getCyclicIndex(e+f.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<f.length;e++)this._array[this._getCyclicIndex(_+e)]=f[e];if(f.length&&this.onInsertEmitter.fire({index:_,amount:f.length}),this._length+f.length>this._maxLength){const e=this._length+f.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=f.length}trimStart(_){_>this._length&&(_=this._length),this._startIndex+=_,this._length-=_,this.onTrimEmitter.fire(_)}shiftElements(_,m,f){if(!(m<=0)){if(_<0||_>=this._length)throw new Error("start argument out of range");if(_+f<0)throw new Error("Cannot shift elements in list beyond index 0");if(f>0){for(let s=m-1;s>=0;s--)this.set(_+s+f,this.get(_+s));const e=_+m+f-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<m;e++)this.set(_+e+f,this.get(_+e))}}_getCyclicIndex(_){return(this._startIndex+_)%this._maxLength}}i.CircularList=n},1439:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.clone=void 0,i.clone=function o(a,c=5){if(typeof a!="object")return a;const n=Array.isArray(a)?[]:{};for(const d in a)n[d]=c<=1?a[d]:a[d]&&o(a[d],c-1);return n}},8055:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.contrastRatio=i.toPaddedHex=i.rgba=i.rgb=i.css=i.color=i.channels=i.NULL_COLOR=void 0;const a=o(6114);let c=0,n=0,d=0,_=0;var m,f,e,s,t;function r(u){const p=u.toString(16);return p.length<2?"0"+p:p}function h(u,p){return u<p?(p+.05)/(u+.05):(u+.05)/(p+.05)}i.NULL_COLOR={css:"#00000000",rgba:0},function(u){u.toCss=function(p,g,l,v){return v!==void 0?`#${r(p)}${r(g)}${r(l)}${r(v)}`:`#${r(p)}${r(g)}${r(l)}`},u.toRgba=function(p,g,l,v=255){return(p<<24|g<<16|l<<8|v)>>>0}}(m||(i.channels=m={})),function(u){function p(g,l){return _=Math.round(255*l),[c,n,d]=t.toChannels(g.rgba),{css:m.toCss(c,n,d,_),rgba:m.toRgba(c,n,d,_)}}u.blend=function(g,l){if(_=(255&l.rgba)/255,_===1)return{css:l.css,rgba:l.rgba};const v=l.rgba>>24&255,C=l.rgba>>16&255,k=l.rgba>>8&255,E=g.rgba>>24&255,w=g.rgba>>16&255,P=g.rgba>>8&255;return c=E+Math.round((v-E)*_),n=w+Math.round((C-w)*_),d=P+Math.round((k-P)*_),{css:m.toCss(c,n,d),rgba:m.toRgba(c,n,d)}},u.isOpaque=function(g){return(255&g.rgba)==255},u.ensureContrastRatio=function(g,l,v){const C=t.ensureContrastRatio(g.rgba,l.rgba,v);if(C)return t.toColor(C>>24&255,C>>16&255,C>>8&255)},u.opaque=function(g){const l=(255|g.rgba)>>>0;return[c,n,d]=t.toChannels(l),{css:m.toCss(c,n,d),rgba:l}},u.opacity=p,u.multiplyOpacity=function(g,l){return _=255&g.rgba,p(g,_*l/255)},u.toColorRGB=function(g){return[g.rgba>>24&255,g.rgba>>16&255,g.rgba>>8&255]}}(f||(i.color=f={})),function(u){let p,g;if(!a.isNode){const l=document.createElement("canvas");l.width=1,l.height=1;const v=l.getContext("2d",{willReadFrequently:!0});v&&(p=v,p.globalCompositeOperation="copy",g=p.createLinearGradient(0,0,1,1))}u.toColor=function(l){if(l.match(/#[\da-f]{3,8}/i))switch(l.length){case 4:return c=parseInt(l.slice(1,2).repeat(2),16),n=parseInt(l.slice(2,3).repeat(2),16),d=parseInt(l.slice(3,4).repeat(2),16),t.toColor(c,n,d);case 5:return c=parseInt(l.slice(1,2).repeat(2),16),n=parseInt(l.slice(2,3).repeat(2),16),d=parseInt(l.slice(3,4).repeat(2),16),_=parseInt(l.slice(4,5).repeat(2),16),t.toColor(c,n,d,_);case 7:return{css:l,rgba:(parseInt(l.slice(1),16)<<8|255)>>>0};case 9:return{css:l,rgba:parseInt(l.slice(1),16)>>>0}}const v=l.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(v)return c=parseInt(v[1]),n=parseInt(v[2]),d=parseInt(v[3]),_=Math.round(255*(v[5]===void 0?1:parseFloat(v[5]))),t.toColor(c,n,d,_);if(!p||!g)throw new Error("css.toColor: Unsupported css format");if(p.fillStyle=g,p.fillStyle=l,typeof p.fillStyle!="string")throw new Error("css.toColor: Unsupported css format");if(p.fillRect(0,0,1,1),[c,n,d,_]=p.getImageData(0,0,1,1).data,_!==255)throw new Error("css.toColor: Unsupported css format");return{rgba:m.toRgba(c,n,d,_),css:l}}}(e||(i.css=e={})),function(u){function p(g,l,v){const C=g/255,k=l/255,E=v/255;return .2126*(C<=.03928?C/12.92:Math.pow((C+.055)/1.055,2.4))+.7152*(k<=.03928?k/12.92:Math.pow((k+.055)/1.055,2.4))+.0722*(E<=.03928?E/12.92:Math.pow((E+.055)/1.055,2.4))}u.relativeLuminance=function(g){return p(g>>16&255,g>>8&255,255&g)},u.relativeLuminance2=p}(s||(i.rgb=s={})),function(u){function p(l,v,C){const k=l>>24&255,E=l>>16&255,w=l>>8&255;let P=v>>24&255,H=v>>16&255,W=v>>8&255,U=h(s.relativeLuminance2(P,H,W),s.relativeLuminance2(k,E,w));for(;U<C&&(P>0||H>0||W>0);)P-=Math.max(0,Math.ceil(.1*P)),H-=Math.max(0,Math.ceil(.1*H)),W-=Math.max(0,Math.ceil(.1*W)),U=h(s.relativeLuminance2(P,H,W),s.relativeLuminance2(k,E,w));return(P<<24|H<<16|W<<8|255)>>>0}function g(l,v,C){const k=l>>24&255,E=l>>16&255,w=l>>8&255;let P=v>>24&255,H=v>>16&255,W=v>>8&255,U=h(s.relativeLuminance2(P,H,W),s.relativeLuminance2(k,E,w));for(;U<C&&(P<255||H<255||W<255);)P=Math.min(255,P+Math.ceil(.1*(255-P))),H=Math.min(255,H+Math.ceil(.1*(255-H))),W=Math.min(255,W+Math.ceil(.1*(255-W))),U=h(s.relativeLuminance2(P,H,W),s.relativeLuminance2(k,E,w));return(P<<24|H<<16|W<<8|255)>>>0}u.ensureContrastRatio=function(l,v,C){const k=s.relativeLuminance(l>>8),E=s.relativeLuminance(v>>8);if(h(k,E)<C){if(E<k){const H=p(l,v,C),W=h(k,s.relativeLuminance(H>>8));if(W<C){const U=g(l,v,C);return W>h(k,s.relativeLuminance(U>>8))?H:U}return H}const w=g(l,v,C),P=h(k,s.relativeLuminance(w>>8));if(P<C){const H=p(l,v,C);return P>h(k,s.relativeLuminance(H>>8))?w:H}return w}},u.reduceLuminance=p,u.increaseLuminance=g,u.toChannels=function(l){return[l>>24&255,l>>16&255,l>>8&255,255&l]},u.toColor=function(l,v,C,k){return{css:m.toCss(l,v,C,k),rgba:m.toRgba(l,v,C,k)}}}(t||(i.rgba=t={})),i.toPaddedHex=r,i.contrastRatio=h},8969:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CoreTerminal=void 0;const a=o(844),c=o(2585),n=o(4348),d=o(7866),_=o(744),m=o(7302),f=o(6975),e=o(8460),s=o(1753),t=o(1480),r=o(7994),h=o(9282),u=o(5435),p=o(5981),g=o(2660);let l=!1;class v extends a.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event(k=>{var E;(E=this._onScrollApi)===null||E===void 0||E.fire(k.position)})),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(k){for(const E in k)this.optionsService.options[E]=k[E]}constructor(k){super(),this._windowsWrappingHeuristics=this.register(new a.MutableDisposable),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new m.OptionsService(k)),this._instantiationService.setService(c.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(_.BufferService)),this._instantiationService.setService(c.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(d.LogService)),this._instantiationService.setService(c.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(f.CoreService)),this._instantiationService.setService(c.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(s.CoreMouseService)),this._instantiationService.setService(c.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(t.UnicodeService)),this._instantiationService.setService(c.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(r.CharsetService),this._instantiationService.setService(c.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(g.OscLinkService),this._instantiationService.setService(c.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new u.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom(()=>this.scrollToBottom())),this.register(this.coreService.onUserInput(()=>this._writeBuffer.handleUserInput())),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],()=>this._handleWindowsPtyOptionChange())),this.register(this._bufferService.onScroll(E=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this.register(this._inputHandler.onScroll(E=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)})),this._writeBuffer=this.register(new p.WriteBuffer((E,w)=>this._inputHandler.parse(E,w))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(k,E){this._writeBuffer.write(k,E)}writeSync(k,E){this._logService.logLevel<=c.LogLevelEnum.WARN&&!l&&(this._logService.warn("writeSync is unreliable and will be removed soon."),l=!0),this._writeBuffer.writeSync(k,E)}resize(k,E){isNaN(k)||isNaN(E)||(k=Math.max(k,_.MINIMUM_COLS),E=Math.max(E,_.MINIMUM_ROWS),this._bufferService.resize(k,E))}scroll(k,E=!1){this._bufferService.scroll(k,E)}scrollLines(k,E,w){this._bufferService.scrollLines(k,E,w)}scrollPages(k){this.scrollLines(k*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(k){const E=k-this._bufferService.buffer.ydisp;E!==0&&this.scrollLines(E)}registerEscHandler(k,E){return this._inputHandler.registerEscHandler(k,E)}registerDcsHandler(k,E){return this._inputHandler.registerDcsHandler(k,E)}registerCsiHandler(k,E){return this._inputHandler.registerCsiHandler(k,E)}registerOscHandler(k,E){return this._inputHandler.registerOscHandler(k,E)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let k=!1;const E=this.optionsService.rawOptions.windowsPty;E&&E.buildNumber!==void 0&&E.buildNumber!==void 0?k=E.backend==="conpty"&&E.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(k=!0),k?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){const k=[];k.push(this.onLineFeed(h.updateWindowsModeWrappedState.bind(null,this._bufferService))),k.push(this.registerCsiHandler({final:"H"},()=>((0,h.updateWindowsModeWrappedState)(this._bufferService),!1))),this._windowsWrappingHeuristics.value=(0,a.toDisposable)(()=>{for(const E of k)E.dispose()})}}}i.CoreTerminal=v},8460:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.forwardEvent=i.EventEmitter=void 0,i.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=o=>(this._listeners.push(o),{dispose:()=>{if(!this._disposed){for(let a=0;a<this._listeners.length;a++)if(this._listeners[a]===o)return void this._listeners.splice(a,1)}}})),this._event}fire(o,a){const c=[];for(let n=0;n<this._listeners.length;n++)c.push(this._listeners[n]);for(let n=0;n<c.length;n++)c[n].call(void 0,o,a)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},i.forwardEvent=function(o,a){return o(c=>a.fire(c))}},5435:function(y,i,o){var a=this&&this.__decorate||function(U,S,R,D){var O,j=arguments.length,$=j<3?S:D===null?D=Object.getOwnPropertyDescriptor(S,R):D;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")$=Reflect.decorate(U,S,R,D);else for(var X=U.length-1;X>=0;X--)(O=U[X])&&($=(j<3?O($):j>3?O(S,R,$):O(S,R))||$);return j>3&&$&&Object.defineProperty(S,R,$),$},c=this&&this.__param||function(U,S){return function(R,D){S(R,D,U)}};Object.defineProperty(i,"__esModule",{value:!0}),i.InputHandler=i.WindowsOptionsReportType=void 0;const n=o(2584),d=o(7116),_=o(2015),m=o(844),f=o(482),e=o(8437),s=o(8460),t=o(643),r=o(511),h=o(3734),u=o(2585),p=o(6242),g=o(6351),l=o(5941),v={"(":0,")":1,"*":2,"+":3,"-":1,".":2},C=131072;function k(U,S){if(U>24)return S.setWinLines||!1;switch(U){case 1:return!!S.restoreWin;case 2:return!!S.minimizeWin;case 3:return!!S.setWinPosition;case 4:return!!S.setWinSizePixels;case 5:return!!S.raiseWin;case 6:return!!S.lowerWin;case 7:return!!S.refreshWin;case 8:return!!S.setWinSizeChars;case 9:return!!S.maximizeWin;case 10:return!!S.fullscreenWin;case 11:return!!S.getWinState;case 13:return!!S.getWinPosition;case 14:return!!S.getWinSizePixels;case 15:return!!S.getScreenSizePixels;case 16:return!!S.getCellSizePixels;case 18:return!!S.getWinSizeChars;case 19:return!!S.getScreenSizeChars;case 20:return!!S.getIconTitle;case 21:return!!S.getWinTitle;case 22:return!!S.pushTitle;case 23:return!!S.popTitle;case 24:return!!S.setWinLines}return!1}var E;(function(U){U[U.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",U[U.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(E||(i.WindowsOptionsReportType=E={}));let w=0;class P extends m.Disposable{getAttrData(){return this._curAttrData}constructor(S,R,D,O,j,$,X,K,Z=new _.EscapeSequenceParser){super(),this._bufferService=S,this._charsetService=R,this._coreService=D,this._logService=O,this._optionsService=j,this._oscLinkService=$,this._coreMouseService=X,this._unicodeService=K,this._parser=Z,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new f.StringToUtf32,this._utf8Decoder=new f.Utf8ToUtf32,this._workCell=new r.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new s.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new s.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new s.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new s.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new s.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new s.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new s.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new s.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new s.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new s.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new s.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new s.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new s.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new H(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate(b=>this._activeBuffer=b.activeBuffer)),this._parser.setCsiHandlerFallback((b,I)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(b),params:I.toArray()})}),this._parser.setEscHandlerFallback(b=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(b)})}),this._parser.setExecuteHandlerFallback(b=>{this._logService.debug("Unknown EXECUTE code: ",{code:b})}),this._parser.setOscHandlerFallback((b,I,N)=>{this._logService.debug("Unknown OSC code: ",{identifier:b,action:I,data:N})}),this._parser.setDcsHandlerFallback((b,I,N)=>{I==="HOOK"&&(N=N.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(b),action:I,payload:N})}),this._parser.setPrintHandler((b,I,N)=>this.print(b,I,N)),this._parser.registerCsiHandler({final:"@"},b=>this.insertChars(b)),this._parser.registerCsiHandler({intermediates:" ",final:"@"},b=>this.scrollLeft(b)),this._parser.registerCsiHandler({final:"A"},b=>this.cursorUp(b)),this._parser.registerCsiHandler({intermediates:" ",final:"A"},b=>this.scrollRight(b)),this._parser.registerCsiHandler({final:"B"},b=>this.cursorDown(b)),this._parser.registerCsiHandler({final:"C"},b=>this.cursorForward(b)),this._parser.registerCsiHandler({final:"D"},b=>this.cursorBackward(b)),this._parser.registerCsiHandler({final:"E"},b=>this.cursorNextLine(b)),this._parser.registerCsiHandler({final:"F"},b=>this.cursorPrecedingLine(b)),this._parser.registerCsiHandler({final:"G"},b=>this.cursorCharAbsolute(b)),this._parser.registerCsiHandler({final:"H"},b=>this.cursorPosition(b)),this._parser.registerCsiHandler({final:"I"},b=>this.cursorForwardTab(b)),this._parser.registerCsiHandler({final:"J"},b=>this.eraseInDisplay(b,!1)),this._parser.registerCsiHandler({prefix:"?",final:"J"},b=>this.eraseInDisplay(b,!0)),this._parser.registerCsiHandler({final:"K"},b=>this.eraseInLine(b,!1)),this._parser.registerCsiHandler({prefix:"?",final:"K"},b=>this.eraseInLine(b,!0)),this._parser.registerCsiHandler({final:"L"},b=>this.insertLines(b)),this._parser.registerCsiHandler({final:"M"},b=>this.deleteLines(b)),this._parser.registerCsiHandler({final:"P"},b=>this.deleteChars(b)),this._parser.registerCsiHandler({final:"S"},b=>this.scrollUp(b)),this._parser.registerCsiHandler({final:"T"},b=>this.scrollDown(b)),this._parser.registerCsiHandler({final:"X"},b=>this.eraseChars(b)),this._parser.registerCsiHandler({final:"Z"},b=>this.cursorBackwardTab(b)),this._parser.registerCsiHandler({final:"`"},b=>this.charPosAbsolute(b)),this._parser.registerCsiHandler({final:"a"},b=>this.hPositionRelative(b)),this._parser.registerCsiHandler({final:"b"},b=>this.repeatPrecedingCharacter(b)),this._parser.registerCsiHandler({final:"c"},b=>this.sendDeviceAttributesPrimary(b)),this._parser.registerCsiHandler({prefix:">",final:"c"},b=>this.sendDeviceAttributesSecondary(b)),this._parser.registerCsiHandler({final:"d"},b=>this.linePosAbsolute(b)),this._parser.registerCsiHandler({final:"e"},b=>this.vPositionRelative(b)),this._parser.registerCsiHandler({final:"f"},b=>this.hVPosition(b)),this._parser.registerCsiHandler({final:"g"},b=>this.tabClear(b)),this._parser.registerCsiHandler({final:"h"},b=>this.setMode(b)),this._parser.registerCsiHandler({prefix:"?",final:"h"},b=>this.setModePrivate(b)),this._parser.registerCsiHandler({final:"l"},b=>this.resetMode(b)),this._parser.registerCsiHandler({prefix:"?",final:"l"},b=>this.resetModePrivate(b)),this._parser.registerCsiHandler({final:"m"},b=>this.charAttributes(b)),this._parser.registerCsiHandler({final:"n"},b=>this.deviceStatus(b)),this._parser.registerCsiHandler({prefix:"?",final:"n"},b=>this.deviceStatusPrivate(b)),this._parser.registerCsiHandler({intermediates:"!",final:"p"},b=>this.softReset(b)),this._parser.registerCsiHandler({intermediates:" ",final:"q"},b=>this.setCursorStyle(b)),this._parser.registerCsiHandler({final:"r"},b=>this.setScrollRegion(b)),this._parser.registerCsiHandler({final:"s"},b=>this.saveCursor(b)),this._parser.registerCsiHandler({final:"t"},b=>this.windowOptions(b)),this._parser.registerCsiHandler({final:"u"},b=>this.restoreCursor(b)),this._parser.registerCsiHandler({intermediates:"'",final:"}"},b=>this.insertColumns(b)),this._parser.registerCsiHandler({intermediates:"'",final:"~"},b=>this.deleteColumns(b)),this._parser.registerCsiHandler({intermediates:'"',final:"q"},b=>this.selectProtected(b)),this._parser.registerCsiHandler({intermediates:"$",final:"p"},b=>this.requestMode(b,!0)),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},b=>this.requestMode(b,!1)),this._parser.setExecuteHandler(n.C0.BEL,()=>this.bell()),this._parser.setExecuteHandler(n.C0.LF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.VT,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.FF,()=>this.lineFeed()),this._parser.setExecuteHandler(n.C0.CR,()=>this.carriageReturn()),this._parser.setExecuteHandler(n.C0.BS,()=>this.backspace()),this._parser.setExecuteHandler(n.C0.HT,()=>this.tab()),this._parser.setExecuteHandler(n.C0.SO,()=>this.shiftOut()),this._parser.setExecuteHandler(n.C0.SI,()=>this.shiftIn()),this._parser.setExecuteHandler(n.C1.IND,()=>this.index()),this._parser.setExecuteHandler(n.C1.NEL,()=>this.nextLine()),this._parser.setExecuteHandler(n.C1.HTS,()=>this.tabSet()),this._parser.registerOscHandler(0,new p.OscHandler(b=>(this.setTitle(b),this.setIconName(b),!0))),this._parser.registerOscHandler(1,new p.OscHandler(b=>this.setIconName(b))),this._parser.registerOscHandler(2,new p.OscHandler(b=>this.setTitle(b))),this._parser.registerOscHandler(4,new p.OscHandler(b=>this.setOrReportIndexedColor(b))),this._parser.registerOscHandler(8,new p.OscHandler(b=>this.setHyperlink(b))),this._parser.registerOscHandler(10,new p.OscHandler(b=>this.setOrReportFgColor(b))),this._parser.registerOscHandler(11,new p.OscHandler(b=>this.setOrReportBgColor(b))),this._parser.registerOscHandler(12,new p.OscHandler(b=>this.setOrReportCursorColor(b))),this._parser.registerOscHandler(104,new p.OscHandler(b=>this.restoreIndexedColor(b))),this._parser.registerOscHandler(110,new p.OscHandler(b=>this.restoreFgColor(b))),this._parser.registerOscHandler(111,new p.OscHandler(b=>this.restoreBgColor(b))),this._parser.registerOscHandler(112,new p.OscHandler(b=>this.restoreCursorColor(b))),this._parser.registerEscHandler({final:"7"},()=>this.saveCursor()),this._parser.registerEscHandler({final:"8"},()=>this.restoreCursor()),this._parser.registerEscHandler({final:"D"},()=>this.index()),this._parser.registerEscHandler({final:"E"},()=>this.nextLine()),this._parser.registerEscHandler({final:"H"},()=>this.tabSet()),this._parser.registerEscHandler({final:"M"},()=>this.reverseIndex()),this._parser.registerEscHandler({final:"="},()=>this.keypadApplicationMode()),this._parser.registerEscHandler({final:">"},()=>this.keypadNumericMode()),this._parser.registerEscHandler({final:"c"},()=>this.fullReset()),this._parser.registerEscHandler({final:"n"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"o"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"|"},()=>this.setgLevel(3)),this._parser.registerEscHandler({final:"}"},()=>this.setgLevel(2)),this._parser.registerEscHandler({final:"~"},()=>this.setgLevel(1)),this._parser.registerEscHandler({intermediates:"%",final:"@"},()=>this.selectDefaultCharset()),this._parser.registerEscHandler({intermediates:"%",final:"G"},()=>this.selectDefaultCharset());for(const b in d.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:b},()=>this.selectCharset("("+b)),this._parser.registerEscHandler({intermediates:")",final:b},()=>this.selectCharset(")"+b)),this._parser.registerEscHandler({intermediates:"*",final:b},()=>this.selectCharset("*"+b)),this._parser.registerEscHandler({intermediates:"+",final:b},()=>this.selectCharset("+"+b)),this._parser.registerEscHandler({intermediates:"-",final:b},()=>this.selectCharset("-"+b)),this._parser.registerEscHandler({intermediates:".",final:b},()=>this.selectCharset("."+b)),this._parser.registerEscHandler({intermediates:"/",final:b},()=>this.selectCharset("/"+b));this._parser.registerEscHandler({intermediates:"#",final:"8"},()=>this.screenAlignmentPattern()),this._parser.setErrorHandler(b=>(this._logService.error("Parsing error: ",b),b)),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new g.DcsHandler((b,I)=>this.requestStatusString(b,I)))}_preserveStack(S,R,D,O){this._parseStack.paused=!0,this._parseStack.cursorStartX=S,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=D,this._parseStack.position=O}_logSlowResolvingAsync(S){this._logService.logLevel<=u.LogLevelEnum.WARN&&Promise.race([S,new Promise((R,D)=>setTimeout(()=>D("#SLOW_TIMEOUT"),5e3))]).catch(R=>{if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")})}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(S,R){let D,O=this._activeBuffer.x,j=this._activeBuffer.y,$=0;const X=this._parseStack.paused;if(X){if(D=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(D),D;O=this._parseStack.cursorStartX,j=this._parseStack.cursorStartY,this._parseStack.paused=!1,S.length>C&&($=this._parseStack.position+C)}if(this._logService.logLevel<=u.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof S=="string"?` "${S}"`:` "${Array.prototype.map.call(S,K=>String.fromCharCode(K)).join("")}"`),typeof S=="string"?S.split("").map(K=>K.charCodeAt(0)):S),this._parseBuffer.length<S.length&&this._parseBuffer.length<C&&(this._parseBuffer=new Uint32Array(Math.min(S.length,C))),X||this._dirtyRowTracker.clearRange(),S.length>C)for(let K=$;K<S.length;K+=C){const Z=K+C<S.length?K+C:S.length,b=typeof S=="string"?this._stringDecoder.decode(S.substring(K,Z),this._parseBuffer):this._utf8Decoder.decode(S.subarray(K,Z),this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,b))return this._preserveStack(O,j,b,K),this._logSlowResolvingAsync(D),D}else if(!X){const K=typeof S=="string"?this._stringDecoder.decode(S,this._parseBuffer):this._utf8Decoder.decode(S,this._parseBuffer);if(D=this._parser.parse(this._parseBuffer,K))return this._preserveStack(O,j,K,0),this._logSlowResolvingAsync(D),D}this._activeBuffer.x===O&&this._activeBuffer.y===j||this._onCursorMove.fire(),this._onRequestRefreshRows.fire(this._dirtyRowTracker.start,this._dirtyRowTracker.end)}print(S,R,D){let O,j;const $=this._charsetService.charset,X=this._optionsService.rawOptions.screenReaderMode,K=this._bufferService.cols,Z=this._coreService.decPrivateModes.wraparound,b=this._coreService.modes.insertMode,I=this._curAttrData;let N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&D-R>0&&N.getWidth(this._activeBuffer.x-1)===2&&N.setCellFromCodePoint(this._activeBuffer.x-1,0,1,I.fg,I.bg,I.extended);for(let F=R;F<D;++F){if(O=S[F],j=this._unicodeService.wcwidth(O),O<127&&$){const V=$[String.fromCharCode(O)];V&&(O=V.charCodeAt(0))}if(X&&this._onA11yChar.fire((0,f.stringFromCodePoint)(O)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),j||!this._activeBuffer.x){if(this._activeBuffer.x+j-1>=K){if(Z){for(;this._activeBuffer.x<K;)N.setCellFromCodePoint(this._activeBuffer.x++,0,1,I.fg,I.bg,I.extended);this._activeBuffer.x=0,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),N=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y)}else if(this._activeBuffer.x=K-1,j===2)continue}if(b&&(N.insertCells(this._activeBuffer.x,j,this._activeBuffer.getNullCell(I),I),N.getWidth(K-1)===2&&N.setCellFromCodePoint(K-1,t.NULL_CELL_CODE,t.NULL_CELL_WIDTH,I.fg,I.bg,I.extended)),N.setCellFromCodePoint(this._activeBuffer.x++,O,j,I.fg,I.bg,I.extended),j>0)for(;--j;)N.setCellFromCodePoint(this._activeBuffer.x++,0,0,I.fg,I.bg,I.extended)}else N.getWidth(this._activeBuffer.x-1)?N.addCodepointToCell(this._activeBuffer.x-1,O):N.addCodepointToCell(this._activeBuffer.x-2,O)}D-R>0&&(N.loadCell(this._activeBuffer.x-1,this._workCell),this._workCell.getWidth()===2||this._workCell.getCode()>65535?this._parser.precedingCodepoint=0:this._workCell.isCombined()?this._parser.precedingCodepoint=this._workCell.getChars().charCodeAt(0):this._parser.precedingCodepoint=this._workCell.content),this._activeBuffer.x<K&&D-R>0&&N.getWidth(this._activeBuffer.x)===0&&!N.hasContent(this._activeBuffer.x)&&N.setCellFromCodePoint(this._activeBuffer.x,0,1,I.fg,I.bg,I.extended),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(S,R){return S.final!=="t"||S.prefix||S.intermediates?this._parser.registerCsiHandler(S,R):this._parser.registerCsiHandler(S,D=>!k(D.params[0],this._optionsService.rawOptions.windowOptions)||R(D))}registerDcsHandler(S,R){return this._parser.registerDcsHandler(S,new g.DcsHandler(R))}registerEscHandler(S,R){return this._parser.registerEscHandler(S,R)}registerOscHandler(S,R){return this._parser.registerOscHandler(S,new p.OscHandler(R))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var S;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&(!((S=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))===null||S===void 0)&&S.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);R.hasWidth(this._activeBuffer.x)&&!R.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;const S=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-S),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(S=this._bufferService.cols-1){this._activeBuffer.x=Math.min(S,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(S,R){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=S,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=S,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(S,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+S,this._activeBuffer.y+R)}cursorUp(S){const R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,S.params[0]||1)):this._moveCursor(0,-(S.params[0]||1)),!0}cursorDown(S){const R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,S.params[0]||1)):this._moveCursor(0,S.params[0]||1),!0}cursorForward(S){return this._moveCursor(S.params[0]||1,0),!0}cursorBackward(S){return this._moveCursor(-(S.params[0]||1),0),!0}cursorNextLine(S){return this.cursorDown(S),this._activeBuffer.x=0,!0}cursorPrecedingLine(S){return this.cursorUp(S),this._activeBuffer.x=0,!0}cursorCharAbsolute(S){return this._setCursor((S.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(S){return this._setCursor(S.length>=2?(S.params[1]||1)-1:0,(S.params[0]||1)-1),!0}charPosAbsolute(S){return this._setCursor((S.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(S){return this._moveCursor(S.params[0]||1,0),!0}linePosAbsolute(S){return this._setCursor(this._activeBuffer.x,(S.params[0]||1)-1),!0}vPositionRelative(S){return this._moveCursor(0,S.params[0]||1),!0}hVPosition(S){return this.cursorPosition(S),!0}tabClear(S){const R=S.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(S){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=S.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(S){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=S.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(S){const R=S.params[0];return R===1&&(this._curAttrData.bg|=536870912),R!==2&&R!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(S,R,D,O=!1,j=!1){const $=this._activeBuffer.lines.get(this._activeBuffer.ybase+S);$.replaceCells(R,D,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData(),j),O&&($.isWrapped=!1)}_resetBufferLine(S,R=!1){const D=this._activeBuffer.lines.get(this._activeBuffer.ybase+S);D&&(D.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),R),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+S),D.isWrapped=!1)}eraseInDisplay(S,R=!1){let D;switch(this._restrictCursor(this._bufferService.cols),S.params[0]){case 0:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);D<this._bufferService.rows;D++)this._resetBufferLine(D,R);this._dirtyRowTracker.markDirty(D);break;case 1:for(D=this._activeBuffer.y,this._dirtyRowTracker.markDirty(D),this._eraseInBufferLine(D,0,this._activeBuffer.x+1,!0,R),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(D+1).isWrapped=!1);D--;)this._resetBufferLine(D,R);this._dirtyRowTracker.markDirty(0);break;case 2:for(D=this._bufferService.rows,this._dirtyRowTracker.markDirty(D-1);D--;)this._resetBufferLine(D,R);this._dirtyRowTracker.markDirty(0);break;case 3:const O=this._activeBuffer.lines.length-this._bufferService.rows;O>0&&(this._activeBuffer.lines.trimStart(O),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-O,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-O,0),this._onScroll.fire(0))}return!0}eraseInLine(S,R=!1){switch(this._restrictCursor(this._bufferService.cols),S.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,R);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,R)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(S){this._restrictCursor();let R=S.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const D=this._activeBuffer.ybase+this._activeBuffer.y,O=this._bufferService.rows-1-this._activeBuffer.scrollBottom,j=this._bufferService.rows-1+this._activeBuffer.ybase-O+1;for(;R--;)this._activeBuffer.lines.splice(j-1,1),this._activeBuffer.lines.splice(D,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(S){this._restrictCursor();let R=S.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const D=this._activeBuffer.ybase+this._activeBuffer.y;let O;for(O=this._bufferService.rows-1-this._activeBuffer.scrollBottom,O=this._bufferService.rows-1+this._activeBuffer.ybase-O;R--;)this._activeBuffer.lines.splice(D,1),this._activeBuffer.lines.splice(O,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(S){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,S.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(S){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,S.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(S){let R=S.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(S){let R=S.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(S){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=S.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);O.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(S){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=S.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);O.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(S){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=S.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);O.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(S){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;const R=S.params[0]||1;for(let D=this._activeBuffer.scrollTop;D<=this._activeBuffer.scrollBottom;++D){const O=this._activeBuffer.lines.get(this._activeBuffer.ybase+D);O.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),O.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(S){this._restrictCursor();const R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(S.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData()),this._eraseAttrData()),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(S){if(!this._parser.precedingCodepoint)return!0;const R=S.params[0]||1,D=new Uint32Array(R);for(let O=0;O<R;++O)D[O]=this._parser.precedingCodepoint;return this.print(D,0,D.length),!0}sendDeviceAttributesPrimary(S){return S.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(S){return S.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(S.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(S){return(this._optionsService.rawOptions.termName+"").indexOf(S)===0}setMode(S){for(let R=0;R<S.length;R++)switch(S.params[R]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(S){for(let R=0;R<S.length;R++)switch(S.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,d.DEFAULT_CHARSET),this._charsetService.setgCharset(1,d.DEFAULT_CHARSET),this._charsetService.setgCharset(2,d.DEFAULT_CHARSET),this._charsetService.setgCharset(3,d.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(S){for(let R=0;R<S.length;R++)switch(S.params[R]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(S){for(let R=0;R<S.length;R++)switch(S.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),S.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(S,R){const D=this._coreService.decPrivateModes,{activeProtocol:O,activeEncoding:j}=this._coreMouseService,$=this._coreService,{buffers:X,cols:K}=this._bufferService,{active:Z,alt:b}=X,I=this._optionsService.rawOptions,N=Y=>Y?1:2,F=S.params[0];return V=F,z=R?F===2?4:F===4?N($.modes.insertMode):F===12?3:F===20?N(I.convertEol):0:F===1?N(D.applicationCursorKeys):F===3?I.windowOptions.setWinLines?K===80?2:K===132?1:0:0:F===6?N(D.origin):F===7?N(D.wraparound):F===8?3:F===9?N(O==="X10"):F===12?N(I.cursorBlink):F===25?N(!$.isCursorHidden):F===45?N(D.reverseWraparound):F===66?N(D.applicationKeypad):F===67?4:F===1e3?N(O==="VT200"):F===1002?N(O==="DRAG"):F===1003?N(O==="ANY"):F===1004?N(D.sendFocus):F===1005?4:F===1006?N(j==="SGR"):F===1015?4:F===1016?N(j==="SGR_PIXELS"):F===1048?1:F===47||F===1047||F===1049?N(Z===b):F===2004?N(D.bracketedPasteMode):0,$.triggerDataEvent(`${n.C0.ESC}[${R?"":"?"}${V};${z}$y`),!0;var V,z}_updateAttrColor(S,R,D,O,j){return R===2?(S|=50331648,S&=-16777216,S|=h.AttributeData.fromColorRGB([D,O,j])):R===5&&(S&=-50331904,S|=33554432|255&D),S}_extractColor(S,R,D){const O=[0,0,-1,0,0,0];let j=0,$=0;do{if(O[$+j]=S.params[R+$],S.hasSubParams(R+$)){const X=S.getSubParams(R+$);let K=0;do O[1]===5&&(j=1),O[$+K+1+j]=X[K];while(++K<X.length&&K+$+1+j<O.length);break}if(O[1]===5&&$+j>=2||O[1]===2&&$+j>=5)break;O[1]&&(j=1)}while(++$+R<S.length&&$+j<O.length);for(let X=2;X<O.length;++X)O[X]===-1&&(O[X]=0);switch(O[0]){case 38:D.fg=this._updateAttrColor(D.fg,O[1],O[3],O[4],O[5]);break;case 48:D.bg=this._updateAttrColor(D.bg,O[1],O[3],O[4],O[5]);break;case 58:D.extended=D.extended.clone(),D.extended.underlineColor=this._updateAttrColor(D.extended.underlineColor,O[1],O[3],O[4],O[5])}return $}_processUnderline(S,R){R.extended=R.extended.clone(),(!~S||S>5)&&(S=1),R.extended.underlineStyle=S,R.fg|=268435456,S===0&&(R.fg&=-268435457),R.updateExtended()}_processSGR0(S){S.fg=e.DEFAULT_ATTR_DATA.fg,S.bg=e.DEFAULT_ATTR_DATA.bg,S.extended=S.extended.clone(),S.extended.underlineStyle=0,S.extended.underlineColor&=-67108864,S.updateExtended()}charAttributes(S){if(S.length===1&&S.params[0]===0)return this._processSGR0(this._curAttrData),!0;const R=S.length;let D;const O=this._curAttrData;for(let j=0;j<R;j++)D=S.params[j],D>=30&&D<=37?(O.fg&=-50331904,O.fg|=16777216|D-30):D>=40&&D<=47?(O.bg&=-50331904,O.bg|=16777216|D-40):D>=90&&D<=97?(O.fg&=-50331904,O.fg|=16777224|D-90):D>=100&&D<=107?(O.bg&=-50331904,O.bg|=16777224|D-100):D===0?this._processSGR0(O):D===1?O.fg|=134217728:D===3?O.bg|=67108864:D===4?(O.fg|=268435456,this._processUnderline(S.hasSubParams(j)?S.getSubParams(j)[0]:1,O)):D===5?O.fg|=536870912:D===7?O.fg|=67108864:D===8?O.fg|=1073741824:D===9?O.fg|=2147483648:D===2?O.bg|=134217728:D===21?this._processUnderline(2,O):D===22?(O.fg&=-134217729,O.bg&=-134217729):D===23?O.bg&=-67108865:D===24?(O.fg&=-268435457,this._processUnderline(0,O)):D===25?O.fg&=-536870913:D===27?O.fg&=-67108865:D===28?O.fg&=-1073741825:D===29?O.fg&=2147483647:D===39?(O.fg&=-67108864,O.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):D===49?(O.bg&=-67108864,O.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):D===38||D===48||D===58?j+=this._extractColor(S,j,O):D===53?O.bg|=1073741824:D===55?O.bg&=-1073741825:D===59?(O.extended=O.extended.clone(),O.extended.underlineColor=-1,O.updateExtended()):D===100?(O.fg&=-67108864,O.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,O.bg&=-67108864,O.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",D);return!0}deviceStatus(S){switch(S.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:const R=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${R};${D}R`)}return!0}deviceStatusPrivate(S){if(S.params[0]===6){const R=this._activeBuffer.y+1,D=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${R};${D}R`)}return!0}softReset(S){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(S){const R=S.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}const D=R%2==1;return this._optionsService.options.cursorBlink=D,!0}setScrollRegion(S){const R=S.params[0]||1;let D;return(S.length<2||(D=S.params[1])>this._bufferService.rows||D===0)&&(D=this._bufferService.rows),D>R&&(this._activeBuffer.scrollTop=R-1,this._activeBuffer.scrollBottom=D-1,this._setCursor(0,0)),!0}windowOptions(S){if(!k(S.params[0],this._optionsService.rawOptions.windowOptions))return!0;const R=S.length>1?S.params[1]:0;switch(S.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(E.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(E.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(S){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(S){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(S){return this._windowTitle=S,this._onTitleChange.fire(S),!0}setIconName(S){return this._iconName=S,!0}setOrReportIndexedColor(S){const R=[],D=S.split(";");for(;D.length>1;){const O=D.shift(),j=D.shift();if(/^\d+$/.exec(O)){const $=parseInt(O);if(W($))if(j==="?")R.push({type:0,index:$});else{const X=(0,l.parseColor)(j);X&&R.push({type:1,index:$,color:X})}}}return R.length&&this._onColor.fire(R),!0}setHyperlink(S){const R=S.split(";");return!(R.length<2)&&(R[1]?this._createHyperlink(R[0],R[1]):!R[0]&&this._finishHyperlink())}_createHyperlink(S,R){this._getCurrentLinkId()&&this._finishHyperlink();const D=S.split(":");let O;const j=D.findIndex($=>$.startsWith("id="));return j!==-1&&(O=D[j].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:O,uri:R}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(S,R){const D=S.split(";");for(let O=0;O<D.length&&!(R>=this._specialColors.length);++O,++R)if(D[O]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{const j=(0,l.parseColor)(D[O]);j&&this._onColor.fire([{type:1,index:this._specialColors[R],color:j}])}return!0}setOrReportFgColor(S){return this._setOrReportSpecialColor(S,0)}setOrReportBgColor(S){return this._setOrReportSpecialColor(S,1)}setOrReportCursorColor(S){return this._setOrReportSpecialColor(S,2)}restoreIndexedColor(S){if(!S)return this._onColor.fire([{type:2}]),!0;const R=[],D=S.split(";");for(let O=0;O<D.length;++O)if(/^\d+$/.exec(D[O])){const j=parseInt(D[O]);W(j)&&R.push({type:2,index:j})}return R.length&&this._onColor.fire(R),!0}restoreFgColor(S){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(S){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(S){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,d.DEFAULT_CHARSET),!0}selectCharset(S){return S.length!==2?(this.selectDefaultCharset(),!0):(S[0]==="/"||this._charsetService.setgCharset(v[S[0]],d.CHARSETS[S[1]]||d.DEFAULT_CHARSET),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){const S=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,S,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(S){return this._charsetService.setgLevel(S),!0}screenAlignmentPattern(){const S=new r.CellData;S.content=4194373,S.fg=this._curAttrData.fg,S.bg=this._curAttrData.bg,this._setCursor(0,0);for(let R=0;R<this._bufferService.rows;++R){const D=this._activeBuffer.ybase+this._activeBuffer.y+R,O=this._activeBuffer.lines.get(D);O&&(O.fill(S),O.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(S,R){const D=this._bufferService.buffer,O=this._optionsService.rawOptions;return(j=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${j}${n.C0.ESC}\\`),!0))(S==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:S==='"p'?'P1$r61;1"p':S==="r"?`P1$r${D.scrollTop+1};${D.scrollBottom+1}r`:S==="m"?"P1$r0m":S===" q"?`P1$r${{block:2,underline:4,bar:6}[O.cursorStyle]-(O.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(S,R){this._dirtyRowTracker.markRangeDirty(S,R)}}i.InputHandler=P;let H=class{constructor(U){this._bufferService=U,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(U){U<this.start?this.start=U:U>this.end&&(this.end=U)}markRangeDirty(U,S){U>S&&(w=U,U=S,S=w),U<this.start&&(this.start=U),S>this.end&&(this.end=S)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function W(U){return 0<=U&&U<256}H=a([c(0,u.IBufferService)],H)},844:(y,i)=>{function o(a){for(const c of a)c.dispose();a.length=0}Object.defineProperty(i,"__esModule",{value:!0}),i.getDisposeArrayDisposable=i.disposeArray=i.toDisposable=i.MutableDisposable=i.Disposable=void 0,i.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const a of this._disposables)a.dispose();this._disposables.length=0}register(a){return this._disposables.push(a),a}unregister(a){const c=this._disposables.indexOf(a);c!==-1&&this._disposables.splice(c,1)}},i.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(a){var c;this._isDisposed||a===this._value||((c=this._value)===null||c===void 0||c.dispose(),this._value=a)}clear(){this.value=void 0}dispose(){var a;this._isDisposed=!0,(a=this._value)===null||a===void 0||a.dispose(),this._value=void 0}},i.toDisposable=function(a){return{dispose:a}},i.disposeArray=o,i.getDisposeArrayDisposable=function(a){return{dispose:()=>o(a)}}},1505:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.FourKeyMap=i.TwoKeyMap=void 0;class o{constructor(){this._data={}}set(c,n,d){this._data[c]||(this._data[c]={}),this._data[c][n]=d}get(c,n){return this._data[c]?this._data[c][n]:void 0}clear(){this._data={}}}i.TwoKeyMap=o,i.FourKeyMap=class{constructor(){this._data=new o}set(a,c,n,d,_){this._data.get(a,c)||this._data.set(a,c,new o),this._data.get(a,c).set(n,d,_)}get(a,c,n,d){var _;return(_=this._data.get(a,c))===null||_===void 0?void 0:_.get(n,d)}clear(){this._data.clear()}}},6114:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.isChromeOS=i.isLinux=i.isWindows=i.isIphone=i.isIpad=i.isMac=i.getSafariVersion=i.isSafari=i.isLegacyEdge=i.isFirefox=i.isNode=void 0,i.isNode=typeof navigator>"u";const o=i.isNode?"node":navigator.userAgent,a=i.isNode?"node":navigator.platform;i.isFirefox=o.includes("Firefox"),i.isLegacyEdge=o.includes("Edge"),i.isSafari=/^((?!chrome|android).)*safari/i.test(o),i.getSafariVersion=function(){if(!i.isSafari)return 0;const c=o.match(/Version\/(\d+)/);return c===null||c.length<2?0:parseInt(c[1])},i.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(a),i.isIpad=a==="iPad",i.isIphone=a==="iPhone",i.isWindows=["Windows","Win16","Win32","WinCE"].includes(a),i.isLinux=a.indexOf("Linux")>=0,i.isChromeOS=/\bCrOS\b/.test(o)},6106:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.SortedList=void 0;let o=0;i.SortedList=class{constructor(a){this._getKey=a,this._array=[]}clear(){this._array.length=0}insert(a){this._array.length!==0?(o=this._search(this._getKey(a)),this._array.splice(o,0,a)):this._array.push(a)}delete(a){if(this._array.length===0)return!1;const c=this._getKey(a);if(c===void 0||(o=this._search(c),o===-1)||this._getKey(this._array[o])!==c)return!1;do if(this._array[o]===a)return this._array.splice(o,1),!0;while(++o<this._array.length&&this._getKey(this._array[o])===c);return!1}*getKeyIterator(a){if(this._array.length!==0&&(o=this._search(a),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===a))do yield this._array[o];while(++o<this._array.length&&this._getKey(this._array[o])===a)}forEachByKey(a,c){if(this._array.length!==0&&(o=this._search(a),!(o<0||o>=this._array.length)&&this._getKey(this._array[o])===a))do c(this._array[o]);while(++o<this._array.length&&this._getKey(this._array[o])===a)}values(){return[...this._array].values()}_search(a){let c=0,n=this._array.length-1;for(;n>=c;){let d=c+n>>1;const _=this._getKey(this._array[d]);if(_>a)n=d-1;else{if(!(_<a)){for(;d>0&&this._getKey(this._array[d-1])===a;)d--;return d}c=d+1}}return c}}},7226:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DebouncedIdleTask=i.IdleTaskQueue=i.PriorityTaskQueue=void 0;const a=o(6114);class c{constructor(){this._tasks=[],this._i=0}enqueue(_){this._tasks.push(_),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._cancelCallback(this._idleCallback),this._idleCallback=void 0),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(_){this._idleCallback=void 0;let m=0,f=0,e=_.timeRemaining(),s=0;for(;this._i<this._tasks.length;){if(m=Date.now(),this._tasks[this._i]()||this._i++,m=Math.max(1,Date.now()-m),f=Math.max(m,f),s=_.timeRemaining(),1.5*f>s)return e-m<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-m))}ms`),void this._start();e=s}this.clear()}}class n extends c{_requestCallback(_){return setTimeout(()=>_(this._createDeadline(16)))}_cancelCallback(_){clearTimeout(_)}_createDeadline(_){const m=Date.now()+_;return{timeRemaining:()=>Math.max(0,m-Date.now())}}}i.PriorityTaskQueue=n,i.IdleTaskQueue=!a.isNode&&"requestIdleCallback"in window?class extends c{_requestCallback(d){return requestIdleCallback(d)}_cancelCallback(d){cancelIdleCallback(d)}}:n,i.DebouncedIdleTask=class{constructor(){this._queue=new i.IdleTaskQueue}set(d){this._queue.clear(),this._queue.enqueue(d)}flush(){this._queue.flush()}}},9282:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.updateWindowsModeWrappedState=void 0;const a=o(643);i.updateWindowsModeWrappedState=function(c){const n=c.buffer.lines.get(c.buffer.ybase+c.buffer.y-1),d=n==null?void 0:n.get(c.cols-1),_=c.buffer.lines.get(c.buffer.ybase+c.buffer.y);_&&d&&(_.isWrapped=d[a.CHAR_DATA_CODE_INDEX]!==a.NULL_CELL_CODE&&d[a.CHAR_DATA_CODE_INDEX]!==a.WHITESPACE_CELL_CODE)}},3734:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ExtendedAttrs=i.AttributeData=void 0;class o{constructor(){this.fg=0,this.bg=0,this.extended=new a}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){const n=new o;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}}i.AttributeData=o;class a{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}constructor(n=0,d=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=d}clone(){return new a(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}i.ExtendedAttrs=a},9092:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Buffer=i.MAX_BUFFER_SIZE=void 0;const a=o(6349),c=o(7226),n=o(3734),d=o(8437),_=o(4634),m=o(511),f=o(643),e=o(4863),s=o(7116);i.MAX_BUFFER_SIZE=4294967295,i.Buffer=class{constructor(t,r,h){this._hasScrollback=t,this._optionsService=r,this._bufferService=h,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=d.DEFAULT_ATTR_DATA.clone(),this.savedCharset=s.DEFAULT_CHARSET,this.markers=[],this._nullCell=m.CellData.fromCharData([0,f.NULL_CELL_CHAR,f.NULL_CELL_WIDTH,f.NULL_CELL_CODE]),this._whitespaceCell=m.CellData.fromCharData([0,f.WHITESPACE_CELL_CHAR,f.WHITESPACE_CELL_WIDTH,f.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new c.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new a.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(t){return t?(this._nullCell.fg=t.fg,this._nullCell.bg=t.bg,this._nullCell.extended=t.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(t){return t?(this._whitespaceCell.fg=t.fg,this._whitespaceCell.bg=t.bg,this._whitespaceCell.extended=t.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(t,r){return new d.BufferLine(this._bufferService.cols,this.getNullCell(t),r)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){const t=this.ybase+this.y-this.ydisp;return t>=0&&t<this._rows}_getCorrectBufferLength(t){if(!this._hasScrollback)return t;const r=t+this._optionsService.rawOptions.scrollback;return r>i.MAX_BUFFER_SIZE?i.MAX_BUFFER_SIZE:r}fillViewportRows(t){if(this.lines.length===0){t===void 0&&(t=d.DEFAULT_ATTR_DATA);let r=this._rows;for(;r--;)this.lines.push(this.getBlankLine(t))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new a.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(t,r){const h=this.getNullCell(d.DEFAULT_ATTR_DATA);let u=0;const p=this._getCorrectBufferLength(r);if(p>this.lines.maxLength&&(this.lines.maxLength=p),this.lines.length>0){if(this._cols<t)for(let l=0;l<this.lines.length;l++)u+=+this.lines.get(l).resize(t,h);let g=0;if(this._rows<r)for(let l=this._rows;l<r;l++)this.lines.length<r+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new d.BufferLine(t,h)):this.ybase>0&&this.lines.length<=this.ybase+this.y+g+1?(this.ybase--,g++,this.ydisp>0&&this.ydisp--):this.lines.push(new d.BufferLine(t,h)));else for(let l=this._rows;l>r;l--)this.lines.length>r+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(p<this.lines.maxLength){const l=this.lines.length-p;l>0&&(this.lines.trimStart(l),this.ybase=Math.max(this.ybase-l,0),this.ydisp=Math.max(this.ydisp-l,0),this.savedY=Math.max(this.savedY-l,0)),this.lines.maxLength=p}this.x=Math.min(this.x,t-1),this.y=Math.min(this.y,r-1),g&&(this.y+=g),this.savedX=Math.min(this.savedX,t-1),this.scrollTop=0}if(this.scrollBottom=r-1,this._isReflowEnabled&&(this._reflow(t,r),this._cols>t))for(let g=0;g<this.lines.length;g++)u+=+this.lines.get(g).resize(t,h);this._cols=t,this._rows=r,this._memoryCleanupQueue.clear(),u>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue(()=>this._batchedMemoryCleanup()))}_batchedMemoryCleanup(){let t=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,t=!1);let r=0;for(;this._memoryCleanupPosition<this.lines.length;)if(r+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),r>100)return!0;return t}get _isReflowEnabled(){const t=this._optionsService.rawOptions.windowsPty;return t&&t.buildNumber?this._hasScrollback&&t.backend==="conpty"&&t.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(t,r){this._cols!==t&&(t>this._cols?this._reflowLarger(t,r):this._reflowSmaller(t,r))}_reflowLarger(t,r){const h=(0,_.reflowLargerGetLinesToRemove)(this.lines,this._cols,t,this.ybase+this.y,this.getNullCell(d.DEFAULT_ATTR_DATA));if(h.length>0){const u=(0,_.reflowLargerCreateNewLayout)(this.lines,h);(0,_.reflowLargerApplyNewLayout)(this.lines,u.layout),this._reflowLargerAdjustViewport(t,r,u.countRemoved)}}_reflowLargerAdjustViewport(t,r,h){const u=this.getNullCell(d.DEFAULT_ATTR_DATA);let p=h;for(;p-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<r&&this.lines.push(new d.BufferLine(t,u))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-h,0)}_reflowSmaller(t,r){const h=this.getNullCell(d.DEFAULT_ATTR_DATA),u=[];let p=0;for(let g=this.lines.length-1;g>=0;g--){let l=this.lines.get(g);if(!l||!l.isWrapped&&l.getTrimmedLength()<=t)continue;const v=[l];for(;l.isWrapped&&g>0;)l=this.lines.get(--g),v.unshift(l);const C=this.ybase+this.y;if(C>=g&&C<g+v.length)continue;const k=v[v.length-1].getTrimmedLength(),E=(0,_.reflowSmallerGetNewLineLengths)(v,this._cols,t),w=E.length-v.length;let P;P=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+w):Math.max(0,this.lines.length-this.lines.maxLength+w);const H=[];for(let O=0;O<w;O++){const j=this.getBlankLine(d.DEFAULT_ATTR_DATA,!0);H.push(j)}H.length>0&&(u.push({start:g+v.length+p,newLines:H}),p+=H.length),v.push(...H);let W=E.length-1,U=E[W];U===0&&(W--,U=E[W]);let S=v.length-w-1,R=k;for(;S>=0;){const O=Math.min(R,U);if(v[W]===void 0)break;if(v[W].copyCellsFrom(v[S],R-O,U-O,O,!0),U-=O,U===0&&(W--,U=E[W]),R-=O,R===0){S--;const j=Math.max(S,0);R=(0,_.getWrappedLineTrimmedLength)(v,j,this._cols)}}for(let O=0;O<v.length;O++)E[O]<t&&v[O].setCell(E[O],h);let D=w-P;for(;D-- >0;)this.ybase===0?this.y<r-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+p)-r&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+w,this.ybase+r-1)}if(u.length>0){const g=[],l=[];for(let W=0;W<this.lines.length;W++)l.push(this.lines.get(W));const v=this.lines.length;let C=v-1,k=0,E=u[k];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+p);let w=0;for(let W=Math.min(this.lines.maxLength-1,v+p-1);W>=0;W--)if(E&&E.start>C+w){for(let U=E.newLines.length-1;U>=0;U--)this.lines.set(W--,E.newLines[U]);W++,g.push({index:C+1,amount:E.newLines.length}),w+=E.newLines.length,E=u[++k]}else this.lines.set(W,l[C--]);let P=0;for(let W=g.length-1;W>=0;W--)g[W].index+=P,this.lines.onInsertEmitter.fire(g[W]),P+=g[W].amount;const H=Math.max(0,v+p-this.lines.maxLength);H>0&&this.lines.onTrimEmitter.fire(H)}}translateBufferLineToString(t,r,h=0,u){const p=this.lines.get(t);return p?p.translateToString(r,h,u):""}getWrappedRangeForLine(t){let r=t,h=t;for(;r>0&&this.lines.get(r).isWrapped;)r--;for(;h+1<this.lines.length&&this.lines.get(h+1).isWrapped;)h++;return{first:r,last:h}}setupTabStops(t){for(t!=null?this.tabs[t]||(t=this.prevStop(t)):(this.tabs={},t=0);t<this._cols;t+=this._optionsService.rawOptions.tabStopWidth)this.tabs[t]=!0}prevStop(t){for(t==null&&(t=this.x);!this.tabs[--t]&&t>0;);return t>=this._cols?this._cols-1:t<0?0:t}nextStop(t){for(t==null&&(t=this.x);!this.tabs[++t]&&t<this._cols;);return t>=this._cols?this._cols-1:t<0?0:t}clearMarkers(t){this._isClearing=!0;for(let r=0;r<this.markers.length;r++)this.markers[r].line===t&&(this.markers[r].dispose(),this.markers.splice(r--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let t=0;t<this.markers.length;t++)this.markers[t].dispose(),this.markers.splice(t--,1);this._isClearing=!1}addMarker(t){const r=new e.Marker(t);return this.markers.push(r),r.register(this.lines.onTrim(h=>{r.line-=h,r.line<0&&r.dispose()})),r.register(this.lines.onInsert(h=>{r.line>=h.index&&(r.line+=h.amount)})),r.register(this.lines.onDelete(h=>{r.line>=h.index&&r.line<h.index+h.amount&&r.dispose(),r.line>h.index&&(r.line-=h.amount)})),r.register(r.onDispose(()=>this._removeMarker(r))),r}_removeMarker(t){this._isClearing||this.markers.splice(this.markers.indexOf(t),1)}}},8437:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLine=i.DEFAULT_ATTR_DATA=void 0;const a=o(3734),c=o(511),n=o(643),d=o(482);i.DEFAULT_ATTR_DATA=Object.freeze(new a.AttributeData);let _=0;class m{constructor(e,s,t=!1){this.isWrapped=t,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);const r=s||c.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let h=0;h<e;++h)this.setCell(h,r);this.length=e}get(e){const s=this._data[3*e+0],t=2097151&s;return[this._data[3*e+1],2097152&s?this._combined[e]:t?(0,d.stringFromCodePoint)(t):"",s>>22,2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):t]}set(e,s){this._data[3*e+1]=s[n.CHAR_DATA_ATTR_INDEX],s[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=s[1],this._data[3*e+0]=2097152|e|s[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=s[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|s[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){const s=this._data[3*e+0];return 2097152&s?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&s}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){const s=this._data[3*e+0];return 2097152&s?this._combined[e]:2097151&s?(0,d.stringFromCodePoint)(2097151&s):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,s){return _=3*e,s.content=this._data[_+0],s.fg=this._data[_+1],s.bg=this._data[_+2],2097152&s.content&&(s.combinedData=this._combined[e]),268435456&s.bg&&(s.extended=this._extendedAttrs[e]),s}setCell(e,s){2097152&s.content&&(this._combined[e]=s.combinedData),268435456&s.bg&&(this._extendedAttrs[e]=s.extended),this._data[3*e+0]=s.content,this._data[3*e+1]=s.fg,this._data[3*e+2]=s.bg}setCellFromCodePoint(e,s,t,r,h,u){268435456&h&&(this._extendedAttrs[e]=u),this._data[3*e+0]=s|t<<22,this._data[3*e+1]=r,this._data[3*e+2]=h}addCodepointToCell(e,s){let t=this._data[3*e+0];2097152&t?this._combined[e]+=(0,d.stringFromCodePoint)(s):(2097151&t?(this._combined[e]=(0,d.stringFromCodePoint)(2097151&t)+(0,d.stringFromCodePoint)(s),t&=-2097152,t|=2097152):t=s|4194304,this._data[3*e+0]=t)}insertCells(e,s,t,r){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs),s<this.length-e){const h=new c.CellData;for(let u=this.length-e-s-1;u>=0;--u)this.setCell(e+s+u,this.loadCell(e+u,h));for(let u=0;u<s;++u)this.setCell(e+u,t)}else for(let h=e;h<this.length;++h)this.setCell(h,t);this.getWidth(this.length-1)===2&&this.setCellFromCodePoint(this.length-1,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs)}deleteCells(e,s,t,r){if(e%=this.length,s<this.length-e){const h=new c.CellData;for(let u=0;u<this.length-e-s;++u)this.setCell(e+u,this.loadCell(e+s+u,h));for(let u=this.length-s;u<this.length;++u)this.setCell(u,t)}else for(let h=e;h<this.length;++h)this.setCell(h,t);e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodePoint(e,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs)}replaceCells(e,s,t,r,h=!1){if(h)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodePoint(e-1,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&!this.isProtected(s)&&this.setCellFromCodePoint(s,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs);e<s&&e<this.length;)this.isProtected(e)||this.setCell(e,t),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodePoint(e-1,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs),s<this.length&&this.getWidth(s-1)===2&&this.setCellFromCodePoint(s,0,1,(r==null?void 0:r.fg)||0,(r==null?void 0:r.bg)||0,(r==null?void 0:r.extended)||new a.ExtendedAttrs);e<s&&e<this.length;)this.setCell(e++,t)}resize(e,s){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;const t=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*t)this._data=new Uint32Array(this._data.buffer,0,t);else{const r=new Uint32Array(t);r.set(this._data),this._data=r}for(let r=this.length;r<e;++r)this.setCell(r,s)}else{this._data=this._data.subarray(0,t);const r=Object.keys(this._combined);for(let u=0;u<r.length;u++){const p=parseInt(r[u],10);p>=e&&delete this._combined[p]}const h=Object.keys(this._extendedAttrs);for(let u=0;u<h.length;u++){const p=parseInt(h[u],10);p>=e&&delete this._extendedAttrs[p]}}return this.length=e,4*t*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){const e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,s=!1){if(s)for(let t=0;t<this.length;++t)this.isProtected(t)||this.setCell(t,e);else{this._combined={},this._extendedAttrs={};for(let t=0;t<this.length;++t)this.setCell(t,e)}}copyFrom(e){this.length!==e.length?this._data=new Uint32Array(e._data):this._data.set(e._data),this.length=e.length,this._combined={};for(const s in e._combined)this._combined[s]=e._combined[s];this._extendedAttrs={};for(const s in e._extendedAttrs)this._extendedAttrs[s]=e._extendedAttrs[s];this.isWrapped=e.isWrapped}clone(){const e=new m(0);e._data=new Uint32Array(this._data),e.length=this.length;for(const s in this._combined)e._combined[s]=this._combined[s];for(const s in this._extendedAttrs)e._extendedAttrs[s]=this._extendedAttrs[s];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,s,t,r,h){const u=e._data;if(h)for(let g=r-1;g>=0;g--){for(let l=0;l<3;l++)this._data[3*(t+g)+l]=u[3*(s+g)+l];268435456&u[3*(s+g)+2]&&(this._extendedAttrs[t+g]=e._extendedAttrs[s+g])}else for(let g=0;g<r;g++){for(let l=0;l<3;l++)this._data[3*(t+g)+l]=u[3*(s+g)+l];268435456&u[3*(s+g)+2]&&(this._extendedAttrs[t+g]=e._extendedAttrs[s+g])}const p=Object.keys(e._combined);for(let g=0;g<p.length;g++){const l=parseInt(p[g],10);l>=s&&(this._combined[l-s+t]=e._combined[l])}}translateToString(e=!1,s=0,t=this.length){e&&(t=Math.min(t,this.getTrimmedLength()));let r="";for(;s<t;){const h=this._data[3*s+0],u=2097151&h;r+=2097152&h?this._combined[s]:u?(0,d.stringFromCodePoint)(u):n.WHITESPACE_CELL_CHAR,s+=h>>22||1}return r}}i.BufferLine=m},4841:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.getRangeLength=void 0,i.getRangeLength=function(o,a){if(o.start.y>o.end.y)throw new Error(`Buffer range end (${o.end.x}, ${o.end.y}) cannot be before start (${o.start.x}, ${o.start.y})`);return a*(o.end.y-o.start.y)+(o.end.x-o.start.x+1)}},4634:(y,i)=>{function o(a,c,n){if(c===a.length-1)return a[c].getTrimmedLength();const d=!a[c].hasContent(n-1)&&a[c].getWidth(n-1)===1,_=a[c+1].getWidth(0)===2;return d&&_?n-1:n}Object.defineProperty(i,"__esModule",{value:!0}),i.getWrappedLineTrimmedLength=i.reflowSmallerGetNewLineLengths=i.reflowLargerApplyNewLayout=i.reflowLargerCreateNewLayout=i.reflowLargerGetLinesToRemove=void 0,i.reflowLargerGetLinesToRemove=function(a,c,n,d,_){const m=[];for(let f=0;f<a.length-1;f++){let e=f,s=a.get(++e);if(!s.isWrapped)continue;const t=[a.get(f)];for(;e<a.length&&s.isWrapped;)t.push(s),s=a.get(++e);if(d>=f&&d<e){f+=t.length-1;continue}let r=0,h=o(t,r,c),u=1,p=0;for(;u<t.length;){const l=o(t,u,c),v=l-p,C=n-h,k=Math.min(v,C);t[r].copyCellsFrom(t[u],p,h,k,!1),h+=k,h===n&&(r++,h=0),p+=k,p===l&&(u++,p=0),h===0&&r!==0&&t[r-1].getWidth(n-1)===2&&(t[r].copyCellsFrom(t[r-1],n-1,h++,1,!1),t[r-1].setCell(n-1,_))}t[r].replaceCells(h,n,_);let g=0;for(let l=t.length-1;l>0&&(l>r||t[l].getTrimmedLength()===0);l--)g++;g>0&&(m.push(f+t.length-g),m.push(g)),f+=t.length-1}return m},i.reflowLargerCreateNewLayout=function(a,c){const n=[];let d=0,_=c[d],m=0;for(let f=0;f<a.length;f++)if(_===f){const e=c[++d];a.onDeleteEmitter.fire({index:f-m,amount:e}),f+=e-1,m+=e,_=c[++d]}else n.push(f);return{layout:n,countRemoved:m}},i.reflowLargerApplyNewLayout=function(a,c){const n=[];for(let d=0;d<c.length;d++)n.push(a.get(c[d]));for(let d=0;d<n.length;d++)a.set(d,n[d]);a.length=c.length},i.reflowSmallerGetNewLineLengths=function(a,c,n){const d=[],_=a.map((s,t)=>o(a,t,c)).reduce((s,t)=>s+t);let m=0,f=0,e=0;for(;e<_;){if(_-e<n){d.push(_-e);break}m+=n;const s=o(a,f,c);m>s&&(m-=s,f++);const t=a[f].getWidth(m-1)===2;t&&m--;const r=t?n-1:n;d.push(r),e+=r}return d},i.getWrappedLineTrimmedLength=o},5295:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferSet=void 0;const a=o(8460),c=o(844),n=o(9092);class d extends c.Disposable{constructor(m,f){super(),this._optionsService=m,this._bufferService=f,this._onBufferActivate=this.register(new a.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",()=>this.resize(this._bufferService.cols,this._bufferService.rows))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",()=>this.setupTabStops()))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(m){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(m),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(m,f){this._normal.resize(m,f),this._alt.resize(m,f),this.setupTabStops(m)}setupTabStops(m){this._normal.setupTabStops(m),this._alt.setupTabStops(m)}}i.BufferSet=d},511:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CellData=void 0;const a=o(482),c=o(643),n=o(3734);class d extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(m){const f=new d;return f.setFromCharData(m),f}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,a.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(m){this.fg=m[c.CHAR_DATA_ATTR_INDEX],this.bg=0;let f=!1;if(m[c.CHAR_DATA_CHAR_INDEX].length>2)f=!0;else if(m[c.CHAR_DATA_CHAR_INDEX].length===2){const e=m[c.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){const s=m[c.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(e-55296)+s-56320+65536|m[c.CHAR_DATA_WIDTH_INDEX]<<22:f=!0}else f=!0}else this.content=m[c.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|m[c.CHAR_DATA_WIDTH_INDEX]<<22;f&&(this.combinedData=m[c.CHAR_DATA_CHAR_INDEX],this.content=2097152|m[c.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}i.CellData=d},643:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WHITESPACE_CELL_CODE=i.WHITESPACE_CELL_WIDTH=i.WHITESPACE_CELL_CHAR=i.NULL_CELL_CODE=i.NULL_CELL_WIDTH=i.NULL_CELL_CHAR=i.CHAR_DATA_CODE_INDEX=i.CHAR_DATA_WIDTH_INDEX=i.CHAR_DATA_CHAR_INDEX=i.CHAR_DATA_ATTR_INDEX=i.DEFAULT_EXT=i.DEFAULT_ATTR=i.DEFAULT_COLOR=void 0,i.DEFAULT_COLOR=0,i.DEFAULT_ATTR=256|i.DEFAULT_COLOR<<9,i.DEFAULT_EXT=0,i.CHAR_DATA_ATTR_INDEX=0,i.CHAR_DATA_CHAR_INDEX=1,i.CHAR_DATA_WIDTH_INDEX=2,i.CHAR_DATA_CODE_INDEX=3,i.NULL_CELL_CHAR="",i.NULL_CELL_WIDTH=1,i.NULL_CELL_CODE=0,i.WHITESPACE_CELL_CHAR=" ",i.WHITESPACE_CELL_WIDTH=1,i.WHITESPACE_CELL_CODE=32},4863:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Marker=void 0;const a=o(8460),c=o(844);class n{get id(){return this._id}constructor(_){this.line=_,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new a.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,c.disposeArray)(this._disposables),this._disposables.length=0)}register(_){return this._disposables.push(_),_}}i.Marker=n,n._nextId=1},7116:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_CHARSET=i.CHARSETS=void 0,i.CHARSETS={},i.DEFAULT_CHARSET=i.CHARSETS.B,i.CHARSETS[0]={"`":"◆",a:"▒",b:"␉",c:"␌",d:"␍",e:"␊",f:"°",g:"±",h:"␤",i:"␋",j:"┘",k:"┐",l:"┌",m:"└",n:"┼",o:"⎺",p:"⎻",q:"─",r:"⎼",s:"⎽",t:"├",u:"┤",v:"┴",w:"┬",x:"│",y:"≤",z:"≥","{":"π","|":"≠","}":"£","~":"·"},i.CHARSETS.A={"#":"£"},i.CHARSETS.B=void 0,i.CHARSETS[4]={"#":"£","@":"¾","[":"ij","\\":"½","]":"|","{":"¨","|":"f","}":"¼","~":"´"},i.CHARSETS.C=i.CHARSETS[5]={"[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},i.CHARSETS.R={"#":"£","@":"à","[":"°","\\":"ç","]":"§","{":"é","|":"ù","}":"è","~":"¨"},i.CHARSETS.Q={"@":"à","[":"â","\\":"ç","]":"ê","^":"î","`":"ô","{":"é","|":"ù","}":"è","~":"û"},i.CHARSETS.K={"@":"§","[":"Ä","\\":"Ö","]":"Ü","{":"ä","|":"ö","}":"ü","~":"ß"},i.CHARSETS.Y={"#":"£","@":"§","[":"°","\\":"ç","]":"é","`":"ù","{":"à","|":"ò","}":"è","~":"ì"},i.CHARSETS.E=i.CHARSETS[6]={"@":"Ä","[":"Æ","\\":"Ø","]":"Å","^":"Ü","`":"ä","{":"æ","|":"ø","}":"å","~":"ü"},i.CHARSETS.Z={"#":"£","@":"§","[":"¡","\\":"Ñ","]":"¿","{":"°","|":"ñ","}":"ç"},i.CHARSETS.H=i.CHARSETS[7]={"@":"É","[":"Ä","\\":"Ö","]":"Å","^":"Ü","`":"é","{":"ä","|":"ö","}":"å","~":"ü"},i.CHARSETS["="]={"#":"ù","@":"à","[":"é","\\":"ç","]":"ê","^":"î",_:"è","`":"ô","{":"ä","|":"ö","}":"ü","~":"û"}},2584:(y,i)=>{var o,a,c;Object.defineProperty(i,"__esModule",{value:!0}),i.C1_ESCAPED=i.C1=i.C0=void 0,function(n){n.NUL="\0",n.SOH="",n.STX="",n.ETX="",n.EOT="",n.ENQ="",n.ACK="",n.BEL="\x07",n.BS="\b",n.HT="	",n.LF=`
`,n.VT="\v",n.FF="\f",n.CR="\r",n.SO="",n.SI="",n.DLE="",n.DC1="",n.DC2="",n.DC3="",n.DC4="",n.NAK="",n.SYN="",n.ETB="",n.CAN="",n.EM="",n.SUB="",n.ESC="\x1B",n.FS="",n.GS="",n.RS="",n.US="",n.SP=" ",n.DEL=""}(o||(i.C0=o={})),function(n){n.PAD="",n.HOP="",n.BPH="",n.NBH="",n.IND="",n.NEL="",n.SSA="",n.ESA="",n.HTS="",n.HTJ="",n.VTS="",n.PLD="",n.PLU="",n.RI="",n.SS2="",n.SS3="",n.DCS="",n.PU1="",n.PU2="",n.STS="",n.CCH="",n.MW="",n.SPA="",n.EPA="",n.SOS="",n.SGCI="",n.SCI="",n.CSI="",n.ST="",n.OSC="",n.PM="",n.APC=""}(a||(i.C1=a={})),function(n){n.ST=`${o.ESC}\\`}(c||(i.C1_ESCAPED=c={}))},7399:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.evaluateKeyboardEvent=void 0;const a=o(2584),c={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};i.evaluateKeyboardEvent=function(n,d,_,m){const f={type:0,cancel:!1,key:void 0},e=(n.shiftKey?1:0)|(n.altKey?2:0)|(n.ctrlKey?4:0)|(n.metaKey?8:0);switch(n.keyCode){case 0:n.key==="UIKeyInputUpArrow"?f.key=d?a.C0.ESC+"OA":a.C0.ESC+"[A":n.key==="UIKeyInputLeftArrow"?f.key=d?a.C0.ESC+"OD":a.C0.ESC+"[D":n.key==="UIKeyInputRightArrow"?f.key=d?a.C0.ESC+"OC":a.C0.ESC+"[C":n.key==="UIKeyInputDownArrow"&&(f.key=d?a.C0.ESC+"OB":a.C0.ESC+"[B");break;case 8:if(n.altKey){f.key=a.C0.ESC+a.C0.DEL;break}f.key=a.C0.DEL;break;case 9:if(n.shiftKey){f.key=a.C0.ESC+"[Z";break}f.key=a.C0.HT,f.cancel=!0;break;case 13:f.key=n.altKey?a.C0.ESC+a.C0.CR:a.C0.CR,f.cancel=!0;break;case 27:f.key=a.C0.ESC,n.altKey&&(f.key=a.C0.ESC+a.C0.ESC),f.cancel=!0;break;case 37:if(n.metaKey)break;e?(f.key=a.C0.ESC+"[1;"+(e+1)+"D",f.key===a.C0.ESC+"[1;3D"&&(f.key=a.C0.ESC+(_?"b":"[1;5D"))):f.key=d?a.C0.ESC+"OD":a.C0.ESC+"[D";break;case 39:if(n.metaKey)break;e?(f.key=a.C0.ESC+"[1;"+(e+1)+"C",f.key===a.C0.ESC+"[1;3C"&&(f.key=a.C0.ESC+(_?"f":"[1;5C"))):f.key=d?a.C0.ESC+"OC":a.C0.ESC+"[C";break;case 38:if(n.metaKey)break;e?(f.key=a.C0.ESC+"[1;"+(e+1)+"A",_||f.key!==a.C0.ESC+"[1;3A"||(f.key=a.C0.ESC+"[1;5A")):f.key=d?a.C0.ESC+"OA":a.C0.ESC+"[A";break;case 40:if(n.metaKey)break;e?(f.key=a.C0.ESC+"[1;"+(e+1)+"B",_||f.key!==a.C0.ESC+"[1;3B"||(f.key=a.C0.ESC+"[1;5B")):f.key=d?a.C0.ESC+"OB":a.C0.ESC+"[B";break;case 45:n.shiftKey||n.ctrlKey||(f.key=a.C0.ESC+"[2~");break;case 46:f.key=e?a.C0.ESC+"[3;"+(e+1)+"~":a.C0.ESC+"[3~";break;case 36:f.key=e?a.C0.ESC+"[1;"+(e+1)+"H":d?a.C0.ESC+"OH":a.C0.ESC+"[H";break;case 35:f.key=e?a.C0.ESC+"[1;"+(e+1)+"F":d?a.C0.ESC+"OF":a.C0.ESC+"[F";break;case 33:n.shiftKey?f.type=2:n.ctrlKey?f.key=a.C0.ESC+"[5;"+(e+1)+"~":f.key=a.C0.ESC+"[5~";break;case 34:n.shiftKey?f.type=3:n.ctrlKey?f.key=a.C0.ESC+"[6;"+(e+1)+"~":f.key=a.C0.ESC+"[6~";break;case 112:f.key=e?a.C0.ESC+"[1;"+(e+1)+"P":a.C0.ESC+"OP";break;case 113:f.key=e?a.C0.ESC+"[1;"+(e+1)+"Q":a.C0.ESC+"OQ";break;case 114:f.key=e?a.C0.ESC+"[1;"+(e+1)+"R":a.C0.ESC+"OR";break;case 115:f.key=e?a.C0.ESC+"[1;"+(e+1)+"S":a.C0.ESC+"OS";break;case 116:f.key=e?a.C0.ESC+"[15;"+(e+1)+"~":a.C0.ESC+"[15~";break;case 117:f.key=e?a.C0.ESC+"[17;"+(e+1)+"~":a.C0.ESC+"[17~";break;case 118:f.key=e?a.C0.ESC+"[18;"+(e+1)+"~":a.C0.ESC+"[18~";break;case 119:f.key=e?a.C0.ESC+"[19;"+(e+1)+"~":a.C0.ESC+"[19~";break;case 120:f.key=e?a.C0.ESC+"[20;"+(e+1)+"~":a.C0.ESC+"[20~";break;case 121:f.key=e?a.C0.ESC+"[21;"+(e+1)+"~":a.C0.ESC+"[21~";break;case 122:f.key=e?a.C0.ESC+"[23;"+(e+1)+"~":a.C0.ESC+"[23~";break;case 123:f.key=e?a.C0.ESC+"[24;"+(e+1)+"~":a.C0.ESC+"[24~";break;default:if(!n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)if(_&&!m||!n.altKey||n.metaKey)!_||n.altKey||n.ctrlKey||n.shiftKey||!n.metaKey?n.key&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&n.keyCode>=48&&n.key.length===1?f.key=n.key:n.key&&n.ctrlKey&&(n.key==="_"&&(f.key=a.C0.US),n.key==="@"&&(f.key=a.C0.NUL)):n.keyCode===65&&(f.type=1);else{const s=c[n.keyCode],t=s==null?void 0:s[n.shiftKey?1:0];if(t)f.key=a.C0.ESC+t;else if(n.keyCode>=65&&n.keyCode<=90){const r=n.ctrlKey?n.keyCode-64:n.keyCode+32;let h=String.fromCharCode(r);n.shiftKey&&(h=h.toUpperCase()),f.key=a.C0.ESC+h}else if(n.keyCode===32)f.key=a.C0.ESC+(n.ctrlKey?a.C0.NUL:" ");else if(n.key==="Dead"&&n.code.startsWith("Key")){let r=n.code.slice(3,4);n.shiftKey||(r=r.toLowerCase()),f.key=a.C0.ESC+r,f.cancel=!0}}else n.keyCode>=65&&n.keyCode<=90?f.key=String.fromCharCode(n.keyCode-64):n.keyCode===32?f.key=a.C0.NUL:n.keyCode>=51&&n.keyCode<=55?f.key=String.fromCharCode(n.keyCode-51+27):n.keyCode===56?f.key=a.C0.DEL:n.keyCode===219?f.key=a.C0.ESC:n.keyCode===220?f.key=a.C0.FS:n.keyCode===221&&(f.key=a.C0.GS)}return f}},482:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Utf8ToUtf32=i.StringToUtf32=i.utf32ToString=i.stringFromCodePoint=void 0,i.stringFromCodePoint=function(o){return o>65535?(o-=65536,String.fromCharCode(55296+(o>>10))+String.fromCharCode(o%1024+56320)):String.fromCharCode(o)},i.utf32ToString=function(o,a=0,c=o.length){let n="";for(let d=a;d<c;++d){let _=o[d];_>65535?(_-=65536,n+=String.fromCharCode(55296+(_>>10))+String.fromCharCode(_%1024+56320)):n+=String.fromCharCode(_)}return n},i.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(o,a){const c=o.length;if(!c)return 0;let n=0,d=0;if(this._interim){const _=o.charCodeAt(d++);56320<=_&&_<=57343?a[n++]=1024*(this._interim-55296)+_-56320+65536:(a[n++]=this._interim,a[n++]=_),this._interim=0}for(let _=d;_<c;++_){const m=o.charCodeAt(_);if(55296<=m&&m<=56319){if(++_>=c)return this._interim=m,n;const f=o.charCodeAt(_);56320<=f&&f<=57343?a[n++]=1024*(m-55296)+f-56320+65536:(a[n++]=m,a[n++]=f)}else m!==65279&&(a[n++]=m)}return n}},i.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(o,a){const c=o.length;if(!c)return 0;let n,d,_,m,f=0,e=0,s=0;if(this.interim[0]){let h=!1,u=this.interim[0];u&=(224&u)==192?31:(240&u)==224?15:7;let p,g=0;for(;(p=63&this.interim[++g])&&g<4;)u<<=6,u|=p;const l=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,v=l-g;for(;s<v;){if(s>=c)return 0;if(p=o[s++],(192&p)!=128){s--,h=!0;break}this.interim[g++]=p,u<<=6,u|=63&p}h||(l===2?u<128?s--:a[f++]=u:l===3?u<2048||u>=55296&&u<=57343||u===65279||(a[f++]=u):u<65536||u>1114111||(a[f++]=u)),this.interim.fill(0)}const t=c-4;let r=s;for(;r<c;){for(;!(!(r<t)||128&(n=o[r])||128&(d=o[r+1])||128&(_=o[r+2])||128&(m=o[r+3]));)a[f++]=n,a[f++]=d,a[f++]=_,a[f++]=m,r+=4;if(n=o[r++],n<128)a[f++]=n;else if((224&n)==192){if(r>=c)return this.interim[0]=n,f;if(d=o[r++],(192&d)!=128){r--;continue}if(e=(31&n)<<6|63&d,e<128){r--;continue}a[f++]=e}else if((240&n)==224){if(r>=c)return this.interim[0]=n,f;if(d=o[r++],(192&d)!=128){r--;continue}if(r>=c)return this.interim[0]=n,this.interim[1]=d,f;if(_=o[r++],(192&_)!=128){r--;continue}if(e=(15&n)<<12|(63&d)<<6|63&_,e<2048||e>=55296&&e<=57343||e===65279)continue;a[f++]=e}else if((248&n)==240){if(r>=c)return this.interim[0]=n,f;if(d=o[r++],(192&d)!=128){r--;continue}if(r>=c)return this.interim[0]=n,this.interim[1]=d,f;if(_=o[r++],(192&_)!=128){r--;continue}if(r>=c)return this.interim[0]=n,this.interim[1]=d,this.interim[2]=_,f;if(m=o[r++],(192&m)!=128){r--;continue}if(e=(7&n)<<18|(63&d)<<12|(63&_)<<6|63&m,e<65536||e>1114111)continue;a[f++]=e}}return f}}},225:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeV6=void 0;const o=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],a=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]];let c;i.UnicodeV6=class{constructor(){if(this.version="6",!c){c=new Uint8Array(65536),c.fill(1),c[0]=0,c.fill(0,1,32),c.fill(0,127,160),c.fill(2,4352,4448),c[9001]=2,c[9002]=2,c.fill(2,11904,42192),c[12351]=1,c.fill(2,44032,55204),c.fill(2,63744,64256),c.fill(2,65040,65050),c.fill(2,65072,65136),c.fill(2,65280,65377),c.fill(2,65504,65511);for(let n=0;n<o.length;++n)c.fill(0,o[n][0],o[n][1]+1)}}wcwidth(n){return n<32?0:n<127?1:n<65536?c[n]:function(d,_){let m,f=0,e=_.length-1;if(d<_[0][0]||d>_[e][1])return!1;for(;e>=f;)if(m=f+e>>1,d>_[m][1])f=m+1;else{if(!(d<_[m][0]))return!0;e=m-1}return!1}(n,a)?0:n>=131072&&n<=196605||n>=196608&&n<=262141?2:1}}},5981:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.WriteBuffer=void 0;const a=o(8460),c=o(844);class n extends c.Disposable{constructor(_){super(),this._action=_,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new a.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(_,m){if(m!==void 0&&this._syncCalls>m)return void(this._syncCalls=0);if(this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let f;for(this._isSyncWriting=!0;f=this._writeBuffer.shift();){this._action(f);const e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(_,m){if(this._pendingData>5e7)throw new Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(m),void this._innerWrite();setTimeout(()=>this._innerWrite())}this._pendingData+=_.length,this._writeBuffer.push(_),this._callbacks.push(m)}_innerWrite(_=0,m=!0){const f=_||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){const e=this._writeBuffer[this._bufferOffset],s=this._action(e,m);if(s){const r=h=>Date.now()-f>=12?setTimeout(()=>this._innerWrite(0,h)):this._innerWrite(f,h);return void s.catch(h=>(queueMicrotask(()=>{throw h}),Promise.resolve(!1))).then(r)}const t=this._callbacks[this._bufferOffset];if(t&&t(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-f>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout(()=>this._innerWrite())):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}i.WriteBuffer=n},5941:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.toRgbString=i.parseColor=void 0;const o=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,a=/^[\da-f]+$/;function c(n,d){const _=n.toString(16),m=_.length<2?"0"+_:_;switch(d){case 4:return _[0];case 8:return m;case 12:return(m+m).slice(0,3);default:return m+m}}i.parseColor=function(n){if(!n)return;let d=n.toLowerCase();if(d.indexOf("rgb:")===0){d=d.slice(4);const _=o.exec(d);if(_){const m=_[1]?15:_[4]?255:_[7]?4095:65535;return[Math.round(parseInt(_[1]||_[4]||_[7]||_[10],16)/m*255),Math.round(parseInt(_[2]||_[5]||_[8]||_[11],16)/m*255),Math.round(parseInt(_[3]||_[6]||_[9]||_[12],16)/m*255)]}}else if(d.indexOf("#")===0&&(d=d.slice(1),a.exec(d)&&[3,6,9,12].includes(d.length))){const _=d.length/3,m=[0,0,0];for(let f=0;f<3;++f){const e=parseInt(d.slice(_*f,_*f+_),16);m[f]=_===1?e<<4:_===2?e:_===3?e>>4:e>>8}return m}},i.toRgbString=function(n,d=16){const[_,m,f]=n;return`rgb:${c(_,d)}/${c(m,d)}/${c(f,d)}`}},5770:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.PAYLOAD_LIMIT=void 0,i.PAYLOAD_LIMIT=1e7},6351:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DcsHandler=i.DcsParser=void 0;const a=o(482),c=o(8742),n=o(5770),d=[];i.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=d,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=d}registerHandler(m,f){this._handlers[m]===void 0&&(this._handlers[m]=[]);const e=this._handlers[m];return e.push(f),{dispose:()=>{const s=e.indexOf(f);s!==-1&&e.splice(s,1)}}}clearHandler(m){this._handlers[m]&&delete this._handlers[m]}setHandlerFallback(m){this._handlerFb=m}reset(){if(this._active.length)for(let m=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;m>=0;--m)this._active[m].unhook(!1);this._stack.paused=!1,this._active=d,this._ident=0}hook(m,f){if(this.reset(),this._ident=m,this._active=this._handlers[m]||d,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(f);else this._handlerFb(this._ident,"HOOK",f)}put(m,f,e){if(this._active.length)for(let s=this._active.length-1;s>=0;s--)this._active[s].put(m,f,e);else this._handlerFb(this._ident,"PUT",(0,a.utf32ToString)(m,f,e))}unhook(m,f=!0){if(this._active.length){let e=!1,s=this._active.length-1,t=!1;if(this._stack.paused&&(s=this._stack.loopPosition-1,e=f,t=this._stack.fallThrough,this._stack.paused=!1),!t&&e===!1){for(;s>=0&&(e=this._active[s].unhook(m),e!==!0);s--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!1,e;s--}for(;s>=0;s--)if(e=this._active[s].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=s,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",m);this._active=d,this._ident=0}};const _=new c.Params;_.addParam(0),i.DcsHandler=class{constructor(m){this._handler=m,this._data="",this._params=_,this._hitLimit=!1}hook(m){this._params=m.length>1||m.params[0]?m.clone():_,this._data="",this._hitLimit=!1}put(m,f,e){this._hitLimit||(this._data+=(0,a.utf32ToString)(m,f,e),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(m){let f=!1;if(this._hitLimit)f=!1;else if(m&&(f=this._handler(this._data,this._params),f instanceof Promise))return f.then(e=>(this._params=_,this._data="",this._hitLimit=!1,e));return this._params=_,this._data="",this._hitLimit=!1,f}}},2015:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.EscapeSequenceParser=i.VT500_TRANSITION_TABLE=i.TransitionTable=void 0;const a=o(844),c=o(8742),n=o(6242),d=o(6351);class _{constructor(s){this.table=new Uint8Array(s)}setDefault(s,t){this.table.fill(s<<4|t)}add(s,t,r,h){this.table[t<<8|s]=r<<4|h}addMany(s,t,r,h){for(let u=0;u<s.length;u++)this.table[t<<8|s[u]]=r<<4|h}}i.TransitionTable=_;const m=160;i.VT500_TRANSITION_TABLE=function(){const e=new _(4095),s=Array.apply(null,Array(256)).map((g,l)=>l),t=(g,l)=>s.slice(g,l),r=t(32,127),h=t(0,24);h.push(25),h.push.apply(h,t(28,32));const u=t(0,14);let p;for(p in e.setDefault(1,0),e.addMany(r,0,2,0),u)e.addMany([24,26,153,154],p,3,0),e.addMany(t(128,144),p,3,0),e.addMany(t(144,152),p,3,0),e.add(156,p,0,0),e.add(27,p,11,1),e.add(157,p,4,8),e.addMany([152,158,159],p,0,7),e.add(155,p,11,3),e.add(144,p,11,9);return e.addMany(h,0,3,0),e.addMany(h,1,3,1),e.add(127,1,0,1),e.addMany(h,8,0,8),e.addMany(h,3,3,3),e.add(127,3,0,3),e.addMany(h,4,3,4),e.add(127,4,0,4),e.addMany(h,6,3,6),e.addMany(h,5,3,5),e.add(127,5,0,5),e.addMany(h,2,3,2),e.add(127,2,0,2),e.add(93,1,4,8),e.addMany(r,8,5,8),e.add(127,8,5,8),e.addMany([156,27,24,26,7],8,6,0),e.addMany(t(28,32),8,0,8),e.addMany([88,94,95],1,0,7),e.addMany(r,7,0,7),e.addMany(h,7,0,7),e.add(156,7,0,0),e.add(127,7,0,7),e.add(91,1,11,3),e.addMany(t(64,127),3,7,0),e.addMany(t(48,60),3,8,4),e.addMany([60,61,62,63],3,9,4),e.addMany(t(48,60),4,8,4),e.addMany(t(64,127),4,7,0),e.addMany([60,61,62,63],4,0,6),e.addMany(t(32,64),6,0,6),e.add(127,6,0,6),e.addMany(t(64,127),6,0,0),e.addMany(t(32,48),3,9,5),e.addMany(t(32,48),5,9,5),e.addMany(t(48,64),5,0,6),e.addMany(t(64,127),5,7,0),e.addMany(t(32,48),4,9,5),e.addMany(t(32,48),1,9,2),e.addMany(t(32,48),2,9,2),e.addMany(t(48,127),2,10,0),e.addMany(t(48,80),1,10,0),e.addMany(t(81,88),1,10,0),e.addMany([89,90,92],1,10,0),e.addMany(t(96,127),1,10,0),e.add(80,1,11,9),e.addMany(h,9,0,9),e.add(127,9,0,9),e.addMany(t(28,32),9,0,9),e.addMany(t(32,48),9,9,12),e.addMany(t(48,60),9,8,10),e.addMany([60,61,62,63],9,9,10),e.addMany(h,11,0,11),e.addMany(t(32,128),11,0,11),e.addMany(t(28,32),11,0,11),e.addMany(h,10,0,10),e.add(127,10,0,10),e.addMany(t(28,32),10,0,10),e.addMany(t(48,60),10,8,10),e.addMany([60,61,62,63],10,0,11),e.addMany(t(32,48),10,9,12),e.addMany(h,12,0,12),e.add(127,12,0,12),e.addMany(t(28,32),12,0,12),e.addMany(t(32,48),12,9,12),e.addMany(t(48,64),12,0,11),e.addMany(t(64,127),12,12,13),e.addMany(t(64,127),10,12,13),e.addMany(t(64,127),9,12,13),e.addMany(h,13,13,13),e.addMany(r,13,13,13),e.add(127,13,0,13),e.addMany([27,156,24,26],13,14,0),e.add(m,0,2,0),e.add(m,8,5,8),e.add(m,6,0,6),e.add(m,11,0,11),e.add(m,13,13,13),e}();class f extends a.Disposable{constructor(s=i.VT500_TRANSITION_TABLE){super(),this._transitions=s,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new c.Params,this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._printHandlerFb=(t,r,h)=>{},this._executeHandlerFb=t=>{},this._csiHandlerFb=(t,r)=>{},this._escHandlerFb=t=>{},this._errorHandlerFb=t=>t,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,a.toDisposable)(()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)})),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new d.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},()=>!0)}_identifier(s,t=[64,126]){let r=0;if(s.prefix){if(s.prefix.length>1)throw new Error("only one byte as prefix supported");if(r=s.prefix.charCodeAt(0),r&&60>r||r>63)throw new Error("prefix must be in range 0x3c .. 0x3f")}if(s.intermediates){if(s.intermediates.length>2)throw new Error("only two bytes as intermediates are supported");for(let u=0;u<s.intermediates.length;++u){const p=s.intermediates.charCodeAt(u);if(32>p||p>47)throw new Error("intermediate must be in range 0x20 .. 0x2f");r<<=8,r|=p}}if(s.final.length!==1)throw new Error("final must be a single byte");const h=s.final.charCodeAt(0);if(t[0]>h||h>t[1])throw new Error(`final must be in range ${t[0]} .. ${t[1]}`);return r<<=8,r|=h,r}identToString(s){const t=[];for(;s;)t.push(String.fromCharCode(255&s)),s>>=8;return t.reverse().join("")}setPrintHandler(s){this._printHandler=s}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(s,t){const r=this._identifier(s,[48,126]);this._escHandlers[r]===void 0&&(this._escHandlers[r]=[]);const h=this._escHandlers[r];return h.push(t),{dispose:()=>{const u=h.indexOf(t);u!==-1&&h.splice(u,1)}}}clearEscHandler(s){this._escHandlers[this._identifier(s,[48,126])]&&delete this._escHandlers[this._identifier(s,[48,126])]}setEscHandlerFallback(s){this._escHandlerFb=s}setExecuteHandler(s,t){this._executeHandlers[s.charCodeAt(0)]=t}clearExecuteHandler(s){this._executeHandlers[s.charCodeAt(0)]&&delete this._executeHandlers[s.charCodeAt(0)]}setExecuteHandlerFallback(s){this._executeHandlerFb=s}registerCsiHandler(s,t){const r=this._identifier(s);this._csiHandlers[r]===void 0&&(this._csiHandlers[r]=[]);const h=this._csiHandlers[r];return h.push(t),{dispose:()=>{const u=h.indexOf(t);u!==-1&&h.splice(u,1)}}}clearCsiHandler(s){this._csiHandlers[this._identifier(s)]&&delete this._csiHandlers[this._identifier(s)]}setCsiHandlerFallback(s){this._csiHandlerFb=s}registerDcsHandler(s,t){return this._dcsParser.registerHandler(this._identifier(s),t)}clearDcsHandler(s){this._dcsParser.clearHandler(this._identifier(s))}setDcsHandlerFallback(s){this._dcsParser.setHandlerFallback(s)}registerOscHandler(s,t){return this._oscParser.registerHandler(s,t)}clearOscHandler(s){this._oscParser.clearHandler(s)}setOscHandlerFallback(s){this._oscParser.setHandlerFallback(s)}setErrorHandler(s){this._errorHandler=s}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(s,t,r,h,u){this._parseStack.state=s,this._parseStack.handlers=t,this._parseStack.handlerPos=r,this._parseStack.transition=h,this._parseStack.chunkPos=u}parse(s,t,r){let h,u=0,p=0,g=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,g=this._parseStack.chunkPos+1;else{if(r===void 0||this._parseStack.state===1)throw this._parseStack.state=1,new Error("improper continuation due to previous async handler, giving up parsing");const l=this._parseStack.handlers;let v=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(r===!1&&v>-1){for(;v>=0&&(h=l[v](this._params),h!==!0);v--)if(h instanceof Promise)return this._parseStack.handlerPos=v,h}this._parseStack.handlers=[];break;case 4:if(r===!1&&v>-1){for(;v>=0&&(h=l[v](),h!==!0);v--)if(h instanceof Promise)return this._parseStack.handlerPos=v,h}this._parseStack.handlers=[];break;case 6:if(u=s[this._parseStack.chunkPos],h=this._dcsParser.unhook(u!==24&&u!==26,r),h)return h;u===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(u=s[this._parseStack.chunkPos],h=this._oscParser.end(u!==24&&u!==26,r),h)return h;u===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,g=this._parseStack.chunkPos+1,this.precedingCodepoint=0,this.currentState=15&this._parseStack.transition}for(let l=g;l<t;++l){switch(u=s[l],p=this._transitions.table[this.currentState<<8|(u<160?u:m)],p>>4){case 2:for(let w=l+1;;++w){if(w>=t||(u=s[w])<32||u>126&&u<m){this._printHandler(s,l,w),l=w-1;break}if(++w>=t||(u=s[w])<32||u>126&&u<m){this._printHandler(s,l,w),l=w-1;break}if(++w>=t||(u=s[w])<32||u>126&&u<m){this._printHandler(s,l,w),l=w-1;break}if(++w>=t||(u=s[w])<32||u>126&&u<m){this._printHandler(s,l,w),l=w-1;break}}break;case 3:this._executeHandlers[u]?this._executeHandlers[u]():this._executeHandlerFb(u),this.precedingCodepoint=0;break;case 0:break;case 1:if(this._errorHandler({position:l,code:u,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:const v=this._csiHandlers[this._collect<<8|u];let C=v?v.length-1:-1;for(;C>=0&&(h=v[C](this._params),h!==!0);C--)if(h instanceof Promise)return this._preserveStack(3,v,C,p,l),h;C<0&&this._csiHandlerFb(this._collect<<8|u,this._params),this.precedingCodepoint=0;break;case 8:do switch(u){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(u-48)}while(++l<t&&(u=s[l])>47&&u<60);l--;break;case 9:this._collect<<=8,this._collect|=u;break;case 10:const k=this._escHandlers[this._collect<<8|u];let E=k?k.length-1:-1;for(;E>=0&&(h=k[E](),h!==!0);E--)if(h instanceof Promise)return this._preserveStack(4,k,E,p,l),h;E<0&&this._escHandlerFb(this._collect<<8|u),this.precedingCodepoint=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|u,this._params);break;case 13:for(let w=l+1;;++w)if(w>=t||(u=s[w])===24||u===26||u===27||u>127&&u<m){this._dcsParser.put(s,l,w),l=w-1;break}break;case 14:if(h=this._dcsParser.unhook(u!==24&&u!==26),h)return this._preserveStack(6,[],0,p,l),h;u===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0;break;case 4:this._oscParser.start();break;case 5:for(let w=l+1;;w++)if(w>=t||(u=s[w])<32||u>127&&u<m){this._oscParser.put(s,l,w),l=w-1;break}break;case 6:if(h=this._oscParser.end(u!==24&&u!==26),h)return this._preserveStack(5,[],0,p,l),h;u===27&&(p|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingCodepoint=0}this.currentState=15&p}}}i.EscapeSequenceParser=f},6242:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OscHandler=i.OscParser=void 0;const a=o(5770),c=o(482),n=[];i.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(d,_){this._handlers[d]===void 0&&(this._handlers[d]=[]);const m=this._handlers[d];return m.push(_),{dispose:()=>{const f=m.indexOf(_);f!==-1&&m.splice(f,1)}}}clearHandler(d){this._handlers[d]&&delete this._handlers[d]}setHandlerFallback(d){this._handlerFb=d}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(this._state===2)for(let d=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;d>=0;--d)this._active[d].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let d=this._active.length-1;d>=0;d--)this._active[d].start();else this._handlerFb(this._id,"START")}_put(d,_,m){if(this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].put(d,_,m);else this._handlerFb(this._id,"PUT",(0,c.utf32ToString)(d,_,m))}start(){this.reset(),this._state=1}put(d,_,m){if(this._state!==3){if(this._state===1)for(;_<m;){const f=d[_++];if(f===59){this._state=2,this._start();break}if(f<48||57<f)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+f-48}this._state===2&&m-_>0&&this._put(d,_,m)}}end(d,_=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let m=!1,f=this._active.length-1,e=!1;if(this._stack.paused&&(f=this._stack.loopPosition-1,m=_,e=this._stack.fallThrough,this._stack.paused=!1),!e&&m===!1){for(;f>=0&&(m=this._active[f].end(d),m!==!0);f--)if(m instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!1,m;f--}for(;f>=0;f--)if(m=this._active[f].end(!1),m instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=f,this._stack.fallThrough=!0,m}else this._handlerFb(this._id,"END",d);this._active=n,this._id=-1,this._state=0}}},i.OscHandler=class{constructor(d){this._handler=d,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(d,_,m){this._hitLimit||(this._data+=(0,c.utf32ToString)(d,_,m),this._data.length>a.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(d){let _=!1;if(this._hitLimit)_=!1;else if(d&&(_=this._handler(this._data),_ instanceof Promise))return _.then(m=>(this._data="",this._hitLimit=!1,m));return this._data="",this._hitLimit=!1,_}}},8742:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.Params=void 0;const o=2147483647;class a{static fromArray(n){const d=new a;if(!n.length)return d;for(let _=Array.isArray(n[0])?1:0;_<n.length;++_){const m=n[_];if(Array.isArray(m))for(let f=0;f<m.length;++f)d.addSubParam(m[f]);else d.addParam(m)}return d}constructor(n=32,d=32){if(this.maxLength=n,this.maxSubParamsLength=d,d>256)throw new Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(n),this.length=0,this._subParams=new Int32Array(d),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(n),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){const n=new a(this.maxLength,this.maxSubParamsLength);return n.params.set(this.params),n.length=this.length,n._subParams.set(this._subParams),n._subParamsLength=this._subParamsLength,n._subParamsIdx.set(this._subParamsIdx),n._rejectDigits=this._rejectDigits,n._rejectSubDigits=this._rejectSubDigits,n._digitIsSub=this._digitIsSub,n}toArray(){const n=[];for(let d=0;d<this.length;++d){n.push(this.params[d]);const _=this._subParamsIdx[d]>>8,m=255&this._subParamsIdx[d];m-_>0&&n.push(Array.prototype.slice.call(this._subParams,_,m))}return n}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(n){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=n>o?o:n}}addSubParam(n){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(n<-1)throw new Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=n>o?o:n,this._subParamsIdx[this.length-1]++}}hasSubParams(n){return(255&this._subParamsIdx[n])-(this._subParamsIdx[n]>>8)>0}getSubParams(n){const d=this._subParamsIdx[n]>>8,_=255&this._subParamsIdx[n];return _-d>0?this._subParams.subarray(d,_):null}getSubParamsAll(){const n={};for(let d=0;d<this.length;++d){const _=this._subParamsIdx[d]>>8,m=255&this._subParamsIdx[d];m-_>0&&(n[d]=this._subParams.slice(_,m))}return n}addDigit(n){let d;if(this._rejectDigits||!(d=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;const _=this._digitIsSub?this._subParams:this.params,m=_[d-1];_[d-1]=~m?Math.min(10*m+n,o):n}}i.Params=a},5741:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.AddonManager=void 0,i.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let o=this._addons.length-1;o>=0;o--)this._addons[o].instance.dispose()}loadAddon(o,a){const c={instance:a,dispose:a.dispose,isDisposed:!1};this._addons.push(c),a.dispose=()=>this._wrappedAddonDispose(c),a.activate(o)}_wrappedAddonDispose(o){if(o.isDisposed)return;let a=-1;for(let c=0;c<this._addons.length;c++)if(this._addons[c]===o){a=c;break}if(a===-1)throw new Error("Could not dispose an addon that has not been loaded");o.isDisposed=!0,o.dispose.apply(o.instance),this._addons.splice(a,1)}}},8771:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferApiView=void 0;const a=o(3785),c=o(511);i.BufferApiView=class{constructor(n,d){this._buffer=n,this.type=d}init(n){return this._buffer=n,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(n){const d=this._buffer.lines.get(n);if(d)return new a.BufferLineApiView(d)}getNullCell(){return new c.CellData}}},3785:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferLineApiView=void 0;const a=o(511);i.BufferLineApiView=class{constructor(c){this._line=c}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(c,n){if(!(c<0||c>=this._line.length))return n?(this._line.loadCell(c,n),n):this._line.loadCell(c,new a.CellData)}translateToString(c,n,d){return this._line.translateToString(c,n,d)}}},8285:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.BufferNamespaceApi=void 0;const a=o(8771),c=o(8460),n=o(844);class d extends n.Disposable{constructor(m){super(),this._core=m,this._onBufferChange=this.register(new c.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new a.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new a.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate(()=>this._onBufferChange.fire(this.active))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw new Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}i.BufferNamespaceApi=d},7975:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.ParserApi=void 0,i.ParserApi=class{constructor(o){this._core=o}registerCsiHandler(o,a){return this._core.registerCsiHandler(o,c=>a(c.toArray()))}addCsiHandler(o,a){return this.registerCsiHandler(o,a)}registerDcsHandler(o,a){return this._core.registerDcsHandler(o,(c,n)=>a(c,n.toArray()))}addDcsHandler(o,a){return this.registerDcsHandler(o,a)}registerEscHandler(o,a){return this._core.registerEscHandler(o,a)}addEscHandler(o,a){return this.registerEscHandler(o,a)}registerOscHandler(o,a){return this._core.registerOscHandler(o,a)}addOscHandler(o,a){return this.registerOscHandler(o,a)}}},7090:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeApi=void 0,i.UnicodeApi=class{constructor(o){this._core=o}register(o){this._core.unicodeService.register(o)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(o){this._core.unicodeService.activeVersion=o}}},744:function(y,i,o){var a=this&&this.__decorate||function(e,s,t,r){var h,u=arguments.length,p=u<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,r);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(p=(u<3?h(p):u>3?h(s,t,p):h(s,t))||p);return u>3&&p&&Object.defineProperty(s,t,p),p},c=this&&this.__param||function(e,s){return function(t,r){s(t,r,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.BufferService=i.MINIMUM_ROWS=i.MINIMUM_COLS=void 0;const n=o(8460),d=o(844),_=o(5295),m=o(2585);i.MINIMUM_COLS=2,i.MINIMUM_ROWS=1;let f=i.BufferService=class extends d.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,i.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,i.MINIMUM_ROWS),this.buffers=this.register(new _.BufferSet(e,this))}resize(e,s){this.cols=e,this.rows=s,this.buffers.resize(e,s),this._onResize.fire({cols:e,rows:s})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,s=!1){const t=this.buffer;let r;r=this._cachedBlankLine,r&&r.length===this.cols&&r.getFg(0)===e.fg&&r.getBg(0)===e.bg||(r=t.getBlankLine(e,s),this._cachedBlankLine=r),r.isWrapped=s;const h=t.ybase+t.scrollTop,u=t.ybase+t.scrollBottom;if(t.scrollTop===0){const p=t.lines.isFull;u===t.lines.length-1?p?t.lines.recycle().copyFrom(r):t.lines.push(r.clone()):t.lines.splice(u+1,0,r.clone()),p?this.isUserScrolling&&(t.ydisp=Math.max(t.ydisp-1,0)):(t.ybase++,this.isUserScrolling||t.ydisp++)}else{const p=u-h+1;t.lines.shiftElements(h+1,p-1,-1),t.lines.set(u,r.clone())}this.isUserScrolling||(t.ydisp=t.ybase),this._onScroll.fire(t.ydisp)}scrollLines(e,s,t){const r=this.buffer;if(e<0){if(r.ydisp===0)return;this.isUserScrolling=!0}else e+r.ydisp>=r.ybase&&(this.isUserScrolling=!1);const h=r.ydisp;r.ydisp=Math.max(Math.min(r.ydisp+e,r.ybase),0),h!==r.ydisp&&(s||this._onScroll.fire(r.ydisp))}};i.BufferService=f=a([c(0,m.IOptionsService)],f)},7994:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.CharsetService=void 0,i.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(o){this.glevel=o,this.charset=this._charsets[o]}setgCharset(o,a){this._charsets[o]=a,this.glevel===o&&(this.charset=a)}}},1753:function(y,i,o){var a=this&&this.__decorate||function(r,h,u,p){var g,l=arguments.length,v=l<3?h:p===null?p=Object.getOwnPropertyDescriptor(h,u):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(r,h,u,p);else for(var C=r.length-1;C>=0;C--)(g=r[C])&&(v=(l<3?g(v):l>3?g(h,u,v):g(h,u))||v);return l>3&&v&&Object.defineProperty(h,u,v),v},c=this&&this.__param||function(r,h){return function(u,p){h(u,p,r)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreMouseService=void 0;const n=o(2585),d=o(8460),_=o(844),m={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:r=>r.button!==4&&r.action===1&&(r.ctrl=!1,r.alt=!1,r.shift=!1,!0)},VT200:{events:19,restrict:r=>r.action!==32},DRAG:{events:23,restrict:r=>r.action!==32||r.button!==3},ANY:{events:31,restrict:r=>!0}};function f(r,h){let u=(r.ctrl?16:0)|(r.shift?4:0)|(r.alt?8:0);return r.button===4?(u|=64,u|=r.action):(u|=3&r.button,4&r.button&&(u|=64),8&r.button&&(u|=128),r.action===32?u|=32:r.action!==0||h||(u|=3)),u}const e=String.fromCharCode,s={DEFAULT:r=>{const h=[f(r,!1)+32,r.col+32,r.row+32];return h[0]>255||h[1]>255||h[2]>255?"":`\x1B[M${e(h[0])}${e(h[1])}${e(h[2])}`},SGR:r=>{const h=r.action===0&&r.button!==4?"m":"M";return`\x1B[<${f(r,!0)};${r.col};${r.row}${h}`},SGR_PIXELS:r=>{const h=r.action===0&&r.button!==4?"m":"M";return`\x1B[<${f(r,!0)};${r.x};${r.y}${h}`}};let t=i.CoreMouseService=class extends _.Disposable{constructor(r,h){super(),this._bufferService=r,this._coreService=h,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new d.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(const u of Object.keys(m))this.addProtocol(u,m[u]);for(const u of Object.keys(s))this.addEncoding(u,s[u]);this.reset()}addProtocol(r,h){this._protocols[r]=h}addEncoding(r,h){this._encodings[r]=h}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(r){if(!this._protocols[r])throw new Error(`unknown protocol "${r}"`);this._activeProtocol=r,this._onProtocolChange.fire(this._protocols[r].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(r){if(!this._encodings[r])throw new Error(`unknown encoding "${r}"`);this._activeEncoding=r}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(r){if(r.col<0||r.col>=this._bufferService.cols||r.row<0||r.row>=this._bufferService.rows||r.button===4&&r.action===32||r.button===3&&r.action!==32||r.button!==4&&(r.action===2||r.action===3)||(r.col++,r.row++,r.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,r,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(r))return!1;const h=this._encodings[this._activeEncoding](r);return h&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(h):this._coreService.triggerDataEvent(h,!0)),this._lastEvent=r,!0}explainEvents(r){return{down:!!(1&r),up:!!(2&r),drag:!!(4&r),move:!!(8&r),wheel:!!(16&r)}}_equalEvents(r,h,u){if(u){if(r.x!==h.x||r.y!==h.y)return!1}else if(r.col!==h.col||r.row!==h.row)return!1;return r.button===h.button&&r.action===h.action&&r.ctrl===h.ctrl&&r.alt===h.alt&&r.shift===h.shift}};i.CoreMouseService=t=a([c(0,n.IBufferService),c(1,n.ICoreService)],t)},6975:function(y,i,o){var a=this&&this.__decorate||function(t,r,h,u){var p,g=arguments.length,l=g<3?r:u===null?u=Object.getOwnPropertyDescriptor(r,h):u;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")l=Reflect.decorate(t,r,h,u);else for(var v=t.length-1;v>=0;v--)(p=t[v])&&(l=(g<3?p(l):g>3?p(r,h,l):p(r,h))||l);return g>3&&l&&Object.defineProperty(r,h,l),l},c=this&&this.__param||function(t,r){return function(h,u){r(h,u,t)}};Object.defineProperty(i,"__esModule",{value:!0}),i.CoreService=void 0;const n=o(1439),d=o(8460),_=o(844),m=o(2585),f=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0});let s=i.CoreService=class extends _.Disposable{constructor(t,r,h){super(),this._bufferService=t,this._logService=r,this._optionsService=h,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new d.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new d.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new d.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new d.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(f),this.decPrivateModes=(0,n.clone)(e)}reset(){this.modes=(0,n.clone)(f),this.decPrivateModes=(0,n.clone)(e)}triggerDataEvent(t,r=!1){if(this._optionsService.rawOptions.disableStdin)return;const h=this._bufferService.buffer;r&&this._optionsService.rawOptions.scrollOnUserInput&&h.ybase!==h.ydisp&&this._onRequestScrollToBottom.fire(),r&&this._onUserInput.fire(),this._logService.debug(`sending data "${t}"`,()=>t.split("").map(u=>u.charCodeAt(0))),this._onData.fire(t)}triggerBinaryEvent(t){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${t}"`,()=>t.split("").map(r=>r.charCodeAt(0))),this._onBinary.fire(t))}};i.CoreService=s=a([c(0,m.IBufferService),c(1,m.ILogService),c(2,m.IOptionsService)],s)},9074:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.DecorationService=void 0;const a=o(8055),c=o(8460),n=o(844),d=o(6106);let _=0,m=0;class f extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new d.SortedList(t=>t==null?void 0:t.marker.line),this._onDecorationRegistered=this.register(new c.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new c.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)(()=>this.reset()))}registerDecoration(t){if(t.marker.isDisposed)return;const r=new e(t);if(r){const h=r.marker.onDispose(()=>r.dispose());r.onDispose(()=>{r&&(this._decorations.delete(r)&&this._onDecorationRemoved.fire(r),h.dispose())}),this._decorations.insert(r),this._onDecorationRegistered.fire(r)}return r}reset(){for(const t of this._decorations.values())t.dispose();this._decorations.clear()}*getDecorationsAtCell(t,r,h){var u,p,g;let l=0,v=0;for(const C of this._decorations.getKeyIterator(r))l=(u=C.options.x)!==null&&u!==void 0?u:0,v=l+((p=C.options.width)!==null&&p!==void 0?p:1),t>=l&&t<v&&(!h||((g=C.options.layer)!==null&&g!==void 0?g:"bottom")===h)&&(yield C)}forEachDecorationAtCell(t,r,h,u){this._decorations.forEachByKey(r,p=>{var g,l,v;_=(g=p.options.x)!==null&&g!==void 0?g:0,m=_+((l=p.options.width)!==null&&l!==void 0?l:1),t>=_&&t<m&&(!h||((v=p.options.layer)!==null&&v!==void 0?v:"bottom")===h)&&u(p)})}}i.DecorationService=f;class e extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=a.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=a.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(t){super(),this.options=t,this.onRenderEmitter=this.register(new c.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new c.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=t.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.InstantiationService=i.ServiceCollection=void 0;const a=o(2585),c=o(8343);class n{constructor(..._){this._entries=new Map;for(const[m,f]of _)this.set(m,f)}set(_,m){const f=this._entries.get(_);return this._entries.set(_,m),f}forEach(_){for(const[m,f]of this._entries.entries())_(m,f)}has(_){return this._entries.has(_)}get(_){return this._entries.get(_)}}i.ServiceCollection=n,i.InstantiationService=class{constructor(){this._services=new n,this._services.set(a.IInstantiationService,this)}setService(d,_){this._services.set(d,_)}getService(d){return this._services.get(d)}createInstance(d,..._){const m=(0,c.getServiceDependencies)(d).sort((s,t)=>s.index-t.index),f=[];for(const s of m){const t=this._services.get(s.id);if(!t)throw new Error(`[createInstance] ${d.name} depends on UNKNOWN service ${s.id}.`);f.push(t)}const e=m.length>0?m[0].index:_.length;if(_.length!==e)throw new Error(`[createInstance] First service dependency of ${d.name} at position ${e+1} conflicts with ${_.length} static arguments`);return new d(..._,...f)}}},7866:function(y,i,o){var a=this&&this.__decorate||function(e,s,t,r){var h,u=arguments.length,p=u<3?s:r===null?r=Object.getOwnPropertyDescriptor(s,t):r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")p=Reflect.decorate(e,s,t,r);else for(var g=e.length-1;g>=0;g--)(h=e[g])&&(p=(u<3?h(p):u>3?h(s,t,p):h(s,t))||p);return u>3&&p&&Object.defineProperty(s,t,p),p},c=this&&this.__param||function(e,s){return function(t,r){s(t,r,e)}};Object.defineProperty(i,"__esModule",{value:!0}),i.traceCall=i.setTraceLogger=i.LogService=void 0;const n=o(844),d=o(2585),_={trace:d.LogLevelEnum.TRACE,debug:d.LogLevelEnum.DEBUG,info:d.LogLevelEnum.INFO,warn:d.LogLevelEnum.WARN,error:d.LogLevelEnum.ERROR,off:d.LogLevelEnum.OFF};let m,f=i.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=d.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",()=>this._updateLogLevel())),m=this}_updateLogLevel(){this._logLevel=_[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let s=0;s<e.length;s++)typeof e[s]=="function"&&(e[s]=e[s]())}_log(e,s,t){this._evalLazyOptionalParams(t),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+s,...t)}trace(e,...s){var t,r;this._logLevel<=d.LogLevelEnum.TRACE&&this._log((r=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.trace.bind(this._optionsService.options.logger))!==null&&r!==void 0?r:console.log,e,s)}debug(e,...s){var t,r;this._logLevel<=d.LogLevelEnum.DEBUG&&this._log((r=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.debug.bind(this._optionsService.options.logger))!==null&&r!==void 0?r:console.log,e,s)}info(e,...s){var t,r;this._logLevel<=d.LogLevelEnum.INFO&&this._log((r=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.info.bind(this._optionsService.options.logger))!==null&&r!==void 0?r:console.info,e,s)}warn(e,...s){var t,r;this._logLevel<=d.LogLevelEnum.WARN&&this._log((r=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.warn.bind(this._optionsService.options.logger))!==null&&r!==void 0?r:console.warn,e,s)}error(e,...s){var t,r;this._logLevel<=d.LogLevelEnum.ERROR&&this._log((r=(t=this._optionsService.options.logger)===null||t===void 0?void 0:t.error.bind(this._optionsService.options.logger))!==null&&r!==void 0?r:console.error,e,s)}};i.LogService=f=a([c(0,d.IOptionsService)],f),i.setTraceLogger=function(e){m=e},i.traceCall=function(e,s,t){if(typeof t.value!="function")throw new Error("not supported");const r=t.value;t.value=function(...h){if(m.logLevel!==d.LogLevelEnum.TRACE)return r.apply(this,h);m.trace(`GlyphRenderer#${r.name}(${h.map(p=>JSON.stringify(p)).join(", ")})`);const u=r.apply(this,h);return m.trace(`GlyphRenderer#${r.name} return`,u),u}}},7302:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.OptionsService=i.DEFAULT_OPTIONS=void 0;const a=o(8460),c=o(844),n=o(6114);i.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rightClickSelectsWord:n.isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};const d=["normal","bold","100","200","300","400","500","600","700","800","900"];class _ extends c.Disposable{constructor(f){super(),this._onOptionChange=this.register(new a.EventEmitter),this.onOptionChange=this._onOptionChange.event;const e=Object.assign({},i.DEFAULT_OPTIONS);for(const s in f)if(s in e)try{const t=f[s];e[s]=this._sanitizeAndValidateOption(s,t)}catch(t){console.error(t)}this.rawOptions=e,this.options=Object.assign({},e),this._setupOptions()}onSpecificOptionChange(f,e){return this.onOptionChange(s=>{s===f&&e(this.rawOptions[f])})}onMultipleOptionChange(f,e){return this.onOptionChange(s=>{f.indexOf(s)!==-1&&e()})}_setupOptions(){const f=s=>{if(!(s in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);return this.rawOptions[s]},e=(s,t)=>{if(!(s in i.DEFAULT_OPTIONS))throw new Error(`No option with key "${s}"`);t=this._sanitizeAndValidateOption(s,t),this.rawOptions[s]!==t&&(this.rawOptions[s]=t,this._onOptionChange.fire(s))};for(const s in this.rawOptions){const t={get:f.bind(this,s),set:e.bind(this,s)};Object.defineProperty(this.options,s,t)}}_sanitizeAndValidateOption(f,e){switch(f){case"cursorStyle":if(e||(e=i.DEFAULT_OPTIONS[f]),!function(s){return s==="block"||s==="underline"||s==="bar"}(e))throw new Error(`"${e}" is not a valid value for ${f}`);break;case"wordSeparator":e||(e=i.DEFAULT_OPTIONS[f]);break;case"fontWeight":case"fontWeightBold":if(typeof e=="number"&&1<=e&&e<=1e3)break;e=d.includes(e)?e:i.DEFAULT_OPTIONS[f];break;case"cursorWidth":e=Math.floor(e);case"lineHeight":case"tabStopWidth":if(e<1)throw new Error(`${f} cannot be less than 1, value: ${e}`);break;case"minimumContrastRatio":e=Math.max(1,Math.min(21,Math.round(10*e)/10));break;case"scrollback":if((e=Math.min(e,4294967295))<0)throw new Error(`${f} cannot be less than 0, value: ${e}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(e<=0)throw new Error(`${f} cannot be less than or equal to 0, value: ${e}`);break;case"rows":case"cols":if(!e&&e!==0)throw new Error(`${f} must be numeric, value: ${e}`);break;case"windowsPty":e=e??{}}return e}}i.OptionsService=_},2660:function(y,i,o){var a=this&&this.__decorate||function(_,m,f,e){var s,t=arguments.length,r=t<3?m:e===null?e=Object.getOwnPropertyDescriptor(m,f):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")r=Reflect.decorate(_,m,f,e);else for(var h=_.length-1;h>=0;h--)(s=_[h])&&(r=(t<3?s(r):t>3?s(m,f,r):s(m,f))||r);return t>3&&r&&Object.defineProperty(m,f,r),r},c=this&&this.__param||function(_,m){return function(f,e){m(f,e,_)}};Object.defineProperty(i,"__esModule",{value:!0}),i.OscLinkService=void 0;const n=o(2585);let d=i.OscLinkService=class{constructor(_){this._bufferService=_,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(_){const m=this._bufferService.buffer;if(_.id===void 0){const h=m.addMarker(m.ybase+m.y),u={data:_,id:this._nextId++,lines:[h]};return h.onDispose(()=>this._removeMarkerFromLink(u,h)),this._dataByLinkId.set(u.id,u),u.id}const f=_,e=this._getEntryIdKey(f),s=this._entriesWithId.get(e);if(s)return this.addLineToLink(s.id,m.ybase+m.y),s.id;const t=m.addMarker(m.ybase+m.y),r={id:this._nextId++,key:this._getEntryIdKey(f),data:f,lines:[t]};return t.onDispose(()=>this._removeMarkerFromLink(r,t)),this._entriesWithId.set(r.key,r),this._dataByLinkId.set(r.id,r),r.id}addLineToLink(_,m){const f=this._dataByLinkId.get(_);if(f&&f.lines.every(e=>e.line!==m)){const e=this._bufferService.buffer.addMarker(m);f.lines.push(e),e.onDispose(()=>this._removeMarkerFromLink(f,e))}}getLinkData(_){var m;return(m=this._dataByLinkId.get(_))===null||m===void 0?void 0:m.data}_getEntryIdKey(_){return`${_.id};;${_.uri}`}_removeMarkerFromLink(_,m){const f=_.lines.indexOf(m);f!==-1&&(_.lines.splice(f,1),_.lines.length===0&&(_.data.id!==void 0&&this._entriesWithId.delete(_.key),this._dataByLinkId.delete(_.id)))}};i.OscLinkService=d=a([c(0,n.IBufferService)],d)},8343:(y,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.createDecorator=i.getServiceDependencies=i.serviceRegistry=void 0;const o="di$target",a="di$dependencies";i.serviceRegistry=new Map,i.getServiceDependencies=function(c){return c[a]||[]},i.createDecorator=function(c){if(i.serviceRegistry.has(c))return i.serviceRegistry.get(c);const n=function(d,_,m){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");(function(f,e,s){e[o]===e?e[a].push({id:f,index:s}):(e[a]=[{id:f,index:s}],e[o]=e)})(n,d,m)};return n.toString=()=>c,i.serviceRegistry.set(c,n),n}},2585:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.IDecorationService=i.IUnicodeService=i.IOscLinkService=i.IOptionsService=i.ILogService=i.LogLevelEnum=i.IInstantiationService=i.ICharsetService=i.ICoreService=i.ICoreMouseService=i.IBufferService=void 0;const a=o(8343);var c;i.IBufferService=(0,a.createDecorator)("BufferService"),i.ICoreMouseService=(0,a.createDecorator)("CoreMouseService"),i.ICoreService=(0,a.createDecorator)("CoreService"),i.ICharsetService=(0,a.createDecorator)("CharsetService"),i.IInstantiationService=(0,a.createDecorator)("InstantiationService"),function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"}(c||(i.LogLevelEnum=c={})),i.ILogService=(0,a.createDecorator)("LogService"),i.IOptionsService=(0,a.createDecorator)("OptionsService"),i.IOscLinkService=(0,a.createDecorator)("OscLinkService"),i.IUnicodeService=(0,a.createDecorator)("UnicodeService"),i.IDecorationService=(0,a.createDecorator)("DecorationService")},1480:(y,i,o)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.UnicodeService=void 0;const a=o(8460),c=o(225);i.UnicodeService=class{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new a.EventEmitter,this.onChange=this._onChange.event;const n=new c.UnicodeV6;this.register(n),this._active=n.version,this._activeProvider=n}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(n){if(!this._providers[n])throw new Error(`unknown Unicode version "${n}"`);this._active=n,this._activeProvider=this._providers[n],this._onChange.fire(n)}register(n){this._providers[n.version]=n}wcwidth(n){return this._activeProvider.wcwidth(n)}getStringCellWidth(n){let d=0;const _=n.length;for(let m=0;m<_;++m){let f=n.charCodeAt(m);if(55296<=f&&f<=56319){if(++m>=_)return d+this.wcwidth(f);const e=n.charCodeAt(m);56320<=e&&e<=57343?f=1024*(f-55296)+e-56320+65536:d+=this.wcwidth(e)}d+=this.wcwidth(f)}return d}}}},A={};function L(y){var i=A[y];if(i!==void 0)return i.exports;var o=A[y]={exports:{}};return T[y].call(o.exports,o,o.exports,L),o.exports}var B={};return(()=>{var y=B;Object.defineProperty(y,"__esModule",{value:!0}),y.Terminal=void 0;const i=L(9042),o=L(3236),a=L(844),c=L(5741),n=L(8285),d=L(7975),_=L(7090),m=["cols","rows"];class f extends a.Disposable{constructor(s){super(),this._core=this.register(new o.Terminal(s)),this._addonManager=this.register(new c.AddonManager),this._publicOptions=Object.assign({},this._core.options);const t=h=>this._core.options[h],r=(h,u)=>{this._checkReadonlyOptions(h),this._core.options[h]=u};for(const h in this._core.options){const u={get:t.bind(this,h),set:r.bind(this,h)};Object.defineProperty(this._publicOptions,h,u)}}_checkReadonlyOptions(s){if(m.includes(s))throw new Error(`Option "${s}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw new Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new d.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new _.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new n.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){const s=this._core.coreService.decPrivateModes;let t="none";switch(this._core.coreMouseService.activeProtocol){case"X10":t="x10";break;case"VT200":t="vt200";break;case"DRAG":t="drag";break;case"ANY":t="any"}return{applicationCursorKeysMode:s.applicationCursorKeys,applicationKeypadMode:s.applicationKeypad,bracketedPasteMode:s.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:t,originMode:s.origin,reverseWraparoundMode:s.reverseWraparound,sendFocusMode:s.sendFocus,wraparoundMode:s.wraparound}}get options(){return this._publicOptions}set options(s){for(const t in s)this._publicOptions[t]=s[t]}blur(){this._core.blur()}focus(){this._core.focus()}resize(s,t){this._verifyIntegers(s,t),this._core.resize(s,t)}open(s){this._core.open(s)}attachCustomKeyEventHandler(s){this._core.attachCustomKeyEventHandler(s)}registerLinkProvider(s){return this._core.registerLinkProvider(s)}registerCharacterJoiner(s){return this._checkProposedApi(),this._core.registerCharacterJoiner(s)}deregisterCharacterJoiner(s){this._checkProposedApi(),this._core.deregisterCharacterJoiner(s)}registerMarker(s=0){return this._verifyIntegers(s),this._core.registerMarker(s)}registerDecoration(s){var t,r,h;return this._checkProposedApi(),this._verifyPositiveIntegers((t=s.x)!==null&&t!==void 0?t:0,(r=s.width)!==null&&r!==void 0?r:0,(h=s.height)!==null&&h!==void 0?h:0),this._core.registerDecoration(s)}hasSelection(){return this._core.hasSelection()}select(s,t,r){this._verifyIntegers(s,t,r),this._core.select(s,t,r)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(s,t){this._verifyIntegers(s,t),this._core.selectLines(s,t)}dispose(){super.dispose()}scrollLines(s){this._verifyIntegers(s),this._core.scrollLines(s)}scrollPages(s){this._verifyIntegers(s),this._core.scrollPages(s)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(s){this._verifyIntegers(s),this._core.scrollToLine(s)}clear(){this._core.clear()}write(s,t){this._core.write(s,t)}writeln(s,t){this._core.write(s),this._core.write(`\r
`,t)}paste(s){this._core.paste(s)}refresh(s,t){this._verifyIntegers(s,t),this._core.refresh(s,t)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(s){this._addonManager.loadAddon(this,s)}static get strings(){return i}_verifyIntegers(...s){for(const t of s)if(t===1/0||isNaN(t)||t%1!=0)throw new Error("This API only accepts integers")}_verifyPositiveIntegers(...s){for(const t of s)if(t&&(t===1/0||isNaN(t)||t%1!=0||t<0))throw new Error("This API only accepts positive integers")}}y.Terminal=f})(),B})())}(Ft)),Ft.exports}var hs=as(),Nt={exports:{}},ii;function ls(){return ii||(ii=1,function(M,x){(function(T,A){M.exports=A()})(self,()=>(()=>{var T={};return(()=>{var A=T;Object.defineProperty(A,"__esModule",{value:!0}),A.FitAddon=void 0,A.FitAddon=class{activate(L){this._terminal=L}dispose(){}fit(){const L=this.proposeDimensions();if(!L||!this._terminal||isNaN(L.cols)||isNaN(L.rows))return;const B=this._terminal._core;this._terminal.rows===L.rows&&this._terminal.cols===L.cols||(B._renderService.clear(),this._terminal.resize(L.cols,L.rows))}proposeDimensions(){if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;const L=this._terminal._core,B=L._renderService.dimensions;if(B.css.cell.width===0||B.css.cell.height===0)return;const y=this._terminal.options.scrollback===0?0:L.viewport.scrollBarWidth,i=window.getComputedStyle(this._terminal.element.parentElement),o=parseInt(i.getPropertyValue("height")),a=Math.max(0,parseInt(i.getPropertyValue("width"))),c=window.getComputedStyle(this._terminal.element),n=o-(parseInt(c.getPropertyValue("padding-top"))+parseInt(c.getPropertyValue("padding-bottom"))),d=a-(parseInt(c.getPropertyValue("padding-right"))+parseInt(c.getPropertyValue("padding-left")))-y;return{cols:Math.max(2,Math.floor(d/B.css.cell.width)),rows:Math.max(1,Math.floor(n/B.css.cell.height))}}}})(),T})())}(Nt)),Nt.exports}var cs=ls();const ds=({deviceName:M,ip:x,username:T,password:A})=>{const L=Ie.useRef(null),[B,y]=Ie.useState(!0);let i="",o=!1;const a="http://localhost:8081/terminal/ws",c=["/app/ssh.connect",`${x}:22:${T}:${A}`],n="/topic/ssh.response";return Ie.useEffect(()=>{if(!x||!T||!A){console.error("Недостаточно данных для подключения");return}const d=new hs.Terminal,_=new cs.FitAddon;d.loadAddon(_),L.current&&(d.open(L.current),_.fit());const m=new Gi(a),f=os.over(m);return f.connect({},()=>{console.log("WebSocket connected"),y(!1),d.write(`\r
Подключение установлено!\r
`),c&&f.send(c[0],{},c[1]),f.subscribe(n,e=>{const s=e.body;o=s.includes("--More--"),d&&d.write(s)})},e=>{console.error("WebSocket connection error:",e),y(!1),d.write(`\r
Ошибка подключения к ${M}!\r
`)}),d.onData(e=>{o?f.send("/app/ssh.signal",{},e):e==="\r"||e===`
`?(f.send("/app/ssh.command",{},i+e),i=""):e===""?i.length!==0&&(i=i.slice(0,-1),d&&d.write("\b \b")):(d&&d.write(e),i+=e)}),()=>{d&&(console.log("Terminal disposed"),d.dispose()),f&&(console.log("WebSocket disconnected"),f.disconnect(()=>{}))}},[x,T,A]),pe.jsxs("div",{className:"terminal-container",children:[pe.jsx("div",{className:"terminal",ref:L,style:{width:"100%",height:"500px"}}),B&&pe.jsxs("div",{className:"connecting-overlay",children:[pe.jsx("div",{className:"spinner"}),pe.jsx("p",{children:"Подключение..."})]})]})};export{ds as default};
